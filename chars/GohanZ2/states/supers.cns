;=============================================
; CNS File for Gohan Z2 by Team Z2
; Supers file
;=============================================



;===========================================================================
; <<<<< MASENKO LVL 1>>>>>
; Charge		state	= 2000
; Launch straight	state	= 2010
; Launch up	state	= 2020
; Helper straight	Masenko	= 2011 
; Helper upwards	Masenko	= 2021
;===========================================================================

;LVL1 Masenko start-up
[Statedef 2000]
type = S
physics = S		
movetype = A
anim = 2000
ctrl = 0
velset = 0,0
sprpriority = 1
poweradd = -1000;IfElse(fvar(27)>0,0,-1000)

[State 3000, width]
type = width
trigger1 = 1
value = 25,0

[State 0, VarSet P2 not in hit state]
type = VarSet
trigger1 = P2MoveType !=H
fvar(30) = 0
[State 0, VarSet no dizzy if P2 in hit state]
type = VarSet
trigger1 = P2MoveType =H
fvar(30) = 1.0

[State 3000, remember Destiny mode]
type = null;VarSet
trigger1 = !time && fvar(27)>0
var(19) = 1
[State 3000, cancel Destiny mode]
type = null;VarSet
trigger1 = !time
fvar(27)=0

[State 800, VarSet];Charging time
type = VarSet
trigger1 = !time
var(26) = 0

[State 800, VarSet];Masenko limiter
type = VarSet
trigger1 = !time
var(28) = 1

[State 0, AssertSpecial]
type = AssertSpecial
trigger1 = time = [0,48]
flag = noFG

[State 200, BGPalFX]
type = BGPalFX
trigger1 = time>=48
time = 1
add	= ceil(-256+1.7*Var(26)),ceil(-256+1.7*Var(26)),ceil(-256+1.7*Var(26))
mul	= 256,256,256
invertall = 0
color = 256

[State 3000, nhb]
type = NotHitBy
trigger1 = anim = 2000 && var(26) = 0
time = 1
value = SCA

[State 200, Masenko voice] ;<<<<<<<<<<<<<<<<<
type = null;PlaySnd
triggerall = var(55)=0		;Voice=Japan
trigger1 = time = 0
value = 2000,5+random%3
volume = 355
channel = 0

[State 200, Masenko voice] ;<<<<<<<<<<<<<<<<<
type = null;PlaySnd
triggerall = var(55)=1		;Voice=English
trigger1 = time = 0
value = 2000,15+random%3
volume = 355
channel = 0

[State 200, 1];voice
type = PlaySnd
;triggerall = var(55)=2		;Voice=Custom Corey Holland
trigger1 = time = 0
value = 2000,20+random%2
channel = 0

[State 1000, shake]
type = EnvShake
triggerall = anim=2000
trigger1 = !(time%4)
time=4
freq=80
ampl=1.5+0.02*time

[State 200, Kmh charge]
type = PlaySnd
trigger1 = time = 10
trigger2 = time = 30
value = 2000,10
volume = 355

[State 3000, SuperPause]
type = SuperPause
trigger1 = time=5
time = 40
p2defmul = 1
unhittable = 1
anim = -1
sound = s2000,0
darken = 0
movetime = 40

[State 0, Super FX]
type = Explod
trigger1 = time = 5
anim = 2003
id = 2003
pos = -119,-2
postype = p1
supermovetime = 9999
pausemovetime = 9999
supermove = 1
removetime = -2
sprpriority = 8
ownpal = 1
bindtime = -1
scale = 1,1
persistent = 0

[State 0, Charge Ball FX]
type = Explod
trigger1 = time = 5
anim = 2015   ;2420+10000*(var(2)=0)
id = 2015     ;2420
pos = -7,-109
postype = p1
supermovetime = 9999
pausemovetime = 9999
supermove = 1
removetime = -1
sprpriority = 5
ownpal = 1
bindtime = -1
scale = 1,1
persistent = 0

[State 0, Charge lightning FX]
type = Explod
triggerall = var(19) = 1  ;if Destiny mode
trigger1 = time = 5
anim = 2006
id = 2006
pos = -10,0
postype = p1
supermovetime = 9999
pausemovetime = 9999
supermove = 1
removetime = -1
sprpriority = 5
ownpal = 1
bindtime = -1
scale = 1,1

[State 0, lightning sound]
type = PlaySnd
triggerall = var(19) = 1  ;if Destiny mode
triggerall = time>=5
trigger1 = gametime%(20) = 0
value = 2400,3
volume = -200
freqmul = .9 + (random/5000.0)

[state 17100, scale charge FX]
type = null;ModifyExplod
trigger1 = numexplod(2015)
scale = 1.0+0.003*(time-20),1.0+0.003*(time-20)
id = 2015

[State 0, Ki Gather FX]
type = Explod
trigger1 = time = 5
anim = 2016   ;2002+10000*(var(2)=0)
id = 2016     ;2002
pos = -7,-109
postype = p1
supermovetime = 9999
pausemovetime = 9999
supermove = 1
removetime = -2  ;43
sprpriority = 6
ownpal = 1
bindtime = -1
scale = 1,1
persistent = 0

[State 200, Masenko charge long]
type = PlaySnd
trigger1 = time = 5
channel = 7
value = 2000,1

[State 2500, bgpalfx1]
type = bgpalfx
trigger1 = !time
time = 48
color=0
mul=0,0,0

[State 800, VarSet]
type = VarAdd
triggerall = Anim=2000 && time>48
trigger1 = !AILevel && ((command = "holdx") || (command = "holdy") || (command = "holdz"))
trigger2 = AILevel
var(26) = 1

;Throw Masenko Up
[State 901, ChangeAnim]
type = ChangeState
triggerall = !AILevel
triggerall = Anim=2000 && time>=48
triggerall = NumExplod(90000008)|| NumExplod(90000007)|| NumExplod(90000009)
trigger1 = (command != "holdx") && (command != "holdy") && (command != "holdz")
trigger2 = time >= 200
value = 2020
ctrl = 0
[State 901, ChangeAnim]
type = ChangeState
triggerall = AILevel
triggerall = Anim=2000 && time>=48
triggerall = EnemyNear,statetype = A && ((EnemyNear,vel x>0)||(EnemyNear,Movetype=A) || (EnemyNear,Movetype=I))
triggerall = (p2bodydist x =[60,120]) && (p2bodydist y =[-180,-60])
trigger1 = random < (100 * (AIlevel ** 2 / 64.0))
trigger2 = time >= 200
value = 2020
ctrl = 0

;Throw Masenko Straight
[State 901, ChangeAnim]
type = ChangeState
triggerall = !AILevel
triggerall = Anim=2000 && time>=48
trigger1 = (command != "holdx") && (command != "holdy") && (command != "holdz")
trigger2 = time >= 200
value = 2010
ctrl = 0
[State 901, ChangeAnim]
type = ChangeState
triggerall = AILevel
triggerall = Anim=2000 && time>=48
trigger1 = random < (100 * (AIlevel ** 2 / 64.0))
trigger1 = ((EnemyNear,vel x>0)||(EnemyNear,Movetype=A)|| (EnemyNear,Movetype=I))
trigger2 = time >= 200
value = 2010
ctrl = 0

;-----------------------------

;Shoot straight
[Statedef 2010]
type = S
physics = S
movetype = A
anim = 2010
ctrl = 0
velset = 0,0
sprpriority = 1

[State 0, Charge lightning FX]
type = RemoveExplod
trigger1 = !time
ID = 2006

[State 3000, nhb]
type = NotHitBy
trigger1 = var(26)=0 && time<4
time = 1
value = SCA

[State 3000, width]
type=width
trigger1 = 1
value = 25,0

[state 1215, remove charge FX]
type = removeexplod
trigger1 = !time
ID = 2015

[state 1215, Smoke FX]
type = explod
trigger1 = !time
anim = 1206+(var(2)=0)
id = 1206
pos = -25,3
postype = P1
sprpriority = 3
ownpal = 1
removetime = -2
persistent = 0
ignorehitpause = 1


[State 3000, masenko]
type = helper
trigger1 = !time
helpertype = normal
stateno = 2011
ID = 2011
name = "masenko"
postype = p1
pos = 55,-60
ownpal = 1

[State 3000, end]
type = changestate
trigger1 = !animtime
value = 0
ctrl = 1

;-----------------------------

;Shoot up
[Statedef 2020]
type = S
physics = S
movetype = A
anim = 2020
ctrl = 0
velset = 0,0
sprpriority = 1

[State 0, Charge lightning FX]
type = RemoveExplod
trigger1 = !time
ID = 2006

[State 3000, nhb]
type = NotHitBy
trigger1 = var(26)=0 && time<4
time = 1
value = SCA

[State 3000, width]
type=width
trigger1 = 1
value = 25,0

[state 1215, remove charge FX]
type = removeexplod
trigger1 = !time
ID = 2015

[state 1215, Smoke FX]
type = explod
trigger1 = !time
anim = 1206+(var(2)=0)
id = 1206
pos = -25,3
postype = P1
sprpriority = 3
ownpal = 1
removetime = -2
persistent = 0
ignorehitpause = 1

[state 1215, Flash FX]
type = null ;explod
trigger1 = !time
anim = 2005
id = 2005
pos = 0,0
postype = P1
sprpriority = 3
ownpal = 1
removetime = -2
persistent = 0
ignorehitpause = 0

[State 3000, masenko]
type = helper
trigger1 = !time
helpertype = normal
stateno = 2021
ID = 2021
name = "masenko_up"
postype = p1
pos = 25,-105
ownpal = 1

[State 3000, end]
type = changestate
trigger1 = !animtime
value = 0
ctrl = 1

;===========================================================================
; <<<<< MASENKO LVL 2>>>>>
; Charge		state	= 2030
; Launch straight	state	= 2040
; Launch up	state	= 2050
; Helper straight	Masenko	= 2031 
; Helper upwards	Masenko	= 2041
;===========================================================================

;LVL2 Masenko start-up
[Statedef 2030]
type		= S
physics		= S
movetype		= A
anim		= 2000
ctrl		= 0
velset		= 0,0
sprpriority	= 1
poweradd		= -2000;IfElse(fvar(27)>0,0,-2000)

[State 0, VarSet P2 not in hit state]
type = VarSet
trigger1 = P2MoveType !=H
fvar(30) = 0
[State 0, VarSet no dizzy if P2 in hit state]
type = VarSet
trigger1 = P2MoveType =H
fvar(30) = 1.0

[State 2030, width]
type		= width
trigger1		= 1
value		= 25,0

[State 2030, AssertSpecial]
type		= AssertSpecial
trigger1		= time = [0,48]
flag		= noFG

[State 2030, BGPalFX1]
type		= BGPalFX
trigger1		= time >= 48
time		= 1
add		= ceil(-256+1.7*Var(26)/3),ceil(-256+1.7*Var(26)/3),ceil(-256+1.7*Var(26)/3)
mul		= 256,256,256
invertall		= 0
color		= 256
[State 2030, BGPalFX2]
type		= BGPalFX
trigger1		= !Time
time		= 48
color		= 0
mul		= 0,0,0

[State 2030, NotHitBy]
type		= NotHitBy
trigger1	= anim = 2000 && time = [0,48]
time		= 1
value		= SCA



[State 2030, EnvShake]
type		= EnvShake
triggerall	= Anim = 2000
trigger1		= !(time%4)
time		= 4
freq		= 80
ampl		= 1.5+0.02*time


[State 2030, SuperPause]
type		= SuperPause
trigger1		= time=5
time		= 40
p2defmul		= 1
unhittable	= 1
anim		= -1
sound		= s2350,0
darken		= 0
movetime		= 40

[State 2030, Hyper Charge FX]
type		= Explod
trigger1 = time = 5
anim = 2442
id = 2440
pos = -7,-109
postype = p1
supermovetime = 9999
pausemovetime = 9999
supermove = 1
removetime = -2
sprpriority = 6
ownpal = 1
bindtime = -1
scale = 1,1
persistent = 0
removeongethit = 1
[State 2030, Charge Ball FX]
type = Explod
trigger1 = time = 5
anim = 2015   ;2420+10000*(var(2)=0)
id = 20150     ;2420
pos = -7,-109
postype = p1
supermovetime = 9999
pausemovetime = 9999
supermove = 1
removetime = -1
sprpriority = 5
ownpal = 1
bindtime = -1
scale = 1,1 ;1.1,1.1
persistent = 0
removeongethit = 1
[State 2030, Charge lightning FX]
type = Explod
triggerall = var(19) = 1  ;if Destiny mode
trigger1 = time = 5
anim = 2006
id = 20060
pos = -10,0
postype = p1
supermovetime = 9999
pausemovetime = 9999
supermove = 1
removetime = -1
sprpriority = 5
ownpal = 1
bindtime = -1
scale = 1,1
removeongethit = 1
[State 2030, Ki Gather FX]
type = Explod
trigger1 = time = 5
anim = 2016   ;2002+10000*(var(2)=0)
id = 20160   ;2002
pos = -7,-109
postype = p1
supermovetime = 9999
pausemovetime = 9999
supermove = 1
removetime = -2  ;43
sprpriority = 6
ownpal = 1
bindtime = -1
scale = 1,1
persistent = 0
removeongethit = 1


[State 2030, VoiceCUSTOM];voice
type		= PlaySnd
triggerall	= var(55) = 2		;Voice=Custom Corey Holland
trigger1		= time = 0
value		= 2300,0
channel		= 0
[State 2030, Kmh charge]
type		= PlaySnd
trigger1		= time = 10
trigger2		= time = 30
value		= 2000,10
volumescale	= 100
[State 2030, Lightning sound]
type		= PlaySnd
triggerall	= var(19) = 1  ;if Destiny mode
triggerall	= time>=5
trigger1		= gametime%(20) = 0
value		= 2400,3
volumescale	= 50
[State 2030, Masenko charge long]
type		= PlaySnd
trigger1		= Time = 5
value		= 2000,1
channel		= 6

[state 2030, scale charge FX]
type		= null;ModifyExplod
trigger1		= numexplod(20150)
scale		= 1.1+0.003*(time-20),1.1+0.003*(time-20)
id		= 20150

[State 2030, VarSet];Charging time, set to 0 at start
type		= VarSet
trigger1	= !time
var(26)		= 0
[State 2030, VarSet];Masenko limiter
type		= VarSet
trigger1	= !time
var(28)		= 1
[State 2030, VarSet]
type		= VarAdd
triggerall	= Anim=2000 && Time > 48;62
trigger1	= !AILevel && (command = "holdx" || command = "holdy" || command = "holdz")
trigger2	= AILevel
var(26)		= 3

;Throw Masenko Up
[State 2030]
type = ChangeState
triggerall = !AILevel
triggerall = Anim=2000 && time>=48
triggerall = NumExplod(90000008)|| NumExplod(90000007)|| NumExplod(90000009)
;trigger1 = !numexplod(90000200) && !numexplod(90000210) && !numexplod(90000220)
trigger1 = (command != "holdx") && (command != "holdy") && (command != "holdz")
trigger2 = time >= 148;162;130;200
value = 2050
ctrl = 0
[State 2030, AI]
type = ChangeState
triggerall = AILevel
triggerall = Anim=2000 && time>=48
trigger1 = EnemyNear,statetype=A && ((EnemyNear,vel x>0)||(EnemyNear,Movetype=A) || (EnemyNear,Movetype=I))
trigger1 = (p2bodydist x =[60,120]) && (p2bodydist y =[-180,-60])
trigger2 = time >= 148
value = 2050
ctrl = 0

;Throw Masenko Straight
[State 2030]
type = ChangeState
triggerall = !AILevel
triggerall = Anim=2000 && time>=48
;trigger1 = !numexplod(90000200) && !numexplod(90000210) && !numexplod(90000220)
trigger1 = (command != "holdx") && (command != "holdy") && (command != "holdz")
trigger2 = time >= 148;162;130;200
value = 2040
ctrl = 0
[State 2030, AI]
type = ChangeState
triggerall = AILevel
triggerall = Anim=2000 && time>=48
trigger1 = ((EnemyNear,vel x>0)||(EnemyNear,Movetype=A) || (EnemyNear,Movetype=I))
trigger2 = time >= 148
value = 2040
ctrl = 0

;-----------------------------

;Shoot straight
[Statedef 2040]
type = S
physics = S
movetype = A
anim = 2040
ctrl = 0
velset = 0,0
sprpriority = 1
 
[State 2040, 1];voice
type = PlaySnd
;triggerall = var(55)=2		;Voice=Custom Corey Holland
trigger1 = time = 0
value = 2300,1
channel = 0

[State 2040, Charge lightning FX]
type = RemoveExplod
trigger1 = !time
ID = 20060

[State 2040, nhb]
type = NotHitBy
trigger1 = var(26)=0 && time<4
time = 1
value = SCA

[State 2040, width]
type=width
trigger1 = 1
value = 25,0

[state 2040, remove charge FX]
type = removeexplod
trigger1 = !time
ID = 20150

[state 2040, Smoke FX]
type = explod
trigger1 = !time
anim = 1206+(var(2)=0)
id = 1206
pos = -25,3
postype = P1
sprpriority = 3
ownpal = 1
removetime = -2
persistent = 0
ignorehitpause = 1

[State 2040, masenko]
type = helper
trigger1 = !time
helpertype = normal
stateno = 2031
ID = 2031
name = "masenko lvl 2"
postype = p1
pos = 43,-60
ownpal = 1
;size.xscale = 1.1
;size.yscale = 1.1

[State 2040, ChangeAnim]
type = ChangeAnim
trigger1 = Time >= 30
value = 2041
ignorehitpause = 1
persistent = 0

[State 2040, end]
type = changestate
triggerall = Anim = 2041
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;-----------------------------
;Shoot up
[Statedef 2050]
type = S
physics = S
movetype = A
anim = 2050
ctrl = 0
velset = 0,0
sprpriority = 1

[State 2050, 1];voice
type = PlaySnd
;triggerall = var(55)=2		;Voice=Custom Corey Holland
trigger1 = time = 0
value = 2300,1
channel = 0

[State 2050, Charge lightning FX]
type = RemoveExplod
trigger1 = !time
ID = 20060

[State 2050, nhb]
type = NotHitBy
trigger1 = var(26)=0 && time<4
time = 1
value = SCA

[State 2050, width]
type=width
trigger1 = 1
value = 25,0

[state 2050, remove charge FX]
type = removeexplod
trigger1 = !time
ID = 20150

[state 2050, Smoke FX]
type = explod
trigger1 = !time
anim = 1206+(var(2)=0)
id = 1206
pos = -25,3
postype = P1
sprpriority = 3
ownpal = 1
removetime = -2
persistent = 0
ignorehitpause = 1

[state 2050, Flash FX]
type = null ;explod
trigger1 = !time
anim = 2005
id = 2005
pos = 0,0
postype = P1
sprpriority = 3
ownpal = 1
removetime = -2
persistent = 0
ignorehitpause = 0

[State 2050, masenko]
type = helper
trigger1 = !time
helpertype = normal
stateno = 2041
ID = 2041
name = "masenko_up lvl 2"
postype = p1
pos = 25,-105
ownpal = 1
;size.xscale = 1.1
;size.yscale = 1.1

[State 2050, ChangeAnim]
type = ChangeAnim
trigger1 = Time >= 30
value = 2051
ignorehitpause = 1
persistent = 0


[State 2050, end]
type = changestate
triggerall = Anim = 2051
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;===========================================================================
; <<<<< CHOU MASENKO LVL 2>>>>>
; Charge		state	= 2300
; Launch straight	state	= 2310
; Launch up	state	= 2320
; Helper straight	Masenko	= 2311 
; Helper upwards	Masenko	= 2321
;===========================================================================

;LVL 2 Chou Masenko
[Statedef 2300]
type = S
physics = S
movetype = A
anim = 2000
ctrl = 0
velset = 0,0
sprpriority = 1
poweradd = -2000;IfElse(fvar(27)>0,0,-2000)	;if Destiny mode activated, 0, if not -2000

[State 2300]
type = nothitby
trigger1 = time < 48
value = SCA

[State 650, Fill Destiny Gauge - Hit - EX]
type		= null;VarAdd
trigger1		= fvar(27)>0
fvar(28)		= -200;IfElse(fvar(28)+30 > 300, 300-fvar(28), 30)
persistent	= 0
ignorehitpause	= 1
[State 3000, if Destiny bar = 0]
type = null;VarSet
trigger1 = fvar(28) <= 0
fvar(27)=0

[State 3000, Supermoves counter for Destiny mode] ;it counts for two moves instead of one
type = null;VarAdd
trigger1 = Time = 0 && fvar(27)>0
fvar(31)=1
persistent = 0
[State 3000, Three or more moves, Destiny mode ends]
type = null;VarSet
trigger1 = !time && fvar(31)>=3
fvar(27)=0

[State 3000, width]
type = width
trigger1 = 1
value = 25,0

[State 3000, reset var]
type = VarSet
trigger1 = !time
var(19) = 0
[State 3000, remember Destiny mode]
type = null;VarSet
trigger1 = !time && fvar(27)>0
var(19) = 1
;[State 3000, cancel Destiny mode]
;type = VarSet
;trigger1 = !time
;fvar(27)=0

[State 0, AssertSpecial]
type = AssertSpecial
trigger1 = time = [0,48]
flag = noFG

[State 200, 1];voice
type = PlaySnd
;triggerall = var(55)=2		;Voice=Custom Corey Holland
trigger1 = time = 0
value = 2300,0
channel = 0

[State 1000, shake]
type = EnvShake
trigger1 = !(time%4)
time=4
freq=80
ampl=1.5+0.02*time

[State 200, SuperPause sound]
type = PlaySnd
trigger1 = time=5
value = 2350,0

[State 3000, SuperPause]
type = SuperPause
trigger1 = time=5
time = 40
p2defmul = 1
unhittable = 1
anim = -1
darken = 0
movetime = 40

[State 0, Hyper Charge FX]
type = Explod
trigger1 = time = 5
anim = 2442
id = 2440
pos = -7,-109
postype = p1
supermovetime = 9999
pausemovetime = 9999
supermove = 1
removetime = -2
sprpriority = 6
ownpal = 1
bindtime = -1
scale = 1,1
persistent = 0

[State 2500, bgpalfx1]
type = bgpalfx
trigger1 = !time
time = 48
color=0
mul=0,0,0

[State 0, Charge Ball FX]
type = Explod
trigger1 = time = 5
anim = 2015
id = 2015
pos = -7,-109
postype = p1
supermovetime = 9999
pausemovetime = 9999
supermove = 1
removetime = -1
sprpriority = 5
ownpal = 1
bindtime = -1
scale = 1,1 ;1.5,1.5
persistent = 0

[State 0, Charge lightning FX]
type = Explod
triggerall = var(19) = 1  ;if Destiny mode
trigger1 = time = 5
anim = 2006
id = 2006
pos = -10,0
postype = p1
supermovetime = 9999
pausemovetime = 9999
supermove = 1
removetime = -1
sprpriority = 5
ownpal = 1
bindtime = -1
scale = 1,1

[State 0, lightning sound]
type = PlaySnd
triggerall = var(19) = 1  ;if Destiny mode
triggerall = time>=5
trigger1 = gametime%(20) = 0
value = 2400,3
volume = -200
freqmul = .9 + (random/5000.0)

[State 0, Ki Gather FX]
type = Explod
trigger1 = time = 5
anim = 2016   ;2002+10000*(var(2)=0)
id = 2016     ;2002
pos = -7,-109
postype = p1
supermovetime = 9999
pausemovetime = 9999
supermove = 1
removetime = -2  ;43
sprpriority = 6
ownpal = 1
bindtime = -1
scale = 1,1
persistent = 0

[State 200, Masenko charge long]
type = PlaySnd
trigger1 = time = 5
value = 2000,1
channel = 7

;Throw Chou Masenko Up
[State 901, ChangeAnim]
type = ChangeState
triggerall = time>=48 
trigger1 = !AILevel && command="holdup"
trigger2 = AILevel && random < (100 * (AIlevel ** 2 / 64.0))
trigger2 = ((EnemyNear,vel x>0)||(EnemyNear,Movetype=A)|| (EnemyNear,Movetype=I))
trigger2 = (p2bodydist x =[60,120]) && (p2bodydist y =[-180,-60])
value = 2320
ctrl = 0

;Throw Chou Masenko
[State 901, ChangeAnim]
type = ChangeState
trigger1 = time>=48 
value = 2310
ctrl = 0

;-------------------------------
;Shoot straight
[Statedef 2310]
type = S
physics = S
movetype = A
anim = 2310
ctrl = 0
velset = 0,0
sprpriority = 1

[State 0, Charge lightning FX]
type = RemoveExplod
trigger1 = !time
ID = 2006

[State 3000, nhb]
type = NotHitBy
trigger1 = time<=1
;time = 1
value = SCA

[State 3000, width]
type = width
trigger1 = 1
value = 25,0

[state 1215, remove charge FX]
type = removeexplod
trigger1 = !time
ID = 2015

[state 1215, Smoke FX]
type = explod
trigger1 = !time
anim = 1206+(var(2)=0)
id = 1206
pos = -25,3
postype = P1
sprpriority = 3
ownpal = 1
removetime = -2
persistent = 0
ignorehitpause = 1

[State 200, 1];voice
type = PlaySnd
;triggerall = var(55)=2		;Voice=Custom Corey Holland
trigger1 = time = 0
value = 2300,1
channel = 0

[State 0, emo launch sound]
type = PlaySnd
triggerall = var(19) = 1  ;if Destiny mode
trigger1 = !time
value = 2310,0

[State 3000, masenko]
type = helper
trigger1 = !time
helpertype = normal
stateno = 2311
ID = 2311
name = "chou_masenko"
postype = p1
ownpal = 1
size.xscale = 1
;size.yscale = 1.3

[State 0, Charge lightning FX]
type = Explod
triggerall = var(19) = 1  ;if Destiny mode
trigger1 = time = 5
anim = 2312
id = 2312
pos = 35,-60
postype = p1
supermovetime = 9999
pausemovetime = 9999
ignorehitpause = 1
supermove = 1
removetime = -1
sprpriority = 6
ownpal = 1
bindtime = -1
scale = 1,1

[State 3000, end]
type = changeanim
trigger1 = anim=2310 && time>1 && !numhelper(2311)
value = 2315

[State 3000, end]
type = changestate
trigger1 = anim=2315 && !animtime
value = 0
ctrl = 1

;-------------------------------
;Shoot up
[Statedef 2320]
type = S
physics = S
movetype = A
anim = 2320
ctrl = 0
velset = 0,0
sprpriority = 1

[State 0, Charge lightning FX]
type = RemoveExplod
trigger1 = !time
ID = 2006

[State 3000, nhb]
type = NotHitBy
trigger1 = time<=1
time = 1
value = SCA

[State 3000, width]
type = width
trigger1 = 1
value = 25,0

[state 1215, remove charge FX]
type = removeexplod
trigger1 = !time
ID = 2015

[state 1215, Smoke FX]
type = explod
trigger1 = !time
anim = 1206+(var(2)=0)
id = 1206
pos = -25,3
postype = P1
sprpriority = 3
ownpal = 1
removetime = -2
persistent = 0
ignorehitpause = 1

[State 200, 1];voice
type = PlaySnd
;triggerall = var(55)=2		;Voice=Custom Corey Holland
trigger1 = time = 0
value = 2300,1
channel = 0

[State 0, emo launch sound]
type = PlaySnd
triggerall = var(19) = 1  ;if Destiny mode
trigger1 = !time
value = 2310,0

[State 3000, masenko]
type = helper
trigger1 = !time
helpertype = normal
stateno = 2321
ID = 2321
name = "chou_masenko_up"
postype = p1
ownpal = 1

[State 0, Charge lightning Up FX]
type = Explod
triggerall = var(19) = 1  ;if Destiny mode
trigger1 = time = 5
anim = 2322
id = 2322
pos = 7,-96
postype = p1
supermovetime = 9999
pausemovetime = 9999
ignorehitpause = 1
supermove = 1
removetime = -1
sprpriority = 6
ownpal = 1
bindtime = -1
scale = 1,1

[State 3000, end]
type = changeanim
trigger1 = anim=2320 && time>1 && !numhelper(2321)
value = 2325

[State 3000, end]
type = changestate
trigger1 = anim=2325 && !animtime
value = 0
ctrl = 1


;===========================================================================
; <<<<< CHOU MASENKO LVL 1>>>>>
; Charge		state	= 2330
; Launch straight	state	= 2340
; Launch up	state	= 2350
; Helper straight	Masenko	= 2341 
; Helper upwards	Masenko	= 2351
;===========================================================================

;LVL 1 Chou Masenko
[Statedef 2330]
type = S
physics = S
movetype = A
anim = 2000
ctrl = 0
velset = 0,0
sprpriority = 1
poweradd = -1000;IfElse(fvar(27)>0,0,-1000)

[State 2330]
type = nothitby
trigger1 = time < 48
value = SCA

[State 650, Fill Destiny Gauge - Hit - EX]
type		= null;VarAdd
trigger1		= fvar(27)>0
fvar(28)		= -100;IfElse(fvar(28)+30 > 300, 300-fvar(28), 30)
persistent	= 0
ignorehitpause	= 1
[State 3000, if Destiny bar = 0]
type = null;VarSet
trigger1 = fvar(28) <= 0
fvar(27)=0

[State 3000, Supermoves counter for Destiny mode]
type = null;VarAdd
trigger1 = Time = 0 && fvar(27)>0
fvar(31)=1
persistent = 0
[State 3000, Three or more moves, Destiny mode ends]
type = null;VarSet
trigger1 = !time && fvar(31)>=3
fvar(27)=0

[State 3000, width]
type = width
trigger1 = 1
value = 25,0

[State 3000, reset var]
type = VarSet
trigger1 = !time
var(19) = 0
[State 3000, remember Destiny mode]
type = null;VarSet
trigger1 = !time && fvar(27)>0
var(19) = 1
;[State 3000, cancel Destiny mode]
;type = VarSet
;trigger1 = !time
;fvar(27)=0

[State 0, AssertSpecial]
type = AssertSpecial
trigger1 = time = [0,48]
flag = noFG

[State 200, 1];voice
type = PlaySnd
;triggerall = var(55)=2		;Voice=Custom Corey Holland
trigger1 = time = 0
value = 2000,20+random%2
channel = 0

[State 1000, shake]
type = EnvShake
trigger1 = !(time%4)
time=4
freq=80
ampl=1.5+0.02*time

[State 3000, SuperPause]
type = SuperPause
trigger1 = time=5
time = 40
p2defmul = 1
unhittable = 1
anim = -1
sound = s2000,0
darken = 0
movetime = 40

[State 0, Super FX]
type = Explod
trigger1 = time = 5
anim = 2003
id = 2003
pos = -119,-2
postype = p1
supermovetime = 9999
pausemovetime = 9999
supermove = 1
removetime = -2
sprpriority = 8
ownpal = 1
bindtime = -1
scale = 1,1
persistent = 0

[State 2500, bgpalfx1]
type = bgpalfx
trigger1 = !time
time = 48
color=0
mul=0,0,0

[State 0, Charge Ball FX]
type = Explod
trigger1 = time = 5
anim = 2015
id = 2015
pos = -7,-109
postype = p1
supermovetime = 9999
pausemovetime = 9999
supermove = 1
removetime = -1
sprpriority = 5
ownpal = 1
bindtime = -1
scale = 1,1 ;1.5,1.5
persistent = 0

[State 0, Charge lightning FX]
type = Explod
triggerall = var(19) = 1  ;if Destiny mode
trigger1 = time = 5
anim = 2006
id = 2006
pos = -10,0
postype = p1
supermovetime = 9999
pausemovetime = 9999
supermove = 1
removetime = -1
sprpriority = 5
ownpal = 1
bindtime = -1
scale = 1,1

[State 0, lightning sound]
type = PlaySnd
triggerall = var(19) = 1  ;if Destiny mode
triggerall = time>=5
trigger1 = gametime%(20) = 0
value = 2400,3
volume = -200
freqmul = .9 + (random/5000.0)

[State 0, Ki Gather FX]
type = Explod
trigger1 = time = 5
anim = 2016   ;2002+10000*(var(2)=0)
id = 2016     ;2002
pos = -7,-109
postype = p1
supermovetime = 9999
pausemovetime = 9999
supermove = 1
removetime = -2  ;43
sprpriority = 6
ownpal = 1
bindtime = -1
scale = 1,1
persistent = 0

[State 200, Masenko charge long]
type = PlaySnd
trigger1 = time = 5
value = 2000,1
channel = 6

;Throw Chou Masenko Up
[State 901, ChangeAnim]
type = ChangeState
triggerall = time>=48 
trigger1 = !AILevel && NumExplod(90000008)|| NumExplod(90000007)|| NumExplod(90000009)
trigger2 = AILevel && p2bodydist y = [100,300];random < (200 * (AIlevel ** 2 / 64.0))
trigger2 = ((EnemyNear,vel x>0)||(EnemyNear,Movetype=A)|| (EnemyNear,Movetype=I))
trigger2 = (p2bodydist x =[60,120]) && (p2bodydist y =[-180,-60])
value = 2350
ctrl = 0

;Throw Chou Masenko
[State 901, ChangeAnim]
type = ChangeState
trigger1 = time>=48 
value = 2340
ctrl = 0

;-------------------------------
;Shoot straight
[Statedef 2340]
type = S
physics = S
movetype = A
anim = 2310
ctrl = 0
velset = 0,0
sprpriority = 1

[State 0, Charge lightning FX]
type = RemoveExplod
trigger1 = !time
ID = 2006

[State 3000, nhb]
type = NotHitBy
trigger1 = time<1
;time = 1
value = SCA

[State 3000, width]
type = width
trigger1 = 1
value = 25,0

[state 1215, remove charge FX]
type = removeexplod
trigger1 = !time
ID = 2015

[state 1215, Smoke FX]
type = explod
trigger1 = !time
anim = 1206+(var(2)=0)
id = 1206
pos = -25,3
postype = P1
sprpriority = 3
ownpal = 1
removetime = -2
persistent = 0
ignorehitpause = 1

;[State 200, 1];voice
;type = PlaySnd
;;triggerall = var(55)=2		;Voice=Custom Corey Holland
;trigger1 = time = 0
;value = 2300,1
;channel = 0

[State 0, emo launch sound]
type = PlaySnd
;triggerall = var(19) = 1  ;if Destiny mode
trigger1 = !time
value = 2310,0
channel = 13

[State 3000, masenko]
type = helper
trigger1 = !time
helpertype = normal
stateno = 2341
ID = 2341
name = "chou_masenko_lvl_1"
postype = p1
ownpal = 1
;size.xscale = 0.6
;size.yscale = 1

[State 0, Charge lightning FX]
type = Explod
triggerall = var(19) = 1  ;if Destiny mode
trigger1 = time = 5
anim = 2312
id = 2312
pos = 35,-60
postype = p1
supermovetime = 9999
pausemovetime = 9999
ignorehitpause = 1
supermove = 1
removetime = -1
sprpriority = 6
ownpal = 1
bindtime = -1
scale = 1,1

[State 3000, end]
type = changeanim
trigger1 = anim=2310 && time>1 && !numhelper(2341)
value = 2315

[State 3000, end]
type = changestate
trigger1 = anim=2315 && !animtime
value = 0
ctrl = 1

;-------------------------------
;Shoot up
[Statedef 2350]
type = S
physics = S
movetype = A
anim = 2320
ctrl = 0
velset = 0,0
sprpriority = 1

[State 0, Charge lightning FX]
type = RemoveExplod
trigger1 = !time
ID = 2006

[State 3000, nhb]
type = NotHitBy
trigger1 = time<=1
;time = 1
value = SCA

[State 3000, width]
type = width
trigger1 = 1
value = 25,0

[state 1215, remove charge FX]
type = removeexplod
trigger1 = !time
ID = 2015

[state 1215, Smoke FX]
type = explod
trigger1 = !time
anim = 1206+(var(2)=0)
id = 1206
pos = -25,3
postype = P1
sprpriority = 3
ownpal = 1
removetime = -2
persistent = 0
ignorehitpause = 1

;[State 200, 1];voice
;type = PlaySnd
;;triggerall = var(55)=2		;Voice=Custom Corey Holland
;trigger1 = time = 0
;value = 2300,1
;channel = 0

[State 0, emo launch sound]
type = PlaySnd
triggerall = var(19) = 1  ;if Destiny mode
trigger1 = !time
value = 2310,0
channel = 13

[State 3000, masenko]
type = helper
trigger1 = !time
helpertype = normal
stateno = 2351
ID = 2351
name = "chou_masenko_lvl_1_up"
postype = p1
ownpal = 1
;size.xscale = 0.6
;size.yscale = 1

[State 0, Charge lightning Up FX]
type = Explod
triggerall = var(19) = 1  ;if Destiny mode
trigger1 = time = 5
anim = 2322
id = 2322
pos = 7,-96
postype = p1
supermovetime = 9999
pausemovetime = 9999
ignorehitpause = 1
supermove = 1
removetime = -1
sprpriority = 6
ownpal = 1
bindtime = -1
scale = 1,1

[State 3000, end]
type = changeanim
trigger1 = anim=2320 && time>1 && !numhelper(2351)
value = 2325

[State 3000, end]
type = changestate
trigger1 = anim=2325 && !animtime
value = 0
ctrl = 1


;===========================================================================
; <<<<< SOARING DRAGON STRIKE >>>>>
; Charge = 2100
; Dash = 2105
; On ground = 2110
; P2 state = 2111 (not used)
; Rising and landing = 2115 (anims = 2115,2120,2125)
;===========================================================================

;Soaring DS Charge
[Statedef 2100]
type = S
physics = S
movetype = A
anim = 2100
ctrl = 0
velset = 0,0
sprpriority = 1
poweradd = -1000;IfElse(fvar(27)>0,0,-1000)

[State 650, Fill Destiny Gauge - Hit - EX]
type		= null;VarAdd
trigger1		= fvar(27)>0
fvar(28)		= -100;IfElse(fvar(28)+30 > 300, 300-fvar(28), 30)
persistent	= 0
ignorehitpause	= 1
[State 3000, if Destiny bar = 0]
type = null;VarSet
trigger1 = fvar(28) <= 0
fvar(27)=0

[State 3000, Supermoves counter for Destiny mode]
type = null;VarAdd
trigger1 = Time = 0 && fvar(27)>0
fvar(31)=1
persistent = 0
[State 3000, Three or more moves, Destiny mode ends]
type = null;VarSet
trigger1 = !time && fvar(31)>=3
fvar(27)=0

;[State 2100, HitCount reset (only for supermoves)] ;never use this
;type		= VarSet
;triggerall	= var(39)!=0
;trigger1		= Time = 0
;var(39)		= 0
;persistent	= 0
;ignorehitpause	= 1



[State 3000, width]
type = width
trigger1 = 1
value = 25,0


[State 0, AssertSpecial]
type = AssertSpecial
trigger1 = time = [0,48]
flag = noFG

[State 3000, nhb]
type = NotHitBy
trigger1 = 1
time = 1
value = SCA

[State 1000, shake]
type = EnvShake
trigger1 = !(time%4)
time=4
freq=80
ampl=1.5+0.02*time

[State 220, voice]
type = null ;PlaySnd
;triggerall = var(55)=2		;Voice=Custom Corey Holland
trigger1 = time = 5
value = 2101,3
channel = 0

[State 3000, SuperPause]
type = SuperPause
trigger1 = time=5
time = 40
p2defmul = 1
unhittable = 1
anim = -1
sound = s2000,0
darken = 0
movetime = 0

[State 0, Super FX]
type = Explod
trigger1 = time = 5
anim = 2003
id = 2003
pos = -118,31   ;-102,70
postype = p1
supermovetime = 9999
pausemovetime = 9999
supermove = 1
removetime = -2
sprpriority = 8
ownpal = 1
bindtime = -1
scale = 1,1
persistent = 0

[State 2500, bgpalfx1]
type = bgpalfx
trigger1 = !time
time = 48
color=0
mul=0,0,0

[State 4001, End]
type = ChangeState
trigger1 = !AnimTime
value = 2105
ctrl = 0

;-------------------------------
; Soaring DS Dash
[Statedef 2105]
type    = S
movetype= A
physics = N
ctrl = 0
anim = 2105

[State 2105, PlayerPush]
type = PlayerPush
trigger1 = 1
value = 0
ignorehitpause = 1
;persistent = 


[State 2105, voice]
type = PlaySnd
;triggerall = var(55)=2		;Voice=Custom Corey Holland
trigger1 = !time ;animelemtime(2)=0
value = 2101,4
channel = 0

[State 2105, 1];Speed SFX
type = PlaySnd
trigger1 = animelemtime(2)=0
value = 2100,0
persistent = 0

[State 2105, horizontal dash FX]
type = explod
trigger1 = animelemtime(2)=0
anim = 2704
id = 2704
pos = 40,-45
sprpriority = -1
bindtime = -1
ownpal = 1
removeongethit = 1
ignorehitpause = 1
facing = 1
removetime = -1
supermovetime = 99999
pausemovetime = 99999
scale = 1.2,1.2

[State 2105, 2]
type = VelSet
trigger1 = animelemtime(2)=0
x = 20

[State 2105, 3]
type = VelMul
trigger1 = Time > 5
x = .97

[State 2105, A must for dashes everywhere]
type = Assertspecial
trigger1 = 1
flag = nowalk
[State 2105, No Turn]
type = AssertSpecial
trigger1 = 1
flag = NoAutoTurn

[state 2105, Smoke FX]
type = explod
trigger1 = animelemtime(2)=0
anim = 1206+(var(2)=0)
id = 1206
pos = -25,3
postype = P1
sprpriority = 3
ownpal = 1
removetime = -2
persistent = 0
ignorehitpause = 1

[State 2105, HelpTrain]
type = null ;Helper
trigger1 = Time = 1
name = "Trainee"
ID = 2702
stateno = 2702
pausemovetime = 50

[State 2105, End]
type = ChangeState
trigger1 = abs(P2bodydist X) <= 25
value = 2110
ctrl = 0

[State 2105, NotHitBy]
type = NotHitBy
trigger1 = 1
value = SCA,NP,SP
;value2 = S,NA
time = 1
ignorehitpause = 1
;persistent = 


[State 4001, End]
type = ChangeState
trigger1 = time > 30
value = 101
ctrl = 1

;-------------------------------
; Soaring DS on ground
[Statedef 2110]
type    = S
movetype= A
physics = N
ctrl = 0
anim = 2110
velset = 0,0

[State 4000, pos]
type = PosAdd
trigger1 = !time
X = 20

[State 4000, Invincible]
type = NotHitBy
trigger1 = 1
value = SCA

[State 4000, ToAir]
type = ChangeState
trigger1 = AnimTime = 0
value = 2115
ctrl = 0

;----------------------------
;Enemy Thrown State (SDS)
[Statedef 2111]
type = S
movetype = H
physics = N
velset = 0,0
sprpriority = 1

[State 182, 1]
type = screenbound
trigger1 = 1
movecamera = 1,0
value = 1

[State 802, anim]
type = changeanim2
trigger1 = !time
value = 2111

[State 801, end]
type = selfstate
trigger1 = !animtime
value = 5100
ctrl = 0

;----------------------------
;Rising (actual attack)
[StateDef 2115]
type = A
movetype = A
physics = N
ctrl = 0
anim = 2114
velset = 7,-6

[state 2115, Rising Effect]
type = explod
trigger1 = !time
anim = 1216+var(2)
id = 1216
pos = 10,12
postype = P1
sprpriority = -3
ownpal = 1
removetime = -2
persistent = 0
ignorehitpause = 1

[State 2115, snd]
type = PlaySnd
trigger1 = !time
value = 40,1

[State 2115, 1];Dragon woosh sound
type = PlaySnd
trigger1 = !time
value = 2100,1

[State 2115, AirFriction]
type = VelMul
trigger1 = Vel X != 0
X = .95


;----------------------
[State 1100, hit]
type = hitdef
triggerall = fvar(27) = 0
triggerall = hitcount < 9
trigger1 = NumExplod(2100)<3
trigger1 = !NumExplod(801)
trigger1 = time%2=0
attr = A,HA
damage = Ceil(IfElse(fvar(11) * 22 < 8, 8, fvar(11) * 22)), 4
;Ceil(IfElse(fvar(11) * 22 < 7, 7, fvar(11) * 22)), 4
animtype = Back
guardflag = MA
hitflag = MAF
priority=4,Hit
pausetime= 3,4
guard.pausetime= 6,6
sparkno = s7020
guard.sparkno = s7000
sparkxy = -20+5*(random%4),-120+5*(random%5)
hitsound = s2100,3  ;s5,1
guardsound = s6,1
ground.type=High
ground.slidetime=16
ground.hittime=16
ground.velocity=-1.5,-8
air.type = Low
air.velocity=-1.5,-12
ground.cornerpush.veloff= 0
guard.velocity= -10.52
guard.cornerpush.veloff= -12.74
getpower = 0,0
givepower = 20,20
envshake.time=16
envshake.freq=60
envshake.ampl=4
fall=1
fall.recover=0
airguard.ctrltime= 16
airguard.velocity= -4, -1.5
forcestand=1
airguard.cornerpush.veloff= 0

[State 1100, last hit]
type = hitdef
triggerall = fvar(27) = 0
triggerall = hitcount = 9
trigger1 = !NumExplod(2100)
trigger1 = !NumExplod(801)
trigger1 = 1
attr = A,HA
damage = Ceil(IfElse(fvar(11) * 22 < 10, 10, fvar(11) * 22)), 4
;Ceil(IfElse(fvar(11) * 22 < 7, 7, fvar(11) * 22)), 4
; 22,4
animtype = Back
guardflag = MA
hitflag = MAF
priority=4,Hit
pausetime= 19,20
guard.pausetime= 12,12
sparkno = s7030
guard.sparkno = s7000
sparkxy = -20+5*(random%4),-120+5*(random%5)
hitsound = s5,2
guardsound = s6,1
ground.type=High
ground.slidetime=16
ground.hittime=16
ground.velocity=-3,-12
air.type = Low
air.velocity=-3,-11
ground.cornerpush.veloff= 0
guard.velocity= -10.52
guard.cornerpush.veloff= -12.74
getpower = 0,0
givepower = 20,20
envshake.time=20
envshake.freq=100
envshake.ampl=6
fall=1
fall.recover=0
airguard.ctrltime= 16
airguard.velocity= -4, -1.5
forcestand=1
airguard.cornerpush.veloff= 0
;id = 890

;------------------------
[State 1100, hit]
type = hitdef
triggerall = fvar(27) > 0
triggerall = hitcount < 9
trigger1 = !NumExplod(2100)
trigger1 = !NumExplod(801)
trigger1 = time%2=0
;trigger1 = fvar(28) := IfElse(MoveHit,fvar(28) + IfElse(fvar(31)=1, -6, -9), fvar(28)) ;Destiny bar when hitting
attr = A,HA
damage = Ceil(IfElse(fvar(11) * 15 < 7, 7, fvar(11) * 15)), 4
;Ceil(IfElse(fvar(11) * 22 < 7, 7, fvar(11) * 22)), 4
; 22,4
animtype = Back
guardflag = MA
hitflag = MAF
priority=4,Hit
pausetime= 3,4
guard.pausetime= 6,6
sparkno = s7020
guard.sparkno = s7000
sparkxy = -20+5*(random%4),-120+5*(random%5)
hitsound = s2100,3  ;s5,1
guardsound = s6,1
ground.type=High
ground.slidetime=16
ground.hittime=16
ground.velocity=-1.5,-80
air.type = Low
air.velocity=-1.5,-12
ground.cornerpush.veloff= 0
guard.velocity= -10.52
guard.cornerpush.veloff= -12.74
getpower = 0,0
givepower = 20,20
envshake.time=16
envshake.freq=60
envshake.ampl=4
fall=1
fall.recover=0
airguard.ctrltime= 16
airguard.velocity= -4, -1.5
forcestand=1
airguard.cornerpush.veloff= 0
;kill = hitcount > 5
;nochainid = 890

[State 1100, last hit]
type = hitdef
triggerall = fvar(27) > 0
;triggerall = hitcount = 9
trigger1 = !NumExplod(2100)
trigger1 = !NumExplod(801)
trigger1 = hitcount = 9
;trigger1 = fvar(28) := IfElse(MoveHit,fvar(28) + IfElse(fvar(31)=1, -6, -9), fvar(28))	;Destiny bar when hitting
attr = A,HA
damage = Ceil(IfElse(fvar(11) * 15 < 7, 7, fvar(11) * 15)), 4
;Ceil(IfElse(fvar(11) * 22 < 7, 7, fvar(11) * 22)), 4
; 22,4
animtype = Back
guardflag = MA
hitflag = MAF
priority=4,Hit
pausetime= 19,20
guard.pausetime= 12,12
sparkno = s7030
guard.sparkno = s7000
sparkxy = -20+5*(random%4),-120+5*(random%5)
hitsound = s5,2
guardsound = s6,1
ground.type=High
ground.slidetime=16
ground.hittime=16
ground.velocity=-3,-12
air.type = Low
air.velocity=-3,-11
ground.cornerpush.veloff= 0
guard.velocity= -10.52
guard.cornerpush.veloff= -12.74
getpower = 0,0
givepower = 20,20
envshake.time=20
envshake.freq=100
envshake.ampl=6
fall=1
fall.recover=0
airguard.ctrltime= 16
airguard.velocity= -4, -1.5
forcestand=1
airguard.cornerpush.veloff= 0
;id = 890

[State 3000, if Destiny bar = 0]
type = null;VarSet
trigger1 = fvar(28) <= 0
fvar(27)=0

[State 2300, Super BG Proj]
type = NULL;Projectile
triggerall = RoundState = 2
trigger1 = MoveHit = 1
ProjID = 3001    ;Physical attack
projanim = 15999
projremovetime = 1
ignorehitpause=1

[State 250, 1]
type = ChangeAnim
trigger1 = Anim=2114 && hitcount=9
trigger2 = Anim=2114 && Pos Y < -120
value = 2115
;ignorehitpause = 1

;----------------
; Falling

[State 4001, Fall]
type = VelAdd
trigger1 = Anim = [2114,2115]
trigger1 = Pos Y < -80
trigger2 = Anim = 2120
Y = .4

[State 0, AttackDist]
type = AttackDist
trigger1 = Anim = 2120
trigger1 = AnimElemTime(1) >= 0
value = 0

;Limiter
[State 0, Explod]
type = Explod
trigger1 = NumExplod(2100)<2
trigger1 = Vel Y >0
anim = 15999
ID = 2100
bindtime = -1
removeongethit = 1
removetime = -1

[State 4001, Return&Landing]
type = ChangeAnim
trigger1 = Anim = 2115
trigger1 = Vel Y >= 0.0
trigger2 = Anim = 2120
trigger2 = Pos Y = 0
value = Anim+5

[State 0, AttackDist]
type = AttackDist
trigger1 = Anim = 2125
trigger1 = AnimElemTime(1) >= 0
value = 0

[State 4001, StopFwd]
type = VelSet
trigger1 = Vel X = (0,0.4]
X = 0

[State 4001, Stop]
type = VelSet
trigger1 = Vel Y > abs(Pos Y)
Y = 0

[State 4001, Replace]
type = PosSet
trigger1 = Vel Y = 0
Y = 0

[State 4001, ToGround]
type = StateTypeSet
trigger1 = Anim = 2125
persistent = 0
statetype = S
physics = S

[State 17100, Landing Sound]
type = PlaySnd
trigger1 = anim=2125
value = 40, 0
persistent = 0

[state 17100, Landing Effect]
type=explod
trigger1 = Anim = 2125
anim=17100
id=17100
pos=-15,0
postype=P1
sprpriority=-3
ownpal=1
supermovetime=-1
removetime = -2
persistent = 0

[State 4001, End]
type = ChangeState
trigger1 = Anim = 2125
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;===========================================================================
; <<<<< SOARING DRAGON UNLEASHED >>>>>
; Charge = 2200
; Dash = 2205
; On ground = 2210
; Rising and landing = 2215 (anims = 2115,2120,2125)
;===========================================================================

; Soaring DU Charge
[Statedef 2200]
type = S
physics = S
movetype = A
anim = 2100
ctrl = 0
velset = 0,0
sprpriority = 1
poweradd = -2000;IfElse(fvar(27)>0,0,-2000)

[State 650, Fill Destiny Gauge - Hit - EX]
type		= null;VarAdd
trigger1		= fvar(27)>0
fvar(28)		= -200;IfElse(fvar(28)+30 > 300, 300-fvar(28), 30)
persistent	= 0
ignorehitpause	= 1
[State 3000, if Destiny bar = 0]
type = null;VarSet
trigger1 = fvar(28) <= 0
fvar(27)=0

[State 3000, Supermoves counter for Destiny mode]
type = null;VarAdd
trigger1 = Time = 0 && fvar(27)>0
fvar(31)=1
persistent = 0
[State 3000, Three or more moves, Destiny mode ends]
type = null;VarSet
trigger1 = !time && fvar(31)>=3
fvar(27)=0

;[State 2100, HitCount reset (only for supermoves)]
;type		= VarSet
;triggerall	= var(39)!=0
;trigger1		= Time = 0
;var(39)		= 0
;persistent	= 0
;ignorehitpause	= 1

[State 3000, width]
type = width
trigger1 = 1
value = 25,0

[State 0, AssertSpecial]
type = AssertSpecial
trigger1 = time = [0,48]
flag = noFG

[State 3000, nhb]
type = NotHitBy
trigger1 = 1
time = 1
value = SCA

[State 1000, shake]
type = EnvShake
trigger1 = !(time%4)
time=4
freq=80
ampl=1.5+0.02*time

[State 220, voice]
type = null;PlaySnd
triggerall = var(55)=0		;Voice=Japan
trigger1 = time = 5
value = 2101,0
channel = 0

[State 220, voice]
type = null;PlaySnd
triggerall = var(55)=1		;Voice=English
trigger1 = time = 5
value = 2101,2
channel = 0

[State 220, voice]
type = null ;PlaySnd
;triggerall = var(55)=2		;Voice=Custom Corey Holland
trigger1 = time = 5
value = 2102,random%2
channel = 0

[State 200, SuperPause sound]
type = PlaySnd
trigger1 = time=5
value = 2350,0

[State 3000, SuperPause]
type = SuperPause
trigger1 = time=5
time = 40
p2defmul = 1
unhittable = 1
anim = -1
darken = 0
movetime = 0

[State 0, Hyper Charge FX]
type = Explod
trigger1 = time = 5
anim = 2442
id = 2440
pos = -6,-76    ;10,-37
postype = p1
supermovetime = 9999
pausemovetime = 9999
supermove = 1
removetime = -2
sprpriority = 6
ownpal = 1
bindtime = -1
scale = 1,1
persistent = 0

[State 2500, bgpalfx1]
type = bgpalfx
trigger1 = !time
time = 48
color=0
mul=0,0,0

[State 4001, End]
type = ChangeState
trigger1 = !AnimTime
value = 2205
ctrl = 0

;-------------------------------
; Soaring DU Dash
[Statedef 2205]
type    = S
movetype= A
physics = N
ctrl = 0
anim = 2105

[State 2105, PlayerPush]
type = PlayerPush
trigger1 = 1
value = 0
ignorehitpause = 1
;persistent = 

[State 220, voice]
type = PlaySnd
;triggerall = var(55)=2		;Voice=Custom Corey Holland
trigger1 = !time  ;animelemtime(3)=0
value = 2102,2+random%3
channel = 0

[State 4500, 1];Speed SFX
type = PlaySnd
trigger1 = animelemtime(2)=0
value = 2100,0
persistent = 0

[State 3000, nhb]
type = NotHitBy
trigger1 = 1
time = 1
value = SCA

[State 1900, horizontal dash FX]
type = explod
trigger1 = animelemtime(2)=0
anim = 2704
id = 2704
pos = 40,-45
sprpriority = -1
bindtime = -1
ownpal = 1
removeongethit = 1
ignorehitpause = 1
facing = 1
removetime = -1
supermovetime = 99999
pausemovetime = 99999
scale = 1.2,1.2

[State 3005, 2]
type = VelSet
trigger1 = animelemtime(2)=0
x = 25

[State 3005, 3]
type = VelMul
trigger1 = Time > 5
x = .97

[State 100, A must for dashes everywhere]
type = Assertspecial
trigger1 = 1
flag = nowalk
[State 100, No Turn]
type = AssertSpecial
trigger1 = 1
flag = NoAutoTurn

[state 1215, Smoke FX]
type = explod
trigger1 = animelemtime(2)=0
anim = 1206+(var(2)=0)
id = 1206
pos = -25,3
postype = P1
sprpriority = 3
ownpal = 1
removetime = -2
persistent = 0
ignorehitpause = 1

[State 13000, HelpTrain]
type = Helper
trigger1 = Time = 1
name = "Trainee"
ID = 2207
stateno = 2207 
pausemovetime = 50

[State 4001, End]
type = ChangeState
trigger1 = abs(P2bodydist X) <= 30
value = 2210
ctrl = 0

[State 4001, End]
type = ChangeState
trigger1 = time > 30
value = 101
ctrl = 1

;-------------------------------
; Soaring DU on ground
[Statedef 2210]
type    = S
movetype= A
physics = N
ctrl = 0
anim = 2110
velset = 0,0

[State 4000, pos]
type = PosAdd
trigger1 = !time
X = 30

[State 4000, Invincible]
type = NotHitBy
trigger1 = 1
value = SCA

[State 4000, ToAir]
type = ChangeState
trigger1 = AnimTime = 0
value = 2215
ctrl = 0

;----------------------------
;Rising (actual attack)
[StateDef 2215]
type = A
movetype = A
physics = N
ctrl = 0
anim = 2114
velset = 7,-5  ;4,-4

[State 2215, Invincible]
type = NotHitBy
trigger1 = time < 5
value = SCA

[state 2215, Rising Effect]
type = explod
trigger1 = !time
anim = 1216+var(2)
id = 1216
pos = 10,12
postype = P1
sprpriority = -3
ownpal = 1
removetime = -2
persistent = 0
ignorehitpause = 1

[State 2215, snd]
type = PlaySnd
trigger1 = !time
value = 40,1

[State 2215, 1];Dragon woosh Lv2 sound
type = PlaySnd
trigger1 = !time
value = 2100,2

[state 2215, SDU Aura FX]
type = explod
trigger1 = !time
anim = 2116+var(2)
id = 2116
pos = 0,0
postype = P1
sprpriority = 5
ownpal = 1
removetime = -1
persistent = 0
ignorehitpause = 1
removeongethit = 1

[State 2215, AirFriction]
type = VelMul
trigger1 = Vel X != 0
X = .95

;----------------------
[State 2215, hit]
type = hitdef
triggerall = fvar(27) = 0
triggerall = hitcount < 19
trigger1 = NumExplod(2101)<3
trigger1 = !NumExplod(801)
trigger1 = time%2=0
attr = A,HA
damage = Ceil(IfElse(fvar(11) * 19 < 10, 10, fvar(11) * 19)), 2
;Ceil(IfElse(fvar(11) * 19 < 7, 7, fvar(11) * 19)), 2
; 19,2
animtype = Back
guardflag = MA
hitflag = MAF
priority=4,Hit
pausetime= 3,4
guard.pausetime= 6,6
sparkno = s7020
guard.sparkno = s7000
sparkxy = -20+5*(random%4),-120+5*(random%5)
hitsound = s2100,3  ;s5,1
guardsound = s6,1
ground.type=High
ground.slidetime=16
ground.hittime=16
ground.velocity=-1.5,-10
air.type = Low
air.velocity=-1.5,IfElse(hitcount<10,-14,-9);check this out check this out check this out check this out
ground.cornerpush.veloff= 0
guard.velocity= -10.52
guard.cornerpush.veloff= -12.74
getpower = 0,0
givepower = 20,20
envshake.time=16
envshake.freq=60
envshake.ampl=4
fall=1
fall.recover=0
airguard.ctrltime= 16
airguard.velocity= -4, -1.5
forcestand=1
airguard.cornerpush.veloff= 0
kill = hitcount > 10 ;15
;nochainid = 2215

[State 2215, last hit]
type = hitdef
triggerall = fvar(27) = 0
triggerall = hitcount = 19
trigger1 = !NumExplod(2101)
trigger1 = !NumExplod(801)
trigger1 = 1
attr = A,HA
damage = Ceil(IfElse(fvar(11) * 27 < 13, 13, fvar(11) * 27)), 4
;Ceil(IfElse(fvar(11) * 27 < 7, 7, fvar(11) * 27)), 4
; 27,4
animtype = Back
guardflag = MA
hitflag = MAF
priority=4,Hit
pausetime= 19,20
guard.pausetime= 12,12
sparkno = s7030
guard.sparkno = s7000
sparkxy = -20+5*(random%4),-120+5*(random%5)
hitsound = s5,2
guardsound = s6,1
ground.type=High
ground.slidetime=16
ground.hittime=16
ground.velocity=-3,-12
air.type = Low
air.velocity=-3,-11
ground.cornerpush.veloff= 0
guard.velocity= -10.52
guard.cornerpush.veloff= -12.74
getpower = 0,0
givepower = 20,20
envshake.time=20
envshake.freq=100
envshake.ampl=6
fall=1
fall.recover=0
airguard.ctrltime= 16
airguard.velocity= -4, -1.5
forcestand=1
airguard.cornerpush.veloff= 0
;id = 2215

;-------------------------
[State 2215, hit];with Destiny mode activated
type = hitdef
triggerall = fvar(27) > 0
triggerall = hitcount < 19
trigger1 = !NumExplod(2101)
trigger1 = !NumExplod(801)
trigger1 = time%2=0
;trigger1 = fvar(28) := IfElse(MoveHit,fvar(28) + IfElse(fvar(31)=1, -6, -9), fvar(28))	;Destiny bar when hitting
attr = A,HA
damage = Ceil(IfElse(fvar(11) * 14 < 7, 7, fvar(11) * 14)), 2
;Ceil(IfElse(fvar(11) * 19 < 7, 7, fvar(11) * 19)), 2
; 19,2
animtype = Back
guardflag = MA
hitflag = MAF
priority=4,Hit
pausetime= 3,4
guard.pausetime= 6,6
sparkno = s7020
guard.sparkno = s7000
sparkxy = -20+5*(random%4),-120+5*(random%5)
hitsound = s2100,3  ;s5,1
guardsound = s6,1
ground.type=High
ground.slidetime=16
ground.hittime=16
ground.velocity=-1.5,-20
air.type = Low
air.velocity=-1.5,-10
ground.cornerpush.veloff= 0
guard.velocity= -10.52
guard.cornerpush.veloff= -12.74
getpower = 0,0
givepower = 20,20
envshake.time=16
envshake.freq=60
envshake.ampl=4
fall=1
fall.recover=0
airguard.ctrltime= 16
airguard.velocity= -4, -1.5
forcestand=1
airguard.cornerpush.veloff= 0
kill = hitcount > 10 ;15
;nochainid = 2215

[State 2215, last hit];with Destiny mode activated
type = hitdef
triggerall = fvar(27) > 0
;triggerall = hitcount = 19
trigger1 = !NumExplod(2101)
trigger1 = !NumExplod(801)
trigger1 = hitcount = 19
;trigger1 = fvar(28) := IfElse(MoveHit,fvar(28) + IfElse(fvar(31)=1, -6, -9), fvar(28))	;Destiny bar when hitting
attr = A,HA
damage = Ceil(IfElse(fvar(11) * 19 < 9, 9, fvar(11) * 19)), 4
;Ceil(IfElse(fvar(11) * 22 < 7, 7, fvar(11) * 22)), 4
; 22,4
animtype = Back
guardflag = MA
hitflag = MAF
priority=4,Hit
pausetime= 19,20
guard.pausetime= 12,12
sparkno = s7030
guard.sparkno = s7000
sparkxy = -20+5*(random%4),-120+5*(random%5)
hitsound = s5,2
guardsound = s6,1
ground.type=High
ground.slidetime=16
ground.hittime=16
ground.velocity=-3,-12
air.type = Low
air.velocity=-3,-11
ground.cornerpush.veloff= 0
guard.velocity= -10.52
guard.cornerpush.veloff= -12.74
getpower = 0,0
givepower = 20,20
envshake.time=20
envshake.freq=100
envshake.ampl=6
fall=1
fall.recover=0
airguard.ctrltime= 16
airguard.velocity= -4, -1.5
forcestand=1
airguard.cornerpush.veloff= 0
;id = 2215

[State 2300, Super BG Proj]
type = Projectile
triggerall = RoundState = 2
trigger1 = MoveHit = 1
ProjID = 3001    ;Physical attack
projanim = 15999
projremovetime = 1
ignorehitpause=1

[State 2215, if Destiny bar = 0]
type = null;VarSet
trigger1 = fvar(28) <= 0
fvar(27)=0

[State 2215, 1]
type = ChangeAnim
trigger1 = Anim=2114 && hitcount=19
trigger2 = Anim=2114 && Pos Y < -170
value = 2115
;ignorehitpause = 1

;----------------
; Falling

[State 4001, Fall]
type = VelAdd
trigger1 = Anim = [2114,2115]
trigger1 = Pos Y < -150
trigger2 = Anim = 2120
Y = .4

;Limiter
[State 0, Explod]
type = Explod
trigger1 = NumExplod(2101)<2
trigger1 = Vel Y >0
anim = 15999
ID = 2101
bindtime = -1
removeongethit = 1
removetime = -1

[State 4001, Return&Landing]
type = ChangeAnim
trigger1 = Anim = 2115
trigger1 = Vel Y >= 0.0
trigger2 = Anim = 2120
trigger2 = Pos Y = 0
value = Anim+5

; SDU Aura Remove
[State 2115]
type = removeexplod
trigger1 = numexplod(2116)
trigger1 = Anim != [2114,2115]
ID = 2116

[State 4001, StopFwd]
type = VelSet
trigger1 = Vel X = (0,0.4]
X = 0

[State 4001, Stop]
type = VelSet
trigger1 = Vel Y > abs(Pos Y)
Y = 0

[State 4001, Replace]
type = PosSet
trigger1 = Vel Y = 0
Y = 0

[State 4001, ToGround]
type = StateTypeSet
trigger1 = Anim = 2125
persistent = 0
statetype = S
physics = S

[State 17100, Landing Sound]
type = PlaySnd
trigger1 = anim=2125
value = 40, 0
persistent = 0

[state 17100, Landing Effect]
type=explod
trigger1 = Anim = 2125
anim=17100
id=17100
pos=-15,0
postype=P1
sprpriority=-3
ownpal=1
supermovetime=-1
removetime = -2
persistent = 0

[State 4001, End]
type = ChangeState
trigger1 = Anim = 2125
trigger1 = AnimTime = 0
value = 0
ctrl = 1


;===========================================================================
; <<<<< CHOU KAMEHAMEHA >>>>>
; Charge State = 2400
; Throw Kmh : 2400
; Beam helper : 2402
; stop and go to stance : 2403
; Beam counter charge state : 2480
; Beam counter thrown for both players : 2481
; Collision beam helper : 2482
; Both helpers have collided : 2483
;===========================================================================

;Chou Kame- charge
[Statedef 2400]
type = S
physics = S
movetype = A
anim = 2400
ctrl = 0
velset = 0,0
sprpriority = 2
;poweradd = -2000

[state 0, exit unleashed mode]
type = varset
trigger1 = !time
fvar(27) = 0
ignorehitpause = 1

[State 0, HitDef] ;to emo exit lvl0
type = HitDef
trigger1 = fVar(28) = [0,99]
trigger1 = Time = 1
attr = S,HP        ;SCA,NA,SA,HA,NP,SP,HP,NT,ST,HT
hitflag = MAF        ;HLAFD+-
guardflag = MA         ;HLA
pausetime = 0,22
guard.pausetime = 0,0
sparkno		= s-1
guard.sparkno	= s-1
ground.hittime = 0
guard.hittime = 0
air.hittime = 0
guard.dist = 99999
p2facing = 1
id = 3302
kill = 0
guard.kill = 0

[State 0, HitDef] ;to emo exit lvl1
type = HitDef
trigger1 = fVar(28) = [100,199]
trigger1 = Time = 1
attr = S,HP        ;SCA,NA,SA,HA,NP,SP,HP,NT,ST,HT
hitflag = MAF        ;HLAFD+-
guardflag = MA         ;HLA
pausetime = 0,22
guard.pausetime = 0,0
sparkno		= s-1
guard.sparkno	= s-1
ground.hittime = 0
guard.hittime = 0
air.hittime = 0
guard.dist = 99999
p2facing = 1
id = 3301
kill = 0
guard.kill = 0

[State 0, HitDef] ;to emo exit lvl2/3
type = HitDef
trigger1 = fVar(28) = [200,300]
trigger1 = Time = 1
attr = S,HP        ;SCA,NA,SA,HA,NP,SP,HP,NT,ST,HT
hitflag = MAF        ;HLAFD+-
guardflag = MA         ;HLA
pausetime = 0,22
guard.pausetime = 0,0
sparkno		= s-1
guard.sparkno	= s-1
ground.hittime = 0
guard.hittime = 0
air.hittime = 0
guard.dist = 99999
p2facing = 1
id = 3300
kill = 0
guard.kill = 0

[State 0, TargetState]
type = TargetState
triggerall = NumTarget(3300)
trigger1 = anim = 3201 && animelem = 9
value = 3202
ID = 3300
ignorehitpause = 1
persistent = 0

[State 0, ChangeState] ;go to lvl0 emo exit
type = ChangeState
trigger1 = NumTarget(3302)
trigger1 = !target(3302),IsHelper
value = 2405
ctrl = 0
ignorehitpause = 1

[State 0, ChangeState] ;go to lvl1 emo exit
type = ChangeState
trigger1 = NumTarget(3301)
trigger1 = !target(3301),IsHelper
value = 2405
ctrl = 0
ignorehitpause = 1

[State 0, ChangeState] ;go to lvl2 emo exit
type = ChangeState
trigger1 = NumTarget(3300)
trigger1 = !target(3300),IsHelper
value = 3201
ctrl = 0
ignorehitpause = 1

;Lvl0
[State 0, ChangeState]
type = ChangeState
triggerall = fVar(28) = [0,99]
trigger1 = time = 3
value = 2420
ctrl = 0
;anim =
;ignorehitpause = 
;persistent = 

[State 0, VarSet] ;emo exit lvl
type = VarSet
trigger1 = !Time
var(9) = Cond((fvar(28) = [100,199]),1, Cond((fvar(28) = [200,299]),2,3))

[state 0]
type = null;varset
trigger1 = fvar(28) = [200,299]
var(9) = 1

[State 0, for trial]
type = VarSet
trigger1 = !time
var(18) = 1

[State 3000, GOTEN]
type = null;helper
trigger1 = fVar(28) = [200,300]
trigger1 = time = 20
postype = p1
pos = 40,-60
stateno = 3210
ID = 3210
name = "goten"
supermovetime = 999999
pausemovetime = 999999

[State 3000, GOKU]
type = helper
triggerall = !numtarget(3300) && !numtarget(3301)
trigger1 = fVar(28) = 300
trigger1 = time = 43
postype = p1
pos = 0,0
stateno = 4000
ID = 4000
name = "goku"
supermovetime = 999999
pausemovetime = 999999

[State 0, remove Kmh Flash FX]
type = RemoveExplod
trigger1 = !time
ID = 2005
[State 0, remove Kmh Flash FX]
type = RemoveExplod
trigger1 = !time
ID = 2105

[State 3000, width]
type=width
trigger1 = 1
value = 25,0

[State 800, VarSet];Charging time
type = VarSet
trigger1 = !time
var(26) = 0

[State 0, AssertSpecial]
type = AssertSpecial
triggerall = anim = 2400
trigger1 = time = [0,200]
flag = noFG

[State 3000, nhb]
type = NotHitBy
trigger1 = anim = 2400 && var(26) = 0
trigger1 = Time <200
time = 1
value = SCA

[State 1000, shake]
type = EnvShake
triggerall = anim=2400
trigger1 = !(time%4)
time=4
freq=80
ampl=2+0.02*time

[State 200, 1];Voice (Kamehame)
type = null;PlaySnd
triggerall = var(55)=0		;Voice=Japan
triggerall = anim = 2400
trigger1 = time = 0
value = 2400,0
channel = 0
volume = 255

[State 200, 1];Voice (Kamehame)
type = null;PlaySnd
triggerall = var(55)=1		;Voice=English
triggerall = anim = 2400
trigger1 = time = 0
value = 2400,5
channel = 0
volume = 255

[State 200, 1];voice
type = PlaySnd
;triggerall = var(55)=2		;Voice=Custom Corey Holland
triggerall = anim = 2400
trigger1 = time = 0
value = 2400,6+random%2
channel = 0
volume = 255

[State 200, Kmh charge long]
type = PlaySnd
triggerall = anim = 2400
trigger1 = time = 60
value = 2400,1

[State 200, 1];charge power-up sound
type = PlaySnd
trigger1 = time = 5
value = 2400,20
channel = 5

[State 200, electricity]
type = PlaySnd
trigger1 = time > 60
trigger1 = (GameTime%40) = 20
value = 2400,2
volume = 10

[State 2500, bgpalfx1]
type = bgpalfx
triggerall = anim = 2400
trigger1 = time = [3,200]
time = 1
color=0
mul=0,0,0

[State 200, BGPalFX]
type = BGPalFX
trigger1 = time>=200
time = 1
add	= ceil(-256+1.7*Var(26)),ceil(-256+1.7*Var(26)),ceil(-256+1.7*Var(26))
mul	= 256,256,256
invertall = 0
color = 256

[State 200, SuperPause sound]
type = PlaySnd
trigger1 = time=5
value = 2350,0

[State 3000, SuperPause]
type = SuperPause
triggerall = anim = 2400
trigger1 = time=5
time = 192
p2defmul = 1
unhittable = 1
anim = -1
;sound = s2350,0
darken = 0
movetime = 192

[State 0, mouth LOL]
type = Explod
triggerall = anim = 2400
trigger1 = time = 5
anim = 24000
id = 24000
pos = 0,0
postype = p1
supermovetime = 9999
pausemovetime = 9999
supermove = 1
removetime = -1
sprpriority = 2
ownpal = 0
bindtime = -1
scale = 1,1
persistent = 0

[State 0, Hyper Charge FX]
type = null;Explod
triggerall = anim = 2400
trigger1 = time = 5
anim = 2442;2440
id = 2440
pos = -25,-57
postype = p1
supermovetime = 9999
pausemovetime = 9999
supermove = 1
removetime = -2
sprpriority = 6
ownpal = 1
bindtime = -1
scale = 1,1
persistent = 0

[State 0, Charge Ball FX]
type = Explod
triggerall = anim = 2400
trigger1 = time = 5
anim = 2420+10000*(var(2)=0)
id = 2420
pos = -25,-60
postype = p1
supermovetime = 9999
pausemovetime = 9999
supermove = 1
scale = 0.65,0.65
removetime = -1
sprpriority = 3
ownpal = 1
bindtime = -1
persistent = 0

[State 0, Charge lightning FX]
type = Explod
triggerall = anim = 2400
trigger1 = time = 5
anim = 2430
id = 2430
pos = -25,-57
postype = p1
supermovetime = 9999
pausemovetime = 9999
supermove = 1
removetime = -1
sprpriority = 3
ownpal = 1
bindtime = -1
persistent = 0

[State 0,from sky lightning]
type = explod
triggerall = anim = 2400 && time>=45
trigger1 = gametime%(40-var(26)/5) = 0
anim = 2450+random%6
sprpriority = 7
postype = p1
pos = 0,ceil(pos y)
facing = IfElse(random<500,-1,1)
random = 160,0
scale = 1,2
pausemovetime = -1
supermovetime = -1
ownpal = 1

[State 0, lightning sound]
type = PlaySnd
triggerall = anim = 2400 && time>=45
trigger1 = gametime%(40-var(26)/5) = 0
value = 2400,3
volume = -170-(32*numexplod)
freqmul = .9 + (random/5000.0)

[State 1211, BGPalFX]
type = BGPalFX
triggerall = anim = 2400 && time>=45
trigger1 = gametime%(40-var(26)/5) = 0
time = 3
color = 0
invertall = 1

[State 800, VarSet]
type = null;VarAdd
triggerall = Anim=2400 && time>200
trigger1 = !AILevel && ((command = "holdx") || (command = "holdy") || (command = "holdz"))
trigger2 = AILevel
var(26) = 1

;Throw Kmh
[State 901, ChangeAnim]
type = ChangeState
triggerall = !AILevel
trigger1 = Anim=2400 && time>=210
;trigger1 = (command != "holdx") && (command != "holdy") && (command != "holdz")
trigger2 = time >= 350
value = 2401
ctrl = 0
[State 901, ChangeAnim]
type = ChangeState
triggerall = AILevel
trigger1 = Anim=2400 && time>=210
trigger1 = (EnemyNear,vel x>0)||(EnemyNear,Movetype=A)|| (EnemyNear,Movetype=I)
;trigger1 = random < (100 * (AIlevel ** 2 / 64.0))
trigger2 = time >= 350
value = 2401
ctrl = 0

;-----------------------------
;Chou Kame- throwing
[Statedef 2401]
type = S
physics = S
movetype = A
anim = 2401
ctrl = 0
velset = 0,0
sprpriority = 5

[State 0, AttackDist]
type = AttackDist
trigger1 = 1
value = 1000

[state -2, remove charge ball FX Chou Kmh]
type = removeexplod
trigger1 = !time
id = 2420

[State 3000, nhb]
type = NotHitBy
trigger1 = var(26)=0 && time<6
time = 1
value = SCA

[State 800, VarSet];Charging time
type = VarSet
trigger1 = !time
var(25) = floor(var(26)/7.5)

[State 3000, width]
type=width
trigger1 = 1
value = 25,0

[State 200, 1];Voice (Haaa)
type = PlaySnd
trigger1 = time = 0
value = 2401,0
channel = 0
volume = 355

[State 200, 1];Voice (Haaa)
type = PlaySnd
trigger1 = time = 0
value = 2401,5
channel = 0
volume = 355

[State 200, 1];voice (Haaa)
type = PlaySnd
trigger1 = time = 0
value = 2401,6+random%2
channel = 0
volume = 255

[State 200, 1];Launching SFX
type = PlaySnd
trigger1 = time=4
value = 2401,1

[state 1215, Smoke FX]
type = explod
trigger1 = anim=2401 && animelem=3
anim = 1206+(var(2)=0)
id = 1206
pos = -25,3
postype = P1
sprpriority = 6
ownpal = 1
removetime = -2
persistent = 0
ignorehitpause = 1

[State 3000, Kamehameha]
type = helper
trigger1 = anim=2401 && animelem=3
helpertype = normal
stateno = 2402
ID = 2402
name = "ckameha"
postype = p1
pos = 40,-58
ownpal = 1

[State -2, Explod];On hands explod
type = Explod
triggerall = !numexplod(2403)
trigger1 = anim=2401 && animelem=3
anim = 2403
removetime = -1
sprpriority = 4
id = 2403
ownpal = 1
pos = 53,-58
ignorehitpause = 1
pausemovetime = 99999
supermovetime = 99999
bindtime = -1
;scale = 0.5,1

[State -2, Explod];On hands explod
type = ModifyExplod
trigger1 = anim=2401
trigger1 = WinKO && MatchOver
pos = 30,-58
scale = .6,1.5
ID = 2403

[State 3000, Kamehameha FX beam]
type = helper
trigger1 = anim=2401 && animelem=3
helpertype = normal
stateno = 2464
ID = 2464
name = "ckamehaFX_scale_beam"
postype = p1
pos = 47,-58
ownpal = 1

[State 200, 1];Dramatic SFX
type = PlaySnd
trigger1 = WinKO && (p2stateno=5941 || p2stateno=5943)
value = 5941,0
volume = 255
persistent = 0

;Stop
[State 901, ChangeAnim]
type = ChangeState
trigger1 = numhelper(2402)
trigger1 = helper(2402),var(2)=20+var(25)
trigger1 = Anim=2401
trigger2 = time>91 && !MatchOver
trigger3 = time>120 && WinKO && MatchOver
value = 2403
ctrl = 0

;-----------------------------
;Chou Kame- stop
[Statedef 2403]
type = S
physics = S
movetype = A
anim = 2410
ctrl = 0
velset = 0,0
sprpriority = 4

[state 17100,remove FX]
type = removeexplod
trigger1 = !time
id = 2405
[state 17100,remove overlay FX]
type = removeexplod
trigger1 = !time
id = 2908

[state 17100,scale FX]
type = ModifyExplod
trigger1 = numexplod(2403)
scale = 1, IfElse(1-0.05*time<0, 0, 1-0.05*time)
id = 2403
[state 17100,remove FX]
type = removeexplod
trigger1 = !animtime
id = 2403

[State 3000, end]
type = changestate
trigger1 = !animtime
value = 0
ctrl = 1

;---------------------------------------------------------------------------
;Emo Exit LVL1
[statedef 2405]
type = A
movetype = A
physics = N
ctrl = 0
anim = 3201
sprpriority = 2
facep2 = 1

[State 3000, nhb]
type = NotHitBy
trigger1 = 1
time = -1
value = SCA

[State 280, go]
type = VelSet
trigger1 = animelem = 1
y = -6

[State 200, 1];voice
type = PlaySnd
;triggerall = var(55)=2		;Voice=Custom Corey Holland
trigger1 = animelem=1
value = 3,220+random%9
channel = 0

[State 280, go]
type = VelAdd
trigger1 = animelemtime(1) > 0 && animelemtime(8) < 0
Y = 0.5
ignorehitpause = 1

[State 220, land]
type = statetypeset
trigger1 = animelem=8 
statetype = S

[State 280, go]
type = VelSet
trigger1 = animelem = 8
x = 0
y = 0

[State 1, land]
type = PosSet
trigger1 = animelem=8
y = 0

[State 1, go]
type = PosAdd
trigger1 = animelem=9
x = 20

[State 250, wheel kick SFX]
type = PlaySnd
trigger1 = AnimElem = 2
value = 270,0

[State 250, 1]
type = PlaySnd
trigger1 = AnimElem = 8
value = 0, 5

[State 250, 2]
type = HitDef
trigger1 = AnimElem = 9
attr = S, HA
animtype  = diagup
damage = Ceil(IfElse(fvar(11) * 44 < 22, 22, fvar(11) * 44)), 0
;Ceil(IfElse(fvar(11) * 44 < 7, 7, fvar(11) * 44)), 0
;priority = 4, Hit
guardflag = MAF
pausetime = 21,22
guard.pausetime = 22,22
sparkno = s7030
guard.sparkno = s7000
sparkxy = -30,-80
hitsound   = S2604,0
guardsound = S6,1
ground.type = low
ground.slidetime = 30
ground.hittime = 30
ground.velocity = ifelse(facing = enemy,facing,6,-6),-6
air.velocity = ifelse(facing = enemy,facing,4,-4),-4
air.animtype = diagup
getpower= 0,0
givepower = 35,35
yaccel = 0.5
p2facing = 1
fall = 1
fall.recovertime = 45
envshake.time = 40
envshake.freq = 200
envshake.ampl = 10 
kill = 0
id = 2406

[State 0, TargetState]  ;New state
type = TargetState
trigger1 = Numtarget(2406)
trigger1 = movehit = 1
value = 2406
ID = 2406
ignorehitpause = 1
persistent = 0

[State 1, go]
type = PosAdd
trigger1 = animelem=15
x = -20

[State 250, 3]
type = ChangeState
triggerall = Numtarget(2406)
triggerall = target, StateNo = [2406,2408]
triggerall = fVar(28) = [100,199]
trigger1   = AnimTime = 0
value      = 2410
ctrl       = 0

[State 250, 3]
type = ChangeState
triggerall = Numtarget(2406)
triggerall = target, StateNo = [2406,2408]
triggerall = fVar(28) = [0,99]
trigger1   = AnimTime = 0
value      = 2420
ctrl       = 0

[State 250, 3]
type = ChangeState
triggerall = !Numtarget(2406)
trigger1   = AnimTime = 0
value      = 0
ctrl       = 1

;---------------------------------------------------------------------------
;P2 sent to wall by emo exit 1
[statedef 2406]
type = A
movetype = H
physics = N
ctrl = 0
sprpriority = -1
facep2 = 1 

[State 0, NotHitBy]
type = NotHitBy
trigger1 = 1
value = SCA

[State 4005, vel]
type = velset
trigger1 = AnimElemtime(2)=0
x = -14
y = -3
persistent = 0

[State 9011, VelAdd]
type = VelAdd
trigger1 = Pos Y < 0
y = 0.35

[State 13200, Anim]
type = ChangeAnim
trigger1 = Time = 0
value = IfElse(selfanimexist(5052),5052,5030)

[State 2406] ;hit wall
type = ChangeState
trigger1 = BackEdgeBodyDist <= 15
trigger2 = FrontEdgeBodyDist <= 15
value = 2407

[state 1060, changestate]
type = selfstate
trigger1 = pos Y >= 0 && Vel Y > 0
value = 5100

;---------------------------------------------------------------------------
;P2 hitting wall
[statedef 2407]
type = A
movetype = H
physics = N
velset = 0,0

[State 0, NotHitBy]
type = NotHitBy
trigger1 = 1
value = SCA

[state 0, envshake]
type = envshake
trigger1 = time = 2
time = 15
freq = 100
ampl = 8

[State 0, ChangeAnim2]
type = ChangeAnim2
trigger1 = !Time
value = 2407

[State 1030, 1]
type = PlaySnd
trigger1 = !time
value = 5,5
channel = 1

[state 2408, slide down wall]
type = changestate
trigger1 = time > 16
value = 2408

;-----------------------------------------------------------------------------------------
;Slide from wall
[statedef 2408]
type = A
movetype = H
physics = N
ctrl = 0
sprpriority = 2

[state 3270, hitadd]
type = hitadd
trigger1 = time 
value = 1

[state 1020, velset]
type = velSet
trigger1 = time >= 0
y = time/25

[state 1006, position]
type = posSet
trigger1 = (Pos y >= 0) && (Vel y > 0)
y = 0


;---------------------------------------------------------------------------
;Gohan charging lvl1 emo exit
[statedef 2410]
type = S
physics = S
movetype = A
anim = 2400
ctrl = 0
velset = 0,0
sprpriority = 1

[State 3000, width]
type = width
trigger1 = 1
value = 25,0

[State 800, VarSet];Charging time
type = VarSet
trigger1 = !time
var(26) = 0

[State 0, AssertSpecial]
type = AssertSpecial
triggerall = anim = 2400
trigger1 = time = [0,200]
flag = noFG

[State 3000, nhb]
type = NotHitBy
trigger1 = anim = 2400 && var(26) = 0
trigger1 = Time <200
time = 1
value = SCA

[State 1000, shake]
type = EnvShake
triggerall = anim=2400
trigger1 = !(time%4)
time=4
freq=80
ampl=2+0.02*time

[State 200, 1];voice
type = PlaySnd
triggerall = anim = 2400
trigger1 = time = 0
value = 2400,6+random%2
channel = 0
volume = 255

[State 200, Kmh charge long]
type = PlaySnd
triggerall = anim = 2400
trigger1 = time = 60
value = 2400,1

[State 200, 1];charge power-up sound
type = PlaySnd
trigger1 = time = 5
value = 2400,20
channel = 5

[State 200, electricity]
type = PlaySnd
trigger1 = time > 60
trigger1 = (GameTime%40) = 20
value = 2400,2
volume = 10

[State 2500, bgpalfx1]
type = bgpalfx
triggerall = anim = 2400
trigger1 = time = [1,200]
time = 1
color=0
mul=0,0,0

[State 200, BGPalFX]
type = BGPalFX
trigger1 = time>=200
time = 1
add	= ceil(-256+1.7*Var(26)),ceil(-256+1.7*Var(26)),ceil(-256+1.7*Var(26))
mul	= 256,256,256
invertall = 0
color = 256

[State 200, SuperPause sound]
type = PlaySnd
trigger1 = time=3
value = 2350,0

[State 3000, SuperPause]
type = SuperPause
triggerall = anim = 2400
trigger1 = time=3
time = 200
p2defmul = 1
unhittable = 1
anim = -1
;sound = s2350,0
darken = 0
movetime = 200

[State 0, mouth LOL]
type = Explod
triggerall = anim = 2400
trigger1 = time = 3
anim = 24000
id = 24000
pos = 0,0
postype = p1
supermovetime = 9999
pausemovetime = 9999
supermove = 1
removetime = -1
sprpriority = 2
ownpal = 0
bindtime = -1
scale = 1,1
persistent = 0

[State 0, Charge Ball FX]
type = Explod
triggerall = anim = 2400
trigger1 = time = 3
anim = 2420+10000*(var(2)=0)
id = 2420
pos = -25,-60
postype = p1
supermovetime = 9999
pausemovetime = 9999
supermove = 1
removetime = -1
sprpriority = 5
ownpal = 1
bindtime = -1
scale = 0.64,0.64
persistent = 0

[State 0, Charge lightning FX]
type = Explod
triggerall = anim = 2400
trigger1 = time = 3
anim = 2430
id = 2430
pos = -25,-57
postype = p1
supermovetime = 9999
pausemovetime = 9999
supermove = 1
removetime = -1
sprpriority = 5
ownpal = 1
bindtime = -1
scale = 1,1
persistent = 0

[State 0,from sky lightning]
type = explod
triggerall = anim = 2400 && time>=45
trigger1 = gametime%(40-var(26)/5) = 0
anim = 2450+random%6
sprpriority = 7
postype = p1
pos = 0,ceil(pos y)
facing = IfElse(random<500,-1,1)
random = 160,0
scale = 1,2
pausemovetime = -1
supermovetime = -1
ownpal = 1

[State 0, lightning sound]
type = PlaySnd
triggerall = anim = 2400 && time>=45
trigger1 = gametime%(40-var(26)/5) = 0
value = 2400,3
volume = -170-(32*numexplod)
freqmul = .9 + (random/5000.0)

[State 1211, BGPalFX]
type = BGPalFX
triggerall = anim = 2400 && time>=45
trigger1 = gametime%(40-var(26)/5) = 0
time = 3
color = 0
invertall = 1

;Throw Kmh
[State 901, ChangeAnim]
type = ChangeState
triggerall = !AILevel
trigger1 = Anim=2400 && time>=210
value = 2401
ctrl = 0
[State 901, ChangeAnim]
type = ChangeState
triggerall = AILevel
trigger1 = Anim=2400 && time>=210
trigger1 = (EnemyNear,vel x>0)||(EnemyNear,Movetype=A)|| (EnemyNear,Movetype=I)
trigger1 = random < (100 * (AIlevel ** 2 / 64.0))
value = 2401
ctrl = 0

;KAMEHAMEHA
[Statedef 2420]
type = S
physics = S
movetype = A
anim = 2400
ctrl = 0
velset = 0,0
sprpriority = 1

[State 3000, width]
type=width
trigger1= 1
value=25,0

[State 800, VarSet];Charging time
type = VarSet
trigger1 = !time
var(26) = 0

[State 0, AssertSpecial]
type = AssertSpecial
trigger1 = time = [0,48]
flag = noFG

[State 3000, nhb]
type = nothitby
trigger1 = animelemtime(23) < 0
time = 1
value = SCA

[State 200, 1];voice
type = PlaySnd
triggerall = anim = 2400
trigger1 = time = 0
value = 2400,6+random%2
channel = 0
volume = 255

[State 200, Kmh charge]
type = PlaySnd
trigger1 = time = 10
;trigger2 = time = 30
value = 2000,11
volumescale = 355

[State 3000, superpause]
type = superpause
trigger1 = time=5
time = 40
p2defmul = 1
unhittable = 1
anim = -1
sound = s2000,0
darken = 0
movetime = 40

[State 0, Super FX]
type = Explod
trigger1 = time = 5
anim = 2003
id = 2003
pos = -135,46
postype = p1
supermovetime = 9999
pausemovetime = 9999
supermove = 1
removetime = -2
sprpriority = 8
ownpal = 1
bindtime = -1
scale = 1,1
persistent = 0

[State 0, Charge Ball FX]
type = Explod
trigger1 = time = 5
anim = 2001+10000*(var(2)=0)
id = 2001
pos = -18,-58
postype = p1
supermovetime = 9999
pausemovetime = 9999
supermove = 1
removetime = 43
sprpriority = 5
ownpal = 1
bindtime = -1
scale = 1,1
persistent = 0

[State 0, Ki Gather FX]
type = Explod
trigger1 = time = 5
anim = 2002+10000*(var(2)=0)
id = 2002
pos = -31,-57
postype = p1
supermovetime = 9999
pausemovetime = 9999
supermove = 1
removetime = 43
sprpriority = 6
ownpal = 1
bindtime = -1
scale = 1,1
persistent = 0

[State 200, Kmh charge long]
type = PlaySnd
trigger1 = time = 5
value = 2400,1

[State 2500, bgpalfx1]
type = bgpalfx
trigger1 = !time
time = 48
color=0
mul=0,0,0

;[state 1215, Flash FX]
;type = explod
;trigger1 = anim=2000 && animelemtime(22)=0
;anim = 2005
;id = 2005
;pos = 0,0
;postype = P1
;sprpriority = 3
;ownpal = 1
;removetime = -2
;persistent = 0
;ignorehitpause = 0
;removeongethit= 1
;bindtime = -1

;Throw Kmh
[State 901, ChangeAnim]
type = ChangeState
triggerall = !AILevel
trigger1 = Anim=2400 && time>=40
value = 2421
ctrl = 0
[State 901, ChangeAnim]
type = ChangeState
triggerall = AILevel
trigger1 = Anim=2400 && time>=40
trigger1 = (EnemyNear,vel x>0)||(EnemyNear,Movetype=A)|| (EnemyNear,Movetype=I)
trigger1 = random < (100 * (AIlevel ** 2 / 64.0))
value = 2421
ctrl = 0

;-----------------------------
;KHH LVL0
[Statedef 2421]
type = S
physics = S
movetype = A
anim = 2401
ctrl = 0
velset = 0,0
sprpriority = 5

[State 0, AttackDist]
type = AttackDist
trigger1 = 1
value = 1000

[state -2, remove charge ball FX Chou Kmh]
type = removeexplod
trigger1 = !time
id = 2420

[State 3000, nhb]
type = NotHitBy
trigger1 = var(26)=0 && time<6
time = 1
value = SCA

[State 800, VarSet];Charging time
type = VarSet
trigger1 = !time
var(25) = floor(var(26)/7.5)

[State 3000, width]
type=width
trigger1 = 1
value = 25,0

[State 200, 1];Voice (Haaa)
type = PlaySnd
trigger1 = time = 0
value = 2401,0
channel = 0
volume = 355

[State 200, 1];Voice (Haaa)
type = PlaySnd
trigger1 = time = 0
value = 2401,5
channel = 0
volume = 355

[State 200, 1];voice (Haaa)
type = PlaySnd
trigger1 = time = 0
value = 2401,6+random%2
channel = 0
volume = 255

[State 200, 1];Launching SFX
type = PlaySnd
trigger1 = time=4
value = 2401,1

[state 1215, Smoke FX]
type = explod
trigger1 = anim=2401 && animelem=3
anim = 1206+(var(2)=0)
id = 1206
pos = -25,3
postype = P1
sprpriority = 6
ownpal = 1
removetime = -2
persistent = 0
ignorehitpause = 1

[State 3000, Kamehameha]
type = helper
trigger1 = anim=2401 && animelem=3
helpertype = normal
stateno = 1317
ID = 2421
name = "ckameha"
postype = p1
pos = 50,-62
ownpal = 1

[State -2, Explod];On hands explod
type = Null;Explod
triggerall = !numexplod(2403)
trigger1 = anim=2401 && animelem=3
anim = 2403
removetime = -1
sprpriority = 4
id = 2403
ownpal = 1
pos = 53,-58
ignorehitpause = 1
pausemovetime = 99999
supermovetime = 99999
bindtime = -1
;scale = 0.5,1

[State -2, Explod];On hands explod
type = Null;ModifyExplod
trigger1 = anim=2401
trigger1 = WinKO && MatchOver
pos = 30,-58
scale = .6,1.5
ID = 2403

[State 3000, Kamehameha FX beam]
type = Null;helper
trigger1 = anim=2401 && animelem=3
helpertype = normal
stateno = 2464
ID = 2464
name = "ckamehaFX_scale_beam"
postype = p1
pos = 47,-58
ownpal = 1

[State 200, 1];Dramatic SFX
type = PlaySnd
trigger1 = WinKO && (p2stateno=5941 || p2stateno=5943)
value = 5941,0
volume = 255
persistent = 0

;Stop
[State 901, ChangeAnim]
type = ChangeState
trigger1 = time = 50
value = 2403
ctrl = 0

;===========================================================================
; THUNDER FLURRY KICK
; FIRST HITS: State = 3050
; FINAL HIT: State = 3051
;===========================================================================
[StateDef 3050]
type		= A
movetype	= A
physics		= N
ctrl		= 0
anim		= 3050
juggle		= 0
poweradd	= -1000

[State 2500,voice]
type		= PlaySnd
trigger1	= !Time
value		= 2101,1+random%3
channel		= 0

[State 2500, bgpalfx1]
type		= BGPalFx
trigger1		= time=4
time		= 50
color		= 0
mul		= 0,0,0

[State 2500, SuperPause]
type		= SuperPause
trigger1	= time = 5
time		= 48
p2defmul	= 0
unhittable	= 1
anim		= -1
sound		= s2000,0
darken		= 0
movetime	= 0

[State 2500, Super FX]
type		= Explod
trigger1	= Time = 5
anim		= 2003
id		= 2003
pos		= -106,48
postype		= p1
supermovetime	= 9999
pausemovetime	= 9999
supermove	= 1
removetime	= -2
sprpriority	= 8
ownpal		= 1
bindtime	= -1
scale		= 1,1
persistent	= 0

[State 0, PlaySnd]
type = PlaySnd
trigger1 = AnimElemTime(2)>=0 && AnimElemTime(14)<0
value = 3050,0
persistent = 0


[State 2500, AssertSpecial]
type		= AssertSpecial
trigger1		= time = 5
flag		= noFG

[State 2500, VelIni]
type		= VelSet
trigger1		= Time = 0
X		= 0
Y		= 0

[State 2500, VelIni]
type		= null;VelSet
trigger1 = Var(9) = 1
trigger1		= AnimElem = 2
X		= 7
Y		= 0

[State 2500, VelIni]
type		= null;VelSet
trigger1 = Var(9) = 2
trigger1		= AnimElem = 2
X		= 7
Y		= -4

[State 2500, VelIni]
type		= VelSet
trigger1		= Pos Y < -270
Y		= 0

[State 2500, Flurry Kicks]
type = HitDef
trigger1 = 1
attr = S, HA
hitflag	= MAF
guardflag = MA
animtype = Hard
priority = 5, Hit
damage = Ceil(IfElse(fvar(11) * 13 < 9, 9, fvar(11) * 13)), 3;Ceil(IfElse(fvar(11) * 13 < 8, 8, fvar(11) * 13)), 3
pausetime = 2,2
sparkno	= s7010+10*(random%3) ;s7030
guard.sparkno = s7000
sparkxy	= -8+random%4,-50-random%10;-10,-55
hitsound = s5,10;s5,5
guardsound = s6,0
ground.type = High
ground.slidetime = 22
ground.hittime = 22
guard.hittime = 10
p2facing = 1
ground.velocity = -3,-4
air.type = Low
air.velocity = -8,-4
getpower = 0
envshake.time = 15
envshake.freq = 80
envshake.ampl = 5
fall = 1
air.fall = 1
fall.recover = 0
p2sprpriority = -1
ground.cornerpush.veloff = 0
air.cornerpush.veloff = 0
persistent = 2
id = 3050

[State 2300, Super BG Proj]
type = Projectile
triggerall = RoundState = 2
trigger1 = MoveHit = 1
ProjID = 3001    ;Physical attack
projanim = 15999
projremovetime = 1
ignorehitpause=1

[State 0, PlayerPush]
type = PlayerPush
trigger1 = NumTarget(3050)
value = 1
ignorehitpause = 1

[State 0, TargetBind]
type = TargetBind
trigger1 = NumTarget(3050)
trigger1 = MoveHit
time = 1
id = 3050
pos = 70,0
ignorehitpause = 1

[State 0, AttackDist]
type = AttackDist
trigger1 = AnimElemTime(14) >= 0
value = 0

[State 1400, EndState]
type = ChangeState
trigger1 = !animtime && !movehit
value = IfElse(vel X >= 0,50,116)
ctrl = 0

[State 1400]
type = changestate
trigger1 = movehit && animelemtime(14) >= 2
value = 3051
ctrl = 0

;===========================================================================
;TFK Final Hit
[StateDef 3051]
type = A
movetype = A
physics = N
anim = 1420
ctrl = 0
sprpriority = 2

[State 200, 1];voice
type = PlaySnd
;triggerall = var(55)=2		;Voice=Custom Corey Holland
trigger1 = AnimElem=2
value = 3,220+random%9
channel = 0

[State 200, 1]
type = PlaySnd
trigger1 = animelem = 5
value = 0, 2
channel = 1

[State 200, StateTypeSet]
type = StateTypeSet
trigger1 = AnimElem = 7
movetype = I

[State 640, 2]
type = HitDef
trigger1 = AnimElem = 4
attr = A, HA
damage = Ceil(IfElse(fvar(11) * 80 < 50, 50, fvar(11) * 80)), 6
guardflag = MA
hitflag = MAF
animtype  = Hard
priority = 4,Hit
pausetime = 11,12
sparkno = s7030
guard.sparkno = s7000
sparkxy = -30,-55
hitsound   = s5,6
guardsound = S6,0
ground.type = High
ground.slidetime = 12
ground.hittime  = 15
ground.velocity = -7,-6
air.velocity = -7,-6
envshake.time = 16
envshake.freq = 60
envshake.ampl = 4
pausetime = 10,13
guard.pausetime = 11,12
givepower = 35,35
yaccel = 0.5
fall = 1
fall.recover = 0
id = 3051

[State 2300, Super BG Proj]
type = NULL;Projectile
triggerall = RoundState = 2
trigger1 = MoveHit = 1
ProjID = 3001    ;Physical attack
projanim = 15999
projremovetime = 1
ignorehitpause=1

[State 802, TargetState]
type = TargetState
trigger1 = movehit
trigger1 = numtarget
trigger1 = !(target, ishelper)
value = 3052
ID = 3051
;ignorehitpause = 1
persistent = 0

[State 3051]
type = statetypeset
trigger1 = animelem >= 5
physics = A

[State 0, AttackDist]
type = AttackDist
;trigger1 = Anim = 1100
trigger1 = AnimElemTime(5) >= 0
value = 0

[State 1400, EndState]
type = ChangeState
trigger1 = !animtime
value = 1405
ctrl = 0

;-------------------------------------
;P2 custom state, sent away (Thunder Flurry Kick)
[Statedef 3052]
type = A
movetype = H
physics = N
anim = IfElse(selfanimexist(5052),5052,5030)
velset = -10,-5
ctrl = 0
facep2 = 1

[state 3052] ;pos set if too close to the ground
type = posadd
trigger1 = !time && pos y >= 1
y = -10
persistent = 0

[State 4005, vel]
type = null;velset
trigger1 = AnimElemtime(2)=0
x = -10
y = -5
persistent = 0
 
[State 9011, VelAdd]
type = VelAdd
trigger1 = Pos Y < 0
y = 0.35
 
[State 9011, ChangeState]
type = SelfState
trigger1 = (Pos Y >= 0) && (Vel Y > 0)
value = 5100

;===========================================================================
; <<<<< SUPER THUNDER FLURRY KICK >>>>>
; FIRST HITS: State = 3060
; FINAL HIT: State = 3061
; P2 CUSTOM STATE: State = 3062
;===========================================================================

;Super Thunder Flurry Kick
[statedef 3060]
type		= A
movetype	= A
physics		= N
ctrl		= 0
anim		= 3050
juggle		= 0
poweradd	= -2000

[State 2500,voice]
type		= PlaySnd
trigger1		= !Time
value		= 2101,1+random%3
channel		= 0

[State 2500, bgpalfx1]
type		= BGPalFx
trigger1		= time=4
time		= 50
color		= 0
mul		= 0,0,0

[State 2500, SuperPause]
type		= SuperPause
trigger1		= time = 5
time		= 48
p2defmul		= 0
unhittable	= 1
anim		= -1
sound		= s2000,0
darken		= 0
movetime		= 0

[State 2500, Super FX]
type		= Explod
trigger1		= Time = 5
anim		= 2442
id		= 2440
pos		= 10,-54;-106,48
postype		= p1
supermovetime	= 9999
pausemovetime	= 9999
supermove		= 1
removetime	= -2
sprpriority	= 8
ownpal		= 1
bindtime		= -1
scale		= 1,1
persistent	= 0

[State 0, PlaySnd]
type = PlaySnd
trigger1 = AnimElemTime(2)>=0 && AnimElemTime(14)<0
value = 3050,0
persistent = 0


[State 2500, AssertSpecial]
type		= AssertSpecial
trigger1		= time = 5
flag		= noFG

[State 2500, VelIni]
type		= VelSet
trigger1		= Time = 0
X		= 0
Y		= 0

[State 2500, VelIni]
type		= VelSet
trigger1		= AnimElem = 2
X		= 6
Y		= 0

[State 2500, VelIni]
type		= VelSet
trigger1		= Pos Y < -270
Y		= 0

[State 2500, flurry kicks]
type		= HitDef
trigger1		= 1
attr		= S, HA
hitflag		= MAF
guardflag		= MA
animtype		= Hard
priority		= 5, Hit
damage = Ceil(IfElse(fvar(11) * 31 < 10, 10, fvar(11) * 31)), 3 
pausetime = 2,2
sparkno	= s7010+10*(random%3) ;s7030
guard.sparkno	= s7000
sparkxy	= -8+random%4,-50-random%10;-10,-55
hitsound		= s5,10;s5,5
guardsound	= s6,0
ground.type	= High
ground.slidetime	= 22
ground.hittime	= 22
guard.hittime 	= 10
p2facing		= 1
ground.velocity	= -3,-4
air.type	= Low
air.velocity	= -8,-4
getpower		= 0
envshake.time	= 15
envshake.freq	= 80
envshake.ampl	= 5
fall		= 1
air.fall		= 1
fall.recover	= 0
p2sprpriority	= -1
ground.cornerpush.veloff = 0
air.cornerpush.veloff = 0
persistent = 2
id = 3060

[State 2300, Super BG Proj]
type = Projectile
triggerall = RoundState = 2
trigger1 = MoveHit = 1
ProjID = 3001    ;Physical attack
projanim = 15999
projremovetime = 1
ignorehitpause=1

[State 0, PlayerPush]
type = PlayerPush
trigger1 = NumTarget(3060)
value = 1
ignorehitpause = 1

[State 0, TargetBind]
type = TargetBind
trigger1 = NumTarget(3060)
trigger1 = MoveHit
time = 1
id = 3060
pos = 70,0
ignorehitpause = 1

[State 0, AttackDist]
type = AttackDist
trigger1 = AnimElemTime(14) >= 0
value = 0

[State 1400, EndState]
type = ChangeState
trigger1 = !animtime && !movehit
value = IfElse(vel X >= 0,50,116)
ctrl = 0

[State 1400]
type = changestate
trigger1 = movehit && animelemtime(14) >= 2
value = 3061
ctrl = 0

;---------------------------------------------------------------------------
;TFK LVL2 Final Hit 
[statedef 3061]
type = A
movetype = A
physics = N
anim = 1440
velset = 2,0
ctrl = 0
sprpriority = 2

[State 220, snd]
type = null;PlaySnd
triggerall = var(55)=0		;Voice=Japan
trigger1 = AnimElem=2
value = 3,4+random%4
channel = 0

[State 200, 1];voice
type = null;PlaySnd
triggerall = var(55)=1		;Voice=English
trigger1 = AnimElem=2
value = 3,104+random%4
channel = 0

[State 200, 1];voice
type = PlaySnd
;triggerall = var(55)=2		;Voice=Custom Corey Holland
trigger1 = AnimElem=2
value = 3,220+random%9
channel = 0

[State 650, 2]
type = PlaySnd
trigger1 = AnimElem = 4
value = 0, 5

[State 650, 3]
type = HitDef
trigger1 = AnimElem = 5
attr = A, SA
damage = Ceil(IfElse(fvar(11) * 80.0 < 15, 15, fvar(11) * 40.0)), 6
hitflag = MAF
guardflag = HA
animtype = Hard
priority = 4, Hit
pausetime = 16,17
sparkno = s7030
guard.sparkno = s7000
sparkxy = -30,-55
hitsound   = s5,6
guardsound = S6,0
ground.type = High
ground.slidetime = 12
ground.hittime  = 15
ground.velocity = -5
air.velocity = -2,10
envshake.time = 16
envshake.freq = 60
envshake.ampl = 4
fall = 1
fall.recover = 0
p2facing = 1
airguard.cornerpush.veloff= 0
air.animtype = Back
fall.animtype = Back
givepower = 35,35
yaccel = 0.35
id = 3061

[State 2300, Super BG Proj]
type = Projectile
triggerall = RoundState = 2
trigger1 = MoveHit = 1
ProjID = 3001    ;Physical attack
projanim = 15999
projremovetime = 1
ignorehitpause=1

[State 802, TargetState]
type = TargetState
trigger1 = movehit
trigger1 = numtarget(3061)
trigger1 = !(target, ishelper)
value = 3062
;ignorehitpause = 1
persistent = 0

[State 200, StateTypeSet]
type = StateTypeSet
trigger1 = AnimElem = 6
movetype = I

[State 0, AttackDist]
type = AttackDist
trigger1 = AnimElemTime(6) >= 0
value = 0

[State 1400, Turn]
type = null;Turn
trigger1 = !animtime

[State 1400, EndState]
type = ChangeState
trigger1 = !animtime
value = 1405
ctrl = 0

;------------------------------------------
;P2 going to the ground from TFK LVL2
[Statedef 3062]
type = S
movetype = H
physics = N
ctrl = 0
sprpriority = -1
velset = -3,10

[State 0, NotHitBy]
type = NotHitBy
trigger1 = enemy,NumExplod(1400)>1
value = SCA
time = 1

[State 3020, 2]
type = changeanim2
trigger1 = !time && anim !=651
value = 651

[State 4005, vel Y]
type = null;velset
trigger1 = AnimElemtime(2)=0
y = 10
x = -3

[State 3052, Land]
type = changestate
trigger1 = Pos Y >= 0
trigger1 = Vel Y > 0
value = 652


;===========================================================================
; <<<<< SUPER HURRICANE KICK >>>>>
; State = 2500
;===========================================================================

;Super Hurricane Kick
[StateDef 2500]
type		= A
movetype		= A
physics		= N
ctrl		= 0
anim		= 2500
juggle		= 0
poweradd		= -1000;IfElse(fvar(27)>0,0,-1000)

[State 2500, HitCount add (only for supermoves)]
type		= VarAdd
trigger1		= MoveHit
trigger1		= NumTarget
trigger1		= Target, Time = 0
var(39)		= 1
persistent	= 1
ignorehitpause	= 1

[State 650, Fill Destiny Gauge - Hit - EX]
type		= null;VarAdd
trigger1		= fvar(27)>0
fvar(28)		= -100;IfElse(fvar(28)+30 > 300, 300-fvar(28), 30)
persistent	= 0
ignorehitpause	= 1
[State 3000, if Destiny bar = 0]
type		= null;VarSet
trigger1		= fvar(28) <= 0
fvar(27)		= 0

[State 3000, Supermoves counter for Destiny mode]
type		= null;VarAdd
trigger1		= Time = 0 && fvar(27)>0
fvar(31)		= 1
persistent	= 0
[State 3000, Three or more moves, Destiny mode ends]
type		= null;VarSet
trigger1		= !time && fvar(31)>=3
fvar(27)		= 0

;[State 2100, HitCount reset (only for supermoves)]
;type		= VarSet
;triggerall	= var(39)!=0
;trigger1		= Time = 0
;var(39)		= 0
;persistent	= 0
;ignorehitpause	= 1



[State 2500, AssertSpecial]
type		= AssertSpecial
trigger1		= time = 5
flag		= noFG

[State 2500, VelIni]
type		= VelSet
trigger1		= Time = 0
X		= 0
Y		= 0

[State 2500,voice]
type		= PlaySnd
trigger1		= !Time
value		= 2101,1
channel		= 0

[State 2500, bgpalfx1]
type		= BGPalFx
trigger1		= time=4
time		= 50
color		= 0
mul		= 0,0,0

[State 2500, SuperPause]
type		= SuperPause
trigger1		= time = 5
time		= 48
p2defmul		= 1
unhittable	= 1
anim		= -1
sound		= s2000,0
darken		= 0
movetime		= 0

[State 2500, Player Push]
type		= PlayerPush
trigger1		= 1
value		= 0
ignorehitpause	= 1

[State 2500, nhb]
type		= NotHitBy
trigger1		= Anim = 2500
time		= 1
value		= SCA
ignorehitpause	= 1

[State 2500, Super FX]
type		= Explod
trigger1		= Time = 5
anim		= 2003
id		= 2003
pos		= -136,48
postype		= p1
supermovetime	= 9999
pausemovetime	= 9999
supermove		= 1
removetime	= -2
sprpriority	= 8
ownpal		= 1
bindtime		= -1
scale		= 1,1
persistent	= 0

[State 2500, AnimUp]
type		= ChangeAnim
trigger1		= Anim = 2500
trigger1		= !AnimTime
trigger2		= Anim = 2501
trigger2		= !AnimTime
value		= Anim+1

[State 2500, Voice] ;Shinku Tatsumaki voice; it isn't used.
type		= PlaySnd
triggerall	= var(55) = 1		;Voice=English
trigger1		= Anim = 2501 && AnimElem = 1
value		= 2500,0
channel		= 0
persistent	= 0
volume		= 300

[State 2500, Dust]
type		= Explod
triggerall	= Pos Y > -60
trigger1		= anim = 2501 && AnimElem = 2
trigger2		= anim = 2501 && AnimElem = 14
trigger3		= anim = 2501 && AnimElem = 26
trigger4		= anim = 2501 && AnimElem = 38
anim		= 908+(var(2)=0)
id		= 2501
postype		= P1
pos		= 17, -ceil(pos Y)
sprpriority	= 4
bindtime		= 1
ownpal		= 1
removeongethit	= 1
ignorehitpause	= 1
facing		= -1
removetime	= -2


[State 2500, 1];"Front" kicks movement sound
type		= PlaySnd
triggerall	= Anim = 2501
trigger1		= AnimElem = 2;front
trigger2		= AnimElem = 8;front
trigger3		= AnimElem = 14;front
trigger4		= AnimElem = 20;front
trigger5		= AnimElem = 26;front
trigger6		= AnimElem = 32;front
trigger7		= AnimElem = 38;front
value		= 21, 2
volumescale	= 100
[State 2500, 1];"Back" kicks movement sound
type		= PlaySnd
triggerall	= Anim = 2501
trigger1		= AnimElem = 5	;back
trigger2		= AnimElem = 11	;back
trigger3		= AnimElem = 17	;back
trigger4		= AnimElem = 23	;back
trigger5		= AnimElem = 29	;back
trigger6		= AnimElem = 35	;back
trigger7		= AnimElem = 41	;back
value		= 21, 2
volumescale	= 100
[State 2500, 1];last kick movement sound
type		= PlaySnd
triggerall	= Anim = 2501
trigger1		= AnimElem = 45
value		= 0, 5 ;3+random%3
volumescale	= 85
[State 250, 1];Dragon Roar (last kick movement sound)
type		= PlaySnd
triggerall	= Anim = 2501
trigger1		= AnimElem = 45
value		= 1200,0
volumescale	= 35



[state 2500, Turning Effect front]
type		= Explod
triggerall	= Anim = 2501
trigger1		= AnimElem = 2
trigger2		= AnimElem = 8
trigger3		= AnimElem = 14
trigger4		= AnimElem = 20
trigger5		= AnimElem = 26
trigger6		= AnimElem = 32
trigger7		= AnimElem = 38
anim		= 2505
id		= 2505
pos		= 25,-70
postype		= p1
sprpriority	= 3
ownpal		= 1
supermovetime	= -1
removetime	= -2
persistent	= 1
bindtime		= -1
ignorehitpause	= 0
scale		= 0.8,1
[state 2500, Turning Effect back]
type		= Explod
triggerall	= Anim = 2501
trigger1		= AnimElem = 2
trigger2		= AnimElem = 8
trigger3		= AnimElem = 14
trigger4		= AnimElem = 20
trigger5		= AnimElem = 26
trigger6		= AnimElem = 32
trigger7		= AnimElem = 38
anim		= 2506
id		= 2506
pos		= 25,-70
postype		= p1
sprpriority	= -3
ownpal		= 1
supermovetime	= -1
removetime	= -2
persistent	= 1
bindtime		= -1
ignorehitpause	= 0
scale		= 0.8,1

[State 2500, "Front" kicks hits]
type		= HitDef
triggerall = !NumExplod(801)
triggerall	= Anim = 2501
trigger1		= AnimElem = 3
trigger2		= AnimElem = 9
trigger3		= AnimElem = 15
trigger4		= AnimElem = 21
trigger5		= AnimElem = 27
trigger6		= AnimElem = 33
trigger7		= AnimElem = 39
attr		= S, HA
hitflag		= MAF
guardflag		= MA
animtype		= Hard
priority		= 6, Hit
damage = Cond(fVar(27)>0,Ceil(IfElse(fvar(11) * 13 < 7, 7, fvar(11) * 16)),Ceil(IfElse(fvar(11) * 16 < 7, 7, fvar(11) * 16))),3
;Ceil(IfElse(fvar(11) * 16 < 7, 7, fvar(11) * 16)),3
; 16,3    ;20,3
pausetime		= 2,0
sparkno		= s(7020+10*(random%2))
guard.sparkno	= s7000
sparkxy		= -10,-55
hitsound		= s5,5
guardsound	= s6,0
ground.type	= High
ground.slidetime	= 22
ground.hittime	= 22
p2facing		= 1
ground.velocity	= IfElse((P2Dist x!=[-35,35]),20,15),0
air.type		= Low
air.velocity	= IfElse((P2Dist x!=[-35,35]),9,6),IfElse(P2Dist y<(enemy,const(size.mid.pos.y))+60,-1,-3)+vel y     
getpower		= 0
envshake.time	= 16
envshake.freq	= 60
envshake.ampl	= 4
air.fall		= 1
fall		= 0
fall.recover	= 0
p1sprpriority	= 3
forcestand	= 1
persistent	= 1

[State 2500, "Back" kicks hits]
type		= HitDef
triggerall = !NumExplod(801)
triggerall	= Anim = 2501
trigger1		= AnimElem = 6
trigger2		= AnimElem = 12
trigger3		= AnimElem = 18
trigger4		= AnimElem = 24
trigger5		= AnimElem = 30
trigger6		= AnimElem = 36
trigger7		= AnimElem = 42
attr		= S, HA
hitflag		= MAF
guardflag		= MA
animtype		= Hard
priority		= 5, Hit
damage = Cond(fVar(27)>0,Ceil(IfElse(fvar(11) * 13 < 7, 7, fvar(11) * 16)),Ceil(IfElse(fvar(11) * 16 < 7, 7, fvar(11) * 16))),3
;Ceil(IfElse(fvar(11) * 16 < 7, 7, fvar(11) * 16)), 3
; 16,3   ;20,3
pausetime		= 2,0
sparkno		= s(7020+10*(random%2))
guard.sparkno	= s7000
sparkxy		= -10,-55
hitsound		= s5,5
guardsound	= s6,0
ground.type	= High
ground.slidetime	= 22
ground.hittime	= 22
p2facing		= -1
ground.velocity	= IfElse((P2Dist x!=[-35,35]),-20,-15),0
air.type		= Low
air.velocity	= IfElse((P2Dist x!=[-35,35]),-9,-6),IfElse(P2Dist y<(enemy,const(size.mid.pos.y))+60,-1,-3)+vel y
getpower		= 0
envshake.time	= 16
envshake.freq	= 60
envshake.ampl	= 4
fall		= 0
air.fall		= 1
fall.recover	= 0
p1sprpriority	= -1
forcestand	= 1
persistent	= 1

[State 2500, Last kick hit]
type		= HitDef
triggerall = !NumExplod(801)
triggerall	= Anim = 2501
trigger1		= AnimElem = 46
attr		= S, HA
hitflag		= MAF
guardflag		= MA
animtype		= Hard
priority		= 5, Hit
damage = Cond(fVar(27)>0,Ceil(IfElse(fvar(11) * 13 < 7, 7, fvar(11) * 16)),Ceil(IfElse(fvar(11) * 19 < 7, 7, fvar(11) * 19))),3
;Ceil(IfElse(fvar(11) * 19 < 7, 7, fvar(11) * 19)), 3
; 19,3   ;20,3
pausetime		= 14,15
sparkno		= s7030
guard.sparkno	= s7000
sparkxy		= -10,-55
hitsound		= s5,5
guardsound	= s6,0
ground.type	= High
ground.slidetime	= 22
ground.hittime	= 22
p2facing		= 1
ground.velocity	= IfElse((P2Dist x!=[-35,35]),-20,-15),0
air.type		= Low
air.velocity	= IfElse((P2Dist x!=[-35,35]),-15,-8),IfElse(P2Dist y<(enemy,const(size.mid.pos.y))+60,-1,-3)+vel y
getpower		= 0
envshake.time	= 15
envshake.freq	= 80
envshake.ampl	= 5
fall		= 1
air.fall		= 1
fall.recover	= 0
p2sprpriority	= -1

[State 0, AttackDist]
type = AttackDist
trigger1 = Anim = 2501
trigger1 = AnimElemTime(47) >= 0
trigger2 = Anim = 2502
trigger2 = AnimElemTime(1) >= 0
value = 0

[State 2500, AirGravity]
type = StateTypeSet
trigger1 = Anim = 2502
trigger1 = AnimElem = 1
physics = A



;===========================================================================
; <<<<< AIR CHOU KAMEHAMEHA >>>>>
; State = 2600
; Throw state = 2601
;===========================================================================

;Air Chou Kame
[Statedef 2600]
type = A
physics = N
movetype = A
anim = 2600
ctrl = 0
velset = 0,0
sprpriority = 1
poweradd = -2000;IfElse(fvar(27)>0,0,-2000)

[State 2600, No Push Dummy]
type		= Helper
triggerall	= !NumHelper(2650)
trigger1		= !time
name		= "Air Chou Kame - No Push"
id		= 2650
stateno		= 2650
size.ground.back	= Const(size.ground.back) +20
size.ground.front	= Const(size.ground.front) +20
size.height	= Const(size.height) +60
pausemovetime	= 99999
supermovetime	= 99999

[State 2600, No Push]
type		= PlayerPush
trigger1		= 1
value		= 0
ignorehitpause	= 1

[State 650, Fill Destiny Gauge - Hit - EX]
type		= null;VarAdd
trigger1		= fvar(27)>0
fvar(28)		= -200;IfElse(fvar(28)+30 > 300, 300-fvar(28), 30)
persistent	= 0
ignorehitpause	= 1
[State 3000, if Destiny bar = 0]
type = null;VarSet
trigger1 = fvar(28) <= 0
fvar(27)=0

[State 3000, Supermoves counter for Destiny mode]
type = null;VarAdd
trigger1 = Time = 0 && fvar(27)>0
fvar(31)=1
persistent = 0
[State 3000, Three or more moves, Destiny mode ends]
type = null;VarSet
trigger1 = !time && fvar(31)>=3
fvar(27)=0

;[State 2100, HitCount reset (only for supermoves)]
;type		= VarSet
;trigger1		= var(39)!=0
;var(39)		= 0
;persistent	= 0
;ignorehitpause	= 1

[State 0, for trial]
type = VarSet
trigger1 = !time
var(18) = 1

[State 3000, width]
type = width
trigger1 = 1
value = 20,0

[State 800, VarSet];Charging time
type = VarSet
trigger1 = !time
var(26) = 0

[State 0, AssertSpecial]
type = AssertSpecial
triggerall = anim = 2600
trigger1 = time = [0,200]
flag = noFG

[State 3000, nhb]
type = NotHitBy
trigger1 = anim = 2600 && var(26) = 0
trigger1 = Time <200
time = 1
value = SCA

[State 1000, shake]
type = EnvShake
triggerall = anim=2600
trigger1 = !(time%4)
time=4
freq=80
ampl=2+0.02*time

[State 200, 1];Voice (Kamehame)
type = null;PlaySnd
triggerall = var(55)=0		;Voice=Japan
triggerall = anim = 2600
trigger1 = time = 0
value = 2400,0
channel = 0
volume = 255

[State 200, 1];Voice (Kamehame)
type = null;PlaySnd
triggerall = var(55)=1		;Voice=English
triggerall = anim = 2600
trigger1 = time = 0
value = 2400,5
channel = 0
volume = 255

[State 200, 1];voice
type = PlaySnd
;triggerall = var(55)=2		;Voice=Custom Corey Holland
triggerall = anim = 2600
trigger1 = time = 0
value = 2400,6+random%2
channel = 0
volume = 255

[State 200, Kmh charge long]
type = PlaySnd
triggerall = anim = 2600
trigger1 = time = 60
value = 2400,1

[State 200, 1];charge power-up sound
type = PlaySnd
trigger1 = time = 5
value = 2400,20
channel = 5

[State 200, electricity]
type = PlaySnd
trigger1 = time > 60
trigger1 = (GameTime%40) = 20
value = 2400,2
volume = 10

[State 2500, bgpalfx1]
type = bgpalfx
triggerall = anim = 2600
trigger1 = time = [1,200]
time = 1
color=0
mul=0,0,0

[State 200, BGPalFX]
type = BGPalFX
trigger1 = time>=200
time = 1
add	= ceil(-256+1.7*Var(26)),ceil(-256+1.7*Var(26)),ceil(-256+1.7*Var(26))
mul	= 256,256,256
invertall = 0
color = 256

[State 200, SuperPause sound]
type = PlaySnd
trigger1 = time=5
value = 2350,0

[State 3000, SuperPause]
type = SuperPause
triggerall = anim = 2600
trigger1 = time=5
time = 192
p2defmul = 1
unhittable = 1
anim = -1
darken = 0
movetime = 192

[State 0, mouth LOL]
type = Explod
triggerall = anim = 2600
trigger1 = time = 5
anim = 24000
id = 24000
pos = 7,-11
postype = p1
supermovetime = 9999
pausemovetime = 9999
supermove = 1
removetime = -1
sprpriority = 2
ownpal = 1
bindtime = -1
scale = 1,1
persistent = 0

[State 0, Hyper Charge FX]
type = Explod
triggerall = anim = 2600
trigger1 = time = 5
anim = 2442
id = 2440
pos = -21,-80
postype = p1
supermovetime = 9999
pausemovetime = 9999
supermove = 1
removetime = -2
sprpriority = 6
ownpal = 1
bindtime = -1
scale = 1,1
persistent = 0

[State 0, Charge Ball FX]
type = Explod
triggerall = anim = 2600
trigger1 = time = 5
anim = 2420+10000*(var(2)=0)
id = 2420
pos = -21,-81
postype = p1
supermovetime = 9999
pausemovetime = 9999
supermove = 1
removetime = -1
sprpriority = 5
ownpal = 1
bindtime = -1
scale = 0.6,0.6
persistent = 0

[state 17100, scale charge FX]
type = ModifyExplod
trigger1 = numexplod(2420)
scale = 0.6+0.002*(time-20),0.6+0.002*(time-20)
id = 2420

[State 0, Charge lightning FX]
type = Explod
triggerall = anim = 2600
trigger1 = time = 5
anim = 2430
id = 2430
pos = -17,-78  ;-25,-57
postype = p1
supermovetime = 9999
pausemovetime = 9999
supermove = 1
removetime = -1
sprpriority = 5
ownpal = 1
bindtime = -1
scale = 1,1
persistent = 0

[State 0,from sky lightning]
type = explod
triggerall = anim = 2600 && time>=45
trigger1 = gametime%(40-var(26)/5) = 0
anim = 2450+random%6
sprpriority = 7
postype = p1
pos = 0,-ceil(pos y)
facing = IfElse(random<500,-1,1)
random = 160,0
scale = 1,2+(pos Y < -200)
pausemovetime = -1
supermovetime = -1
ownpal = 1

[State 0, lightning sound]
type = PlaySnd
triggerall = anim = 2600 && time>=45
trigger1 = gametime%(40-var(26)/5) = 0
value = 2400,3
volume = -170-(32*numexplod)
freqmul = .9 + (random/5000.0)

[State 1211, BGPalFX]
type = BGPalFX
triggerall = anim = 2600 && time>=45
trigger1 = gametime%(40-var(26)/5) = 0
time = 3
color = 0
invertall = 1

[State 800, VarSet]
type = VarAdd
triggerall = Anim=2600 && time>200
trigger1 = !AILevel && ((command = "holdx") || (command = "holdy") || (command = "holdz"))
trigger2 = AILevel
var(26) = 1

;Throw Kmh
[State 901, ChangeAnim]
type = ChangeState
triggerall = !AILevel
triggerall = Anim=2600 && time>=200
trigger1 = (command != "holdx") && (command != "holdy") && (command != "holdz")
trigger2 = time >= 350
value = 2601
ctrl = 0
[State 901, ChangeAnim]
type = ChangeState
triggerall = AILevel
triggerall = Anim=2600 && time>=200
trigger1 = (EnemyNear,vel x>0)||(EnemyNear,Movetype=A)|| (EnemyNear,Movetype=I)
trigger1 = random < (150 * (AIlevel ** 2 / 64.0))
trigger2 = time >= 350
value = 2601
ctrl = 0
;-----------------------------
;Air Chou Kame- throw
[Statedef 2601]
type = A
physics = N
movetype = A
anim = 2601
ctrl = 0
velset = 0,0
sprpriority = 1

[State 2600, No Push]
type		= PlayerPush
trigger1		= 1
value		= 0
ignorehitpause	= 1

[state -2, remove charge ball FX Chou Kmh]
type = removeexplod
trigger1 = !time
id = 2420

[State 3000, nhb]
type = NotHitBy
trigger1 = var(26)=0 && time<6
time = 1
value = SCA

[State 800, VarSet];Charging time
type = VarSet
trigger1 = !time
var(25) = floor(var(26)/7.5)

[State 3000, width]
type = width
trigger1 = 1
value = 25,0

[State 200, 1];Voice (Haaa)
type = null;PlaySnd
triggerall = var(55)=0		;Voice=Japan
trigger1 = time = 0
value = 2401,0
channel = 0
volume = 355

[State 200, 1];Voice (Haaa)
type = null;PlaySnd
triggerall = var(55)=1		;Voice=English
trigger1 = time = 0
value = 2401,5
channel = 0
volume = 355

[State 200, 1];voice
type = PlaySnd
;triggerall = var(55)=2		;Voice=Custom Corey Holland
trigger1 = time = 0
value = 2401,6+random%2
channel = 0
volume = 255

[State 200, 1];Launching SFX
type = PlaySnd
trigger1 = time=4
value = 2401,1

[state 1215, Flash FX]
type = null;explod
trigger1 = !time
anim = 2611
id = 2611
pos = 0,0
postype = P1
sprpriority = 3
ownpal = 1
removetime = -1
persistent = 0
ignorehitpause = 1
bindtime = -1

[State 3000, Kamehameha]
type = helper
trigger1 = animelem=1
helpertype = normal
stateno = 2602
ID = 2602
name = "ckameha"
postype = p1
pos = 40,-54
ownpal = 1

[State 3000, Kamehameha FX on hands]
type = helper
trigger1 = animelem=1
helpertype = normal
stateno = 2603
ID = 2603
name = "ckamehaFX_hands"
postype = p1
pos = 47,-54
ownpal = 1

[State 3000, Kamehameha FX beam]
type = helper
trigger1 = animelem=1
helpertype = normal
stateno = 2604
ID = 2604
name = "ckamehaFX_scale_beam"
postype = p1
pos = 47,-54
ownpal = 1

[State 200, 1];Dramatic SFX
type = PlaySnd
trigger1 = WinKO && p2stateno=5946
value = 5941,0
persistent = 0

;Stop
[State 901, ChangeState]
type = ChangeState
trigger1 = numhelper(2602)
trigger1 = helper(2602),var(2)=20+var(25)
trigger1 = Anim=2601
trigger2 = time>91 && !MatchOver
trigger3 = time>120 && WinKO && MatchOver
value = 2610
ctrl = 0

;-----------------------------
;Air Chou Kame- stop
[Statedef 2610]
type = A
physics = A
movetype = I
anim = 2610
ctrl = 0
velset = 0,0
sprpriority = 1

[State 2600, No Push]
type		= PlayerPush
trigger1		= 1
value		= 0
ignorehitpause	= 1

[state 17100,remove FX]
type = removeexplod
trigger1 = !time
id = 2611

[State 2200, vel]
type = velset
trigger1 = !time
x = -1.5
y = -5

[State 4001, End]
type = ChangeState
trigger1 = !AnimTime
value = 50
ctrl = 0



;===========================================================================
; <<<<< GEKIRETSU RANBU >>>>>
; Counter State = 2700
; P1 counter sparks state : 2710
; P2 State - on ground hit : 2715
; 1st attack, SP punch : 2720
; 2nd attack, SK Kick : 2730
; 3rd attack, MK Kick : 2740
; 4th attack, SP punch : 2750
; 5th attack, Teleport then c.SK : 2760
; P2 State - Sent diagonal : 2761
; Gohan out of screen before air dash : 2770 [SEND TO FINISHER 2]
; P2 center of screen : 2775
; 6th attack, a.SP : 2773 [SEND TO FINISHER 1 or 3]
; P2 State - Sent down : 2779
; P2 goes back to ground : 2780
; P2 bouncing on the ground : 2781-2785
; Gohan state - Invisible and waiting : 2790
; Gohan Fall back to ground : 2791
; Ironman pose : 2795
;===========================================================================

; GEKIRETSU RANBU
[Statedef 2700]
type = S
movetype = I
physics = S
facep2 = 1
ctrl = 0
anim = 2700
velset = 0,0
poweradd = IfElse(Fvar(27) = 0, -3000,-2000)

[State 0, NotHitBy]
type = NotHitBy
trigger1 = !Time
value = SCA,NA,SA,HA,NP,SP,HP,NT,ST,HT
;value2 = S,NA
time = 2
;ignorehitpause = 
;persistent = 

[State 0, Combo Version]
Type=ChangeState
triggerall = !time
Trigger1 = numtarget;Fvar(13)!=0
Value=2900

[state 0, remove emo]
type = varset
trigger1 = !time
fvar(27) = 0



[state 0, air version]
type = changeanim
trigger1 = !time && pos y < 0
value = 2702

[state 0, combo ver. indicator] ;for dmg reduction on finishers
type = explod
trigger1 = !numexplod(9992900)
trigger1 = !time && anim=2702
anim = 1
ID = 9992900
removetime = -1
ignorehitpause = 1

[State 1900, dust]
type = explod
trigger1 = anim=2700 && animelemtime(4)=0
anim = 908
;id = 908
pos = 17,5
sprpriority = 4
bindtime = 1
ownpal = 1
supermovetime = 9999
pausemovetime = 9999
removeongethit = 1
ignorehitpause = 1
facing = -1
removetime = -2
persistent = 0

[State 3000, voice]
type = null ;PlaySnd
;triggerall = var(55)=2		;Voice=Custom Corey Holland
trigger1 = anim=2700 && animelemtime(3)=0
value = 2700,5
channel = 0

[State 3000, SFX]
type = PlaySnd
trigger1 = anim=2700 && animelemtime(4)=0
trigger2 = anim=2702 && animelemtime(3)=0
value = 2700,0

[State 3000, Effect]
type = palfx
trigger1 = anim=2700 && animelemtime(4)>=0
trigger2 = anim=2702 && animelemtime(3)=0
time = 1
add = 30,30,50
mul = 256,256,200
sinadd = -5,-5,-5,15

[State 3000, NotHitBy]
type = NotHitBy
trigger1 = anim = 2700
trigger2 = anim=2702
value = SCA,AA,AP
[State 3000, HitBy] ;hit by throws
type = HitBy
trigger1 = anim = 2700
trigger2 = anim=2702
value = SCA,AT

[State 0, Reversal Trigger]
type = reversaldef
trigger1 = 1
attr = S, HA
reversal.attr = SCA,AA
sparkno = -1
sparkxy = 0, 0
hitsound = s850,1
p1stateno = ifelse(anim=2700,ifelse(enemynear,pos y < 0,2730,2710),2730)	;vs air and air version go to final kick
p2stateno = 2715
fall = 1
pausetime = 0,0
numhits = 0
IgnoreHitPause=1

[State 0, AttackDist]
type = AttackDist
trigger1 = Anim = 2701
trigger1 = AnimElemTime(1) >= 0
value = 0

[State 3050, Off]
type = changeanim
trigger1 = animtime = 0
trigger1 = anim = 2700
value = 2701

[state 0, reset unleashed gauge]
type = varset
trigger1 = anim = [2701,2702] 
trigger1 = !animtime
fvar(28) = 0

[state 0, air end]
type = changestate
trigger1 = !animtime
trigger1 = anim = 2702
value = 50
ctrl = 0

[State 3050, End]
type = changestate
trigger1 = animtime = 0
trigger1 = anim = 2701
value = 0
ctrl = 1

;-------------------------------------
;Gohan's State - Counter sparks
[Statedef 2710]
type = S
movetype = A
anim = 2710
physics = N
velset = 0, 0

[State 0, ChangeState]
type = ChangeState
trigger1 = PrevStateNo = 2700
trigger1 = NumTarget
trigger1 = target, IsHelper
value =2900
ctrl = 0


[State 0, AssertSpecial]
type = AssertSpecial
trigger1 = 1;Time < 45
flag = noFG
Flag2 = NoBG
Flag3=NoBarDisplay

[State 0, Width Check]
Type=Width
Trigger1=1
Value=0,0

[State 0, Start On The Ground]
Type=PosSet
Trigger1=!Time && Anim = 2710
Trigger2=Pos Y > 0 && Vel Y > 0
Y=0

[State 250, teleport sound]
type = PlaySnd
TriggerAll=Anim = 2710
trigger1 = AnimElem = 1
trigger2 = AnimElem = 2
value = 2302, 0

[State 4001, Teleport]
type = null;PosAdd
Trigger1=Anim = 2710
trigger1 = AnimElemTime(2) = 0
X = -60
Y = -60
[state 4001, teleport]
type = posset
triggerall = numtarget
trigger1 = anim = 2710
trigger1 = animelemtime(2)=0
x = target,pos x - (ifelse(facing = 1,120,-120))
y = -60

[State 280, go]
type = VelSet
Trigger1=Anim = 2710
trigger1 = animelem = 3
x = -4.75
Y = -6

[State 280, go]
type = VelSet
Trigger1=Anim = 2710
trigger1 = animelem = 6
x = 0
Y = 0

[State 0, Fly Down]
Type=VelSet
Trigger1=Anim = 2710
Trigger1=Pos Y < 0
Trigger1=AnimElem=16
X=18
Y=15
[State 0]
Type=null;PosAdd
Trigger1=Anim = 2710
Trigger1=AnimElemTime(8)>=0
X = (Enemy,Pos X - Pos X) * (.08 * Facing)

[State 3000, voice]
type = PlaySnd
;triggerall = var(55)=2		;Voice=Custom Corey Holland
trigger1 = !time
value = 2700,10+random%4
channel = 0

[State 200, SuperPause sound]
type = PlaySnd
trigger1 = AnimElem = 14
value = 2350,0

[State 0, Hyper Charge FX]
type = Explod
trigger1 = AnimElem = 14
anim = 2440
id = 2440
pos = -25,-57
postype = p1
supermovetime = 9999
pausemovetime = 9999
supermove = 1
removetime = -2
sprpriority = 6
ownpal = 1
bindtime = 1
scale = 1,1
persistent = 0

[State 250, Pause]
type = Pause
trigger1 = !Time; < 45
time = 55;45
movetime = 55;45
ignorehitpause = 1

;--[FX]--
[State 0, Explod]	;Hitspark
type = Explod
Trigger1=Anim = 2710 && AnimElem = 18
Trigger1=P2Dist X < 100
anim =2719
ID = 2719
pos = 0,-60
postype =P2
SuperMoveTime=9999
PauseMoveTime=9999
bindtime = 1
SprPriority = 3
removetime =-2
removeongethit = 0
[State 0, Hit SFX]
Type=PlaySND
Trigger1=Anim = 2710 && AnimElem = 18
Trigger1=P2Dist X < 100
Value=2720,1
[State 0]
Type=EnvShake
Trigger1=Anim = 2710 && AnimElem = 18
Trigger1=P2Dist X < 100
Time=4
Freq=110
Ampl=7
IgnoreHitPause=1
[State 0, Landing Animation]
Type=ChangeAnim
Trigger1=Pos Y >=0 && Vel Y > 0
Trigger1=Anim=2710
Value = 728 
[State 0, Stop Moving On Land]
Type=VelSet
Trigger1=Anim=728
X=0
Y=0
[State 0, Put On Floor]
Type=PosSet
Trigger1=Anim=728
Y=0
[State 3050, End]
type = changestate
;trigger1 = time=48 && anim != 2712
trigger1 = anim = 728 && AnimElem=3
value = 2720

;------------------------------------------------
;P2 Finisher Combo
[Statedef 2715]
type = S
physics = S
movetype = H
sprpriority = 1
ctrl = 0
velset = 0,0

[state 0, nothitby]
type = nothitby
trigger1 = 1
value = SCA
ignorehitpause = 1

[state 0, freeze end of attack anim]
type = changeanim
trigger1 = animtime=-1
value = anim
elem = animelemno(0)

[State 0, Turn Around]
Type=Turn
Trigger1=Time < 30
Trigger1=EnemyNear,Facing = Facing

[State 3020, 2] ;so Gohan can get behind them in the corner
type = PosSet
trigger1 = !time && enemynear,anim=2710
Y = 0
x = ifelse(backedgedist <= 3, pos x + 5*facing, pos x)

;GET HIT
[State 3020, 2] ;1st hit
type = changeanim2
trigger1 = enemynear,anim = 2710 && time = 1
value = 2712
[state 0] ;combo hits
type = changeanim2
triggerall = enemynear,anim = 2711
trigger1 = enemynear,animelemtime(4)=0
trigger2 = enemynear,animelemtime(12)=0
trigger3 = enemynear,animelemtime(18)=0
trigger4 = enemynear,animelemtime(32)=0
value = 2712
[state 0, skipanim]	;skip first frame for last hit
type = changeanim2
triggerall = enemynear,anim = 2711
triggerall = (anim = 2712) && animelem = 1
trigger1 = enemynear,animelemtime(32)=0
value = 2712
elem = 2

;KNOCKBACK
[state 0, dive kick]
type = veladd
trigger1 = enemynear,anim = 2710 && time = 1
x = -5
[state 0, cHK]
type = veladd
trigger1 = enemynear,anim = 2711
trigger1 = enemynear,animelemtime(4)=0
x = -2
[state 0, HP]
type = veladd
trigger1 = enemynear,anim = 2711
trigger1 = enemynear,animelemtime(12)=0
x = -3
[state 0, MP]
type = veladd
trigger1 = enemynear,anim = 2711
trigger1 = enemynear,animelemtime(18)=0
x = -10
[State 0, HKx2]
Type=VelAdd
Trigger1=EnemyNear,Anim = 2711
Trigger1=enemynear,animelem = 33
X=-15

[State 0, Kicked Off Screen]
Type=ChangeState
Trigger1=EnemyNear,Anim = [3300,3301]
Trigger1=EnemyNear,AnimElem = 6
Value=2761

[State 0, Kicked Off Screen]
Type=ChangeState
Trigger1=EnemyNear,StateNo = 3300
Value=3305


;-------------------------
;Finisher Combo
[Statedef 2720]
type    = S
movetype = A
physics = S
anim = 2711
juggle = 0
ctrl = 0
velset = 0,0
facep2 = 1
sprpriority = 2

[State 0, Clear Emo]
Type=VarSet
Trigger1=1
Fv=27
Value=0

[state 0, nothitby]
type = nothitby
trigger1 = 1
value = SCA
ignorehitpause = 1

[state 0, no timeover]
type = assertspecial
trigger1 = 1
flag = timerfreeze
flag2 = nobardisplay

[state 0]
type = width
trigger1 = 1
value = 50,0

;final kick hop
[State 0,hop]
type = statetypeset
trigger1 = animelemtime(24)=0 
statetype = A
[State 0]
type = VelSet
trigger1 = animelem = 24
x = 5
y = -6
[State 0]
type = VelAdd
trigger1 = animelemtime(24) > 0 && animelemtime(31) < 0 && (pos y + vel y <= 0)
Y = 0.8
ignorehitpause = 1
[State 0,land]
type = PosSet
trigger1 = animelem=31 || (pos y + vel y >= 0)
y = 0
[State 0]
type = PosAdd
trigger1 = animelem=32 
x = 20
[State 0]
type = PosAdd
trigger1 = animelem=38
x = -20

[State -2, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = nobardisplay
ignorehitpause = 1

[State 200, 1];voice
type = PlaySnd
;triggerall = var(55)=2		;Voice=Custom Corey Holland
trigger1 = animelem=2
value = 3,220
channel = 0

[state 2720, hit sound]
type = null;playsnd
trigger1 = !time
value = s2720,0

[state 2720, hitadd]
type = hitadd
Trigger1=AnimElem=4
Trigger2=AnimElem=12
Trigger3=AnimElem=18
Trigger4=AnimElem=32
value = 1

;--[FX]--
[State 0, Explod]	;Hitspark
type = Explod
Trigger1=AnimElem=4
Trigger2=AnimElem=12
Trigger3=AnimElem=18
Trigger4=AnimElem=32
anim =2719
ID = 2719
pos = 0,ifelse((animelem=32),-80,-60)
Random = 10,20
postype = P2
SuperMoveTime=9999
PauseMoveTime=9999
bindtime = 1
SprPriority = 3
removetime =-2
removeongethit = 0

[State 0, Hit SFX]
Type=PlaySND
Trigger1=AnimElem=4
Trigger2=AnimElem=12
Trigger3=AnimElem=18
Trigger4=AnimElem=32
Value=2720,1

[State 0]
Type=EnvShake
Trigger1=AnimElem=4
Trigger2=AnimElem=12
Trigger3=AnimElem=18
Time=4
Freq=110
Ampl=7
IgnoreHitPause=1
[state 0, HKx2]
type = envshake
Trigger1=AnimElem=32
time = 10
freq = 110
ampl = 7
ignorehitpause = 1

[State 0, Final Kick]
Type=ChangeState
Trigger1=!AnimTime&&Fvar(28) < 300
Value=2730

[State 0, Final Kick For Lvl 3]
Type=ChangeState
Trigger1=!AnimTime&&Fvar(28) >= 300
Value=3300
;-------------------------
; Finisher Final Kick
[Statedef 2730]
Type=S
MoveType=A
Physics=N
;Anim = 3300
Ctrl=0
VelSet=0,0

[State 0, ChangeState]
type = ChangeState
trigger1 = PrevStateNo = 2700
trigger1 = NumTarget
trigger1 = target, IsHelper
value =2900
ctrl = 0

[state 0, nothitby]
type = nothitby
trigger1 = 1
value = SCA
ignorehitpause = 1

[State 0, clear screen]
Type=AssertSpecial
Trigger1=1
Flag=TimerFreeze
Flag2=NoBarDisplay
;Flag3=NoFG
[State 0]
Type=ScreenBound
Trigger1=1
Value=0
MoveCamera=0,0

[State 0, ChangeState]
type = ChangeState
trigger1 = fvar(28) >= 300
trigger1 = !Time
value = 3300




[State 0, posset]
Type=null;PosSet
Trigger1=!Time && pos y >= 0
Y=0

;--[Version Set]--
[state 0, air version]
type = changeanim
trigger1 = !time && pos y < 0
value = 3301
[state 0, ground version]
type = changeanim
trigger1 = !time && pos y >= 0
value = 3300

;--[Air Version Super Pause]--
[state 0, pause]
type = pause
trigger1 = !time && anim=3301
time = 30
movetime = 30
[State 2500, Black BG]
type = bgpalfx
trigger1 = !time && anim=3301
time = 30
color = 0
mul = 0,0,0
[State 200, SuperPause sound]
type = PlaySnd
trigger1 = !time && anim=3301
value = 2350,0
[State 0, Hyper Charge FX]
type = Explod
trigger1 = !time && anim=3301
anim = 2440
id = 2440
pos = 2,-60
postype = p1
supermovetime = 9999
pausemovetime = 9999
removetime = -2
sprpriority = 6
ownpal = 1
bindtime = 1
scale = 1,1
persistent = 0

[State 0, hitadd]
Type=HitAdd
Trigger1= (Anim=[3300,3301]) && AnimElem=6
Value = 1

;--[First Kick]--
[state 0, teleport]
type = posset
trigger1 = (Anim=[3300,3301]) && animelemtime(2)=2
x = enemynear,pos x - (ifelse(facing=1,50,-50))
y = enemynear,pos y - 20
[State 0]
Type=null;VelSet
Trigger1=Anim = 3300
Trigger1=AnimElem=2
Y=-2
[State 0]
Type=null;PosAdd
Trigger1=Anim = 3300
Trigger1=AnimElemTime(2)>=0 && AnimElemTime(6) < 0
X = (Enemy,Pos X - Pos X) * (.08 * Facing)
[State 0]
Type=VelSet
Trigger1=(Anim=[3300,3301])
Trigger1=AnimElem=6
X=0
Y=0
[State 0]
Type=VelAdd
Trigger1=(Anim=[3300,3301])
Trigger1=AnimElemTime(8)>=0
Y=.05

;--[FX]--
[State 0, Explod]	;Hitspark
type = Explod
Trigger1=(Anim=[3300,3301])
Trigger1=AnimElem=6
anim =2719;7020
ID = 2719;7020
pos = 0,-110
postype =P2
bindtime = 1
SprPriority = 3
removetime =-2
removeongethit = 0
[State 0]
Type=EnvShake
Trigger1=(Anim=[3300,3301])
Trigger1=AnimElem=6
Time=10
Freq=110
Ampl=7
IgnoreHitPause=1

;--[SFX]--
;teleport
[State 0]
type = PlaySnd
trigger1 = (Anim=[3300,3301]) && animelemtime(2)=0
value = 2302, 0
;First Kick
[State 0]
Type=PlaySND
TriggerAll = (Anim=[3300,3301])
Trigger1=AnimElem = 6
Value = 0,5
Channel = 1
VolumeScale = 200
;First Kick
[State 0]
Type=PlaySND
TriggerAll = (Anim=[3300,3301])
Trigger1=AnimElem = 5
Value = 5,6
Channel = 2
VolumeScale = 200
;Fly Up
[State 0]
Type=PlaySND
TriggerAll = (Anim=[3300,3301])
Trigger1=AnimElem = 11
Value = 0,24
Channel = 2
VolumeScale = 200
;--[Fly after P2]--
[State 0]
Type=VelSet
Trigger1=(Anim=[3300,3301])
Trigger1=AnimElem=11
X=30
Y=-20
[State 0]
Type=VelSet
Trigger1=(Anim=[3300,3301])
Trigger1=AnimElemTime(11)>=0
Trigger1=Pos X != [-380,380]
X=0
Y=0
;--[FX]--
[State 0]
Type=PalFX
Trigger1=(Anim=[3300,3301])
Trigger1=AnimElemTime(10)=5
Time=3
Add=255,255,255
Color=0

[State 0, Change To Finisher Selection]
Type=ChangeState
Trigger1 = Time = 100
Value = 2770

;------------------------------------------------
;P2 State - Sent diagonal
[Statedef 2761]
type = A
physics = N
movetype = H
ctrl = 0
velset = 0,0

[state 0, nothitby]
type = nothitby
trigger1 = 1
value = SCA

[State 3020, 2]
type = velset
trigger1 = time=15
X = -20;-16
Y = -20;-16

[State 3020, 2]
type = changeanim2
trigger1 = time = 1 && anim !=2761
value = 2761

[State 1050, 1]
type = sprpriority
trigger1 = 1
value = 1

[State 182, 1]
type = screenbound
trigger1 = 1
movecamera = 0,0
value = 0

[State 3000, state] ;go to center of screen
type = ChangeState
trigger1 = P2StateNo = 2770
value = 2775
ctrl = 0

;-------------------------
; Finisher Selection
[Statedef 2770]
type    = S
movetype = A
physics = N
;anim = 2770
ctrl = 0
velset = 0,0
facep2 = 1
sprpriority = 2

[state 0, nothitby]
type = nothitby
trigger1 = 1
value = SCA

[State 2201, helper]; Background lines
type = Helper
trigger1 = !time
;pos = -320, 350
pos = -170, 200
postype = back
stateno = 2774
helpertype = normal
name = "diagonal_lines_BG"
;id = 2774
ownpal = 1
supermovetime = 150
pausemovetime = 150

[State 2201, helper]; Background lines
type = Helper
trigger1 = !time
;pos = 0, 300
pos = 150, 150
postype = back
stateno = 2774
helpertype = normal
name = "diagonal_lines_BG"
;id = 2774
ownpal = 1
supermovetime = 150
pausemovetime = 150

[State 2260, bg]
type = assertspecial
trigger1 = 1
flag = noFG
flag2 = noBG
flag3 = nobardisplay
ignorehitpause = 1

[State 2260, bg]
type = assertspecial
trigger1 = 1
flag = globalnoshadow
flag2 = noshadow
ignorehitpause = 1

[State 3001, screen]
type = Screenbound
trigger1 = 1
movecamera = 0,0
value = 0

[state 2772, out of screen]
type = posset
trigger1 = !time
x = -300*facing
y = 190

[state 2772, P2 flying in the air]
type = PlaySnd
trigger1 = !time
value = 2907,0

[State 3000, sky belongs to me voice]
type = PlaySnd
triggerall = fvar(28)=[0,99]  ;No finisher
trigger1 = time=44
value = 2700,20
channel = 0
pan=1

[State 0, Backwards Flying]
Type=ChangeAnim
Trigger1=Time=90&&Anim!=2770
Value=2770

[state 2772, teleport to P2]
type = posset
trigger1 = Anim=2770&&AnimElem=1
x = enemy, pos x - 60*facing
y = enemy, pos y - 40

[state 2772, teleport sound]
type = playsnd
trigger1 = Anim=2770&&AnimElem=1
value = 2302,0

[State 13100, Finisher 0 and 2]
type = ChangeState
trigger1 = Time = 112 && Fvar(28) = [0,99]
trigger2 = Time = 112 && Fvar(28) = [200,299]
value = 2773
ctrl = 0

[State 13100, Finisher 1]
type = ChangeState
trigger1 = Time = 112 && Fvar(28) = [100,199]
value =3100
ctrl = 0

;-------------------------
;Finisher 0
[Statedef 2773]
type    = S
movetype = A
physics = N
anim = 2773
ctrl = 0
velset = 0,0
facep2 = 1
sprpriority = 2

[state 0, nothitby]
type = nothitby
trigger1 = 1
value = SCA

[State 2260, bg]
type = assertspecial
trigger1 = 1
flag = noFG
flag2 = noBG
flag3 = nobardisplay
ignorehitpause = 1

[State 2260, bg]
type = assertspecial
trigger1 = 1
flag = globalnoshadow
flag2 = noshadow
ignorehitpause = 1

[State 3001, screen]
type = Screenbound
trigger1 = 1
movecamera = 0,0
value = 0

;--[FX]--
[State 0, Explod]	;Hitspark
type = Explod
Trigger1=AnimElem=5
anim =2719
ID = 2719
pos = 57,-32
postype =P1
bindtime = 1
SprPriority = 3
removetime =-2
removeongethit = 0
[State 0]
Type=EnvShake
Trigger1=AnimElem=5
Time=10
Freq=110
Ampl=7
IgnoreHitPause=1
[State 0, Hit SFX]
Type=PlaySND
Trigger1=AnimElem=5
Value=2604,0

[State 0, damage]
Type=TargetLifeAdd
trigger1 = fvar(28) < 100
trigger1 = !numexplod(9992900)
Trigger1 = AnimElem = 5
Id=-1
Value = -floor(IfElse(fvar(11) * 450 < 225, 225, fvar(11) * 450))
;-floor(IfElse(fvar(11) * 340 < 290, 290, fvar(11) * 340))
Kill=1
[State 0, combo damage]
Type=TargetLifeAdd
trigger1 = fvar(28) < 100
trigger1 = numexplod(9992900)
Trigger1 = AnimElem = 5
Id=-1
Value = -floor(IfElse(fvar(11) * 300 < 150, 150, fvar(11) * 300))
Kill=1

[State 0, Invis]
Type=ChangeState
Trigger1=!AnimTime&&Fvar(28)=[0,99]
Value=2791

[State 0, Finisher 2]
Type=ChangeState
Trigger1=!AnimTime&&Fvar(28)=[200,299]
Value=3000
;------------------------------------
;P2 center of screen
[Statedef 2775]
type = A
movetype = H
physics = N
velset = 0,0
ctrl = 0
sprpriority = 2

[state 0, nothitby]
type = nothitby
trigger1 = 1
value = SCA

[State 2260, bg]
type = assertspecial
trigger1 = 1
flag = globalnoshadow
ignorehitpause = 1

[State 3001, screen]
type = Screenbound
trigger1 = 1
movecamera = 0,0
value = 1

[State 3001, sprpriority]
trigger1 = time = 0
type = SprPriority
value = 2

[State 3001, anim2]
type = Changeanim2
trigger1 = time = 0
value = 2761

[State 3001, PosSet]
type = PosSet
trigger1 = 1
x = (-30+15*(enemy,fvar(28)>=200 && enemy,fvar(28)<300))*facing
y = -30

[State 3001, shake]
type = EnvShake
trigger1 = time = 0
time = 150
freq = 100
ampl = 3

[state 2775, to finisher 1]
type = changestate
trigger1 = enemy, anim = 3100
trigger1 = enemy, animelem = 14
value = 3105

[state 2775]
type = changestate
trigger1 = enemy,anim = 2773
trigger1 = enemy,animelem = 5
value = 2779

;------------------------------------------------
;P2 State - Sent down
[Statedef 2779]
type = A
physics = N
movetype = H
ctrl = 0
anim = 5030
velset = 0,0

[State 2260, bg]
type = assertspecial
trigger1 = 1
flag = noFG
flag2 = noBG
flag3 = nobardisplay
ignorehitpause = 1

[State 3020, 2]
type = changeanim2
trigger1 = time = 10;!time && anim !=2780
value = 2780

[State 3020, 2]
type = velset
trigger1 = time=10
X = -1
Y = 14

[State 181, 1]
type = NotHitBy
trigger1 = 1
value = SCA

[State 1050, 1]
type = sprpriority
trigger1 = 1
value = 1

[State 182, 1]
type = screenbound
trigger1 = 1
movecamera = 0,0
value = 0

[State 3020, 2]
type = velset
trigger1 = pos Y > 300
X = 0
Y = 0

[State 3000, state] ;go to ground
type = ChangeState
trigger1 = P2StateNo = 2791
trigger2 = P2StateNo = 3000
trigger3 = P2StateNo = 3200
value = 2780
ctrl = 0

;------------------------------------------------
; P2 goes back to ground
[StateDef 2780]
type = S
movetype = H
physics = N
ctrl = 0
sprpriority = -1
velset = -1, 18

[State 182, 1]
type = screenbound
trigger1 = 1
movecamera = 0,0
value = 0

[State 182, 1]
type = PosSet
trigger1 = !time
Y = -300

[State 182, move P2 X-wise if finisher 3]
type = PosAdd
triggerall = !time
trigger1 = enemy,stateno = [3200,3201]
X = 50

[State 182, 1]
type = ChangeAnim2
trigger1 = !time && anim!=2780
value = 2780

[State 181, 1]
type = null;NotHitBy
trigger1 = P2StateNo != 3000
value = SCA
time = 200

[State 13100, shake]
type = envshake
trigger1 = Pos Y >= 10
trigger1 = Vel Y > 0
time = 15
freq = 90
ampl = 6

[state 2780, to lvl2 finisher]
type = changestate
trigger1 = enemy,anim = 3000 && enemy,animelem = 6
value = 3001

[State 1200]
type = ChangeState
trigger1 = Pos Y >= 10
trigger1 = Vel Y > 0
value = 2781

;---------------------------------------------------------------------------
;P2 bouncing on the ground
[Statedef 2781]
type    = L
movetype= H
physics = N

[State 3000, nhb]
type = NotHitBy
trigger1 = 1
time = 1
value = SCA

[State 4005, vel Y]
type = varset
trigger1 = !time
var(6) = 1

[State 5100, 1]
type = VelSet
trigger1 = Time = 0
trigger1 = GetHitVar(fall.yvel) = 0
trigger1 = vel x > 1
x = 1

[State 5100, EnvShake]
type = FallEnvShake
trigger1 = Time = 0

[State 5100, Var] ;Save fall velocity
type = VarSet
trigger1 = Time = 0
sysvar(1) = floor(vel y)

[State 5100, 2] ;Hit ground anim (normal)
type = ChangeAnim
triggerall = time = 0
trigger1 = (anim != [5051,5059]) && (anim != [5061,5069])
trigger2 = !SelfAnimExist(5100 + (anim % 10))
value = 5100

[State 5100, 3] ;Hit ground anim (for hit up)
type = ChangeAnim
trigger1 = time = 0
trigger1 = (anim = [5051,5059]) || (anim = [5061,5069])
trigger1 = SelfAnimExist(5100 + (anim % 10))
value = 5100 + (anim % 10)

[State 5100, 4]
type = PosSet
trigger1 = Time = 0
y = 0

[State 5100, 5]
type = VelSet
trigger1 = Time = 0
y = 0

[State 5100, 6] ;Reduce speed
type = VelMul
trigger1 = Time = 0
x = 0.5

[State 5100, 5]
type = VelSet
trigger1 = AnimTime = 0
y = -7

[State 111, 1]
type = StateTypeSet
trigger1 = AnimTime = 0
physics = A

[State 5100, 12]
type = ChangeState
trigger1 = AnimTime = 0
value = 2782    ;=5050 modified
;---------------------------
; HITA_FALL (knocked up, falling)
[Statedef 2782]
type    = A
movetype= H
physics = N
ctrl = 0

[State 3000, nhb]
type = NotHitBy
trigger1 = 1
time = 1
value = SCA

[State 5050, 1] ;Change anim when done with transition
type = ChangeAnim
trigger1 = AnimTime = 0
trigger1 = Anim = 5035
trigger2 = Time = 0     ;If no transition anim
trigger2 = Anim != 5035
trigger2 = (Anim != [5051, 5059]) && (Anim != [5061, 5069])
trigger2 = Anim != 5090 ;Not if hit off ground anim
value = 5050

[State 5050, 2] ;Coming down anim
type = ChangeAnim
trigger1 = anim = [5050,5059]
trigger1 = Vel Y >= IfElse(anim = 5050, 1, -2)
trigger1 = SelfAnimExist(anim+10)
value = anim+10
persistent = 0

[State 5050, 3] ;Gravity
type = VelAdd
trigger1 = 1
y = GetHitVar(yaccel)

[State 5050, 6]
type = ChangeState
trigger1 = Vel Y > 0
trigger1 = Pos Y >= IfElse((anim = [5051,5059]) || (anim = [5061,5069]), 0, 25)
value = 2785  ;2783   ;=5100 modified

;---------------------------------------------------------------------------
; HIT_BOUNCE (hit ground)
[Statedef 2783]
type    = L
movetype= H
physics = N
ctrl = 0

[State 3000, nhb]
type = NotHitBy
trigger1 = 1
time = 1
value = SCA

[State 5100, 1]
type = VelSet
trigger1 = Time = 0
trigger1 = GetHitVar(fall.yvel) = 0
trigger1 = vel x > 1
x = 1

[State 5100, EnvShake]
type = FallEnvShake
trigger1 = Time = 0

[State 5100, Var] ;Save fall velocity
type = VarSet
trigger1 = Time = 0
sysvar(1) = floor(vel y)

[State 5100, 2] ;Hit ground anim (normal)
type = ChangeAnim
triggerall = time = 0
trigger1 = (anim != [5051,5059]) && (anim != [5061,5069])
trigger2 = !SelfAnimExist(5100 + (anim % 10))
value = 5100

[State 5100, 3] ;Hit ground anim (for hit up)
type = ChangeAnim
trigger1 = time = 0
trigger1 = (anim = [5051,5059]) || (anim = [5061,5069])
trigger1 = SelfAnimExist(5100 + (anim % 10))
value = 5100 + (anim % 10)

[State 5100, 4]
type = PosSet
trigger1 = Time = 0
y = 0

[State 5100, 5]
type = VelSet
trigger1 = Time = 0
y = 0

[State 5100, 6] ;Reduce speed
type = VelMul
trigger1 = Time = 0
x = 0.75

[State 5100, 10]
type = PlaySnd
trigger1 = Time = 1
;value = F7, (sysvar(1) > 5) + (sysvar(1) > 14)
value = F7,2

[State 5100, 11]
type = PosFreeze
trigger1 = 1

[State 5100, 12]
type = ChangeState
trigger1 = AnimTime = 0
value = 2784    ;=5101 modified

;---------------------------------------------------------------------------
; HIT_BOUNCE (bounce into air)
[Statedef 2784]
type    = L
movetype= H
physics = N

[State 3000, nhb]
type = NotHitBy
trigger1 = 1
time = 1
value = SCA

[State 5101, 1] ;Coming hit ground anim (normal)
type = ChangeAnim
triggerall = time = 0
trigger1 = anim != [5101,5109]
trigger2 = !SelfAnimExist(5160 + (anim % 10))
value = 5160

[State 5101, 2] ;Coming hit ground anim (for hit up)
type = ChangeAnim
triggerall = time = 0
trigger1 = anim = [5101,5109]
trigger1 = SelfAnimExist(5160 + (anim % 10))
value = 5160 + (anim % 10)

[State 5101, 3]
type = HitFallVel
trigger1 = Time = 0

[State 5101, 4]
type = PosSet
trigger1 = Time = 0
y = 20

[State 5101, 5] ;Acceleration
type = VelAdd
trigger1 = 1
y = .4

[State 5101, 6] ;Hit ground
trigger1 = Vel Y > 0
trigger1 = Pos Y >= 12
type = ChangeState
value = 2785   ;=5110 modified

;---------------------------------------------------------------------------
; HIT_LIEDOWN
[Statedef 2785]
type    = L
movetype= H
physics = N

[State 3000, nhb]
type = NotHitBy
trigger1 = 1
time = 1
value = SCA

[State 5110, EnvShake]
type = FallEnvShake
trigger1 = Time = 0

[State 5110, 2] ;Hit ground anim (normal)
type = ChangeAnim
triggerall = time = 0
triggerall = anim != [5110,5119] ;Not already changed anim
trigger1 = anim != [5161,5169]
trigger2 = !SelfAnimExist(5170 + (anim % 10))
value = 5170

[State 5110, 4]
type = HitFallDamage
trigger1 = Time = 0

[State 5110, 5]
type = PosSet
trigger1 = Time = 0
y = 0

[State 5110, Var] ;Get fall velocity
type = VarSet
trigger1 = Time = 0
trigger1 = GetHitVar(fall.yvel) != 0
sysvar(1) = floor(vel y)



[State 5110, 8]
type = VelSet
trigger1 = Time = 0
y = 0

[State 5110, 9] ;For hit up type
type = ChangeAnim
persistent = 0
triggerall = anim = [5171,5179]
triggerall = SelfAnimExist(5110 + (anim % 10))
trigger1 = AnimTime = 0
trigger2 = SysVar(0) ;SysVar(0) = 1 avoids hit ground anim
value = 5110 + (anim % 10)

[State 5110, 10] ;For normal
type = ChangeAnim
persistent = 0
triggerall = Anim != [5111,5119]
trigger1 = AnimTime = 0
trigger2 = SysVar(0) ;SysVar(0) = 1 avoids hit ground frame
value = 5110

[State 5110, 11] ;If just died
type = SelfState
triggerall = !alive
trigger1 = AnimTime = 0
trigger2 = SysVar(0) ;SysVar(0) = 1 avoids hit ground frame
trigger3 = Anim = [5110,5119]
value = 5150

[State 5110, 11] ;Alive
type = SelfState
triggerall = alive
trigger1 = time = 40
value = 5120

[State 5110, 12]
type = VarSet
trigger1 = SysVar(0)
trigger1 = Time = 0
sysvar(0) = 0

[State 5110, 13] ;Friction
type = VelMul
trigger1 = 1
x = 0.85

;-------------------------------------
;Gohan state - Invisible and waiting
[Statedef 2790]
type = A
physics = N
movetype = A
ctrl = 0
sprpriority = 1
anim = 15999
velset = 0,0

[State 2260, bg]
type = assertspecial
trigger1 = 1
flag = noFG
flag2 = noBG
flag3 = nobardisplay
ignorehitpause = 1

[State 182, 1]
type = screenbound
trigger1 = 1
movecamera = 0,0
value = 0

[State 3020, pos]
type = PosSet
trigger1 = !time
X = 0
Y = -240

[State 3000, state] ;go to ground
type = ChangeState
trigger1 = P2StateNo = 2780
value = 2791
ctrl = 0

;-------------------------
; Gohan Fall back to ground
[Statedef 2791]
type    = A
movetype = I
physics = N
anim = 2790
juggle = 0
ctrl = 0
velset = 0,0
facep2 = 1
sprpriority = 2

[State 3020, pos]
type = PosSet
trigger1 = !time
X = 0
Y = -300

[State 182, 1]
type = screenbound
trigger1 = 1
movecamera = 0,0
value = 0

[State -2, Vel]
type = VelAdd
trigger1 = 1
Y = 0.45

[State -2, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = nobardisplay
ignorehitpause = 1

[State 3700]; Send Gohan to next state
type = changestate
trigger1 = pos Y >= -5
value = 2795
ctrl = 0

;-------------------------
; Ironman pose
[Statedef 2795]
type    = A
movetype = I
physics = N
anim = 2795
juggle = 0
ctrl = 0
velset = 0,0
facep2 = 1
sprpriority = 2

[State 17100, Landing Sound]
type = PlaySnd
trigger1 = !time
value = 40, 0

[state 17100, twirl FX]
type=explod
trigger1 = !time
anim=17200
id=17200
pos=7,0
postype=P1
sprpriority=-2
ownpal=1
supermovetime=-1
removetime = -2
persistent = 0
scale = 1,0.8

[State -2, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = nobardisplay
ignorehitpause = 1

[State -2, pos]
type = PosSet
trigger1 = !time
Y = 0

[State 0, RemoveExplod]
type = RemoveExplod
trigger1 = !Time
id = 991901

[state 0, reset emo gauge]
type = varset
trigger1 = !animtime
fvar(28) = 0

[State 3700]; Send Gohan to next state
type = changestate
trigger1 = !animtime
value = 0
ctrl = 1

;===========================================================================
; <<<<< DESTINY MODE >>>>>
; Destiny Activation = 2800
;===========================================================================

;DESTINY Activation
[Statedef 2800]
type		= S
movetype		= I
physics		= S
anim		= 2800
ctrl		= 0
velset		= 0,0
sprpriority	= 1

[State 2800, PowerAdd]
type		= PowerAdd
trigger1		= AnimElemTime(4)=0
value		= -2000

[State 200, BGPalFX]
type = BGPalFX
trigger1 = animelemtime(4)>=0 && time<150
time = 1
add	= -100,-100,-100
mul	= 100,100,256
invertall = 0
color = 256

[State 3000, SuperPause]
type = SuperPause
trigger1 = animelemtime(4)=0
time = 144
p2defmul = 1
unhittable = 1
anim = -1
sound = s2350,0
darken = 0
movetime = 144

[State 3000, nhb]
type = NotHitBy
trigger1 = animelemtime(4)>=0 && time<=150
time = 1
value = SCA

[State 1000, shake]
type = EnvShake
trigger1 = animelemtime(4)>=0
trigger1 = !(time%12)
time=12
freq=100
ampl=ifelse(3+0.02*time > 4, 4, 3+0.02*time)

[State 4500, 1];Scream
type = null;PlaySnd
triggerall = var(55)=0		;Voice=Japan
trigger1 = animelemtime(4)=0
value = 8,2
volume = 500
channel = 0

[State 4500, 1];Scream
type = null;PlaySnd
triggerall = var(55)=1		;Voice=English
trigger1 = animelemtime(4)=0
value = 8,5
volume = 500
channel = 0

[State 200, 1];voice
type = PlaySnd
;triggerall = var(55)=2		;Voice=Custom Corey Holland
trigger1 = animelemtime(4)=0
value = 2800,5
channel = 0

[State 4500, 2];long sound
type = PlaySnd
trigger1 = animelemtime(5)=0
value = 8,0
loop = 1
pan = 1
volume = 25
channel = 3
[State 4500, 2];long sound
type = PlaySnd
trigger1 = time=130
value = 8,0
loop = 1
pan = 1
volume = 25
channel = 3

[State 4500, 1];Small sound
type = PlaySnd
trigger1 = animelemtime(4)=0
value = 8,1
volume = 255

[State 0, lightning sound]
type = PlaySnd
triggerall = animelemtime(4)>=0
trigger1 = gametime%(20) = 0
value = 2800,random%3

[State 1900, dust]
type = explod
trigger1 = animelemtime(4)=0
anim = 908+(var(2)=0)
id = 908
pos = 17,5
sprpriority = 4
bindtime = -1
ownpal = 1
removeongethit = 1
ignorehitpause = 1
facing = -1
removetime = -1
pausemovetime = 99999
supermovetime = 99999

[State 2800, lightning aura]
type = explod
trigger1 = animelemtime(4)>=0
trigger1 = gametime%(4) = 0
anim = 2810+(random%12);2805+(random%4)
id = 2805
pos = 38-(random%76),-105+(Random%80);10-5*(random%5),-55
sprpriority = 4
bindtime = -1
ownpal = 1
removeongethit = 1
ignorehitpause = 1
facing = IfElse(random%2=0,1,-1)
removetime = -2
;scale = 0.5+0.1*(random%4), 0.5+0.1*(random%4)
pausemovetime = 99999
supermovetime = 99999

[State 1900, Aura helper]
type = Helper
trigger1 = animelemtime(4)=0 && !numhelper(907)
id = 907
name = "Charge"
pos = 0,-2
postype = P1
stateno = 907
helpertype = normal
keyctrl = 0
ownpal = 1
ignorehitpause = 1
pausemovetime = 99999
supermovetime = 99999

[State 1900, mouth closed]
type = explod
trigger1 = time=100
anim = 915
id = 915
sprpriority = 2
ownpal = 0
removeongethit = 1
ignorehitpause = 1
removetime = -1
pausemovetime = 99999
supermovetime = 99999

[State 3000, Activation var]
type = varset
trigger1 = animelemtime(7)=0
fvar(27) = 1

[State 3000, Destiny var]
type = varset
trigger1 = !time
fvar(28) = 0

[State 3000, SDS/SDU Counter]
type = varset
trigger1 = !time
fvar(31) = 0

[State 800, VarSet] ;this won't be checked, because I coded the changestate below (he goes to state 2810)
type = VarAdd
triggerall = !AILevel
triggerall = Anim=2800 && time>150 && fvar(28) < 300
trigger1 = (command = "holdy") && (command = "holdb")
fvar(28) = ifelse(fvar(28) + 0.8 > 300,300 - fvar(28),0.8) ;1
[State 800, VarSet] ;this won't be checked, because I coded the changestate below (he goes to state 2810)
type = VarAdd
triggerall = AILevel
trigger1 = Anim=2800 && time>150 && fvar(28) < 300
fvar(28) = ifelse(fvar(28) + 0.8 > 300,300 - fvar(28),0.8) ;1

[State 0, ChangeState] 
type = ChangeState
;triggerall = !AILevel
triggerall = Anim=2800 && time=150
trigger1 = (command = "holdy") && (command = "holdb")
value = 2810
ctrl = 0

;Stop charging Destiny
[State 901, Changestate]
type = ChangeState
triggerall = !AILevel
triggerall = Anim=2800 && time>150
trigger1 = (command != "holdy") || (command != "holdb")
trigger2 = fvar(28) >= 300 && power >= 3000
value = 2801
ctrl = 0
[State 901, Changestate]
type = ChangeState
triggerall = AILevel
triggerall = Anim=2800 && time>150
trigger1 = EnemyNear,statetype!=A && ((EnemyNear,vel x>0)||(EnemyNear,Movetype=A))
trigger2 = fvar(28) >= 300 && power >= 3000
trigger3 = time > 100 && random < 150
value = 2801
ctrl = 0
;-----------------------------
; Stop charging Destiny Bar
[Statedef 2801]
type = S
physics = S
movetype = I
anim = 2801
ctrl = 0
velset = 0,0
sprpriority = 1

[state -2, remove mouth closed]
type = removeexplod
trigger1 = !time
id = 915

[State 1001, stop scream]
type = stopsnd
trigger1 = !time
channel = 0

[State 1001, PalFX max]
type = PalFX
trigger1 = fvar(28) >= 300
add = 60, 60, 60
sinadd = 60,60,60,10
time = 10

[State 1001, full power]
type = PlaySnd
trigger1 = anim = 2801 && fvar(28)>=300
value = 8,3
channel = 1
persistent = 0

[State 1001, full power voice]
type = null;PlaySnd
triggerall = var(55)=0		;Voice=Japan
trigger1 = anim = 2801 && fvar(28)>=300
value = 8,4
channel = 0
persistent = 0

[State 1001, full power voice]
type = null;PlaySnd
triggerall = var(55)=1		;Voice=English
trigger1 = anim = 2801 && fvar(28)>=300
value = 8,6
channel = 0
persistent = 0

[State 1001, full power voice]
type = PlaySnd
;triggerall = var(55)=2		;Voice=Custom Corey Holland
trigger1 = anim = 2801 && fvar(28)>=300
value = 2700,10+random%2
channel = 0
persistent = 0

[State 250, 3]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;-----------------------------
; Charging Destiny Bar
[Statedef 2810]
type = S
movetype = I
physics = S
anim = 2800
ctrl = 0
velset = 0,0
sprpriority = 1

[State 0, ChangeAnim]
type = ChangeAnim
trigger1 = prevstateno = 2800 && !Time
value = 2800
elem = 6
persistent = 0

[State 1000, shake]
type = EnvShake
trigger1 = animelemtime(4)>=0
trigger1 = !(time%12)
time=12
freq=100
ampl=ifelse(3+0.02*time > 4, 4,  3+0.02*time)

[State 4500, 1];Scream
type = null;PlaySnd
triggerall = var(55)=0		;Voice=Japan
trigger1 = animelemtime(4)=0
value = 8,2
volume = 500
channel = 0

[State 4500, 1];Scream
type = null;PlaySnd
triggerall = var(55)=1		;Voice=English
trigger1 = animelemtime(4)=0
value = 8,5
volume = 500
channel = 0

[State 200, 1];voice
type = PlaySnd
;triggerall = var(55)=2		;Voice=Custom Corey Holland
trigger1 = animelemtime(4)=0
value = 2800,5
channel = 0

[State 4500, 2];long sound
type = PlaySnd
trigger1 = animelemtime(5)=0
value = 8,0
loop = 1
pan = 1
volume = 25
channel = 3
[State 4500, 2];long sound
type = PlaySnd
trigger1 = time=130
value = 8,0
loop = 1
pan = 1
volume = 25
channel = 3

[State 4500, 1];Small sound
type = PlaySnd
trigger1 = animelemtime(4)=0
value = 8,1
volume = 255

[State 0, lightning sound]
type = PlaySnd
triggerall = animelemtime(4)>=0
trigger1 = gametime%(20) = 0
value = 2800,random%3


[State 1900, Dust helper (Power charge)]
type = Helper
trigger1 = animelemtime(4)=0
id = 909
stateno = 909
name = "Dust"
pos = -17,5
postype = P1
helpertype = normal
keyctrl = 0
ownpal = 1
ignorehitpause = 1

;[State 1900, lightning aura]
;type = explod
;trigger1 = animelemtime(4)>=0
;trigger1 = gametime%(4) = 0
;anim = 2805+(random%4)
;id = 2805
;pos = 15-5*(random%5),-55
;sprpriority = 4
;bindtime = -1
;ownpal = 1
;ignorehitpause = 1
;facing = IfElse(random%2=0,1,-1)
;removetime = -2
;scale = 0.5+0.1*(random%4), 0.5+0.1*(random%4)
;;pausemovetime = 99999
;;supermovetime = 99999

[State 1900, Lightning helper calling (Power charge)]
type		= Helper
trigger1		= animelemtime(4)>=0
trigger1		= gametime%(4) = 0
id		= 2805
stateno		= 2805
name		= "Lightning"
pos		= 38-(random%76),-105+(Random%80)
; Cond (Facing=1,0-5*(Random%5),5-5*(Random%5)),-55 very old
; Cond (Facing=1,-3*(Random%-10),3*(Random%-10)),-85+(Random%60)  if x and y scale is 1
postype		= P1
facing		= IfElse(random%2=0,1,-1)
helpertype	= normal
keyctrl		= 0
ownpal		= 1
ignorehitpause	= 1
size.xscale	= 0.5+0.1*(random%4)
size.yscale	= 0.5+0.1*(random%4)


;[State 1900, dust]
;type = explod
;trigger1 = animelemtime(4)=0
;anim = 908+(var(2)=0)
;id = 908
;pos = 17,5
;sprpriority = 4
;bindtime = -1
;ownpal = 1
;removeongethit = 1
;ignorehitpause = 1
;facing = -1
;removetime = -1
;;pausemovetime = 99999
;;supermovetime = 99999

[State 1900, Aura helper]
type = Helper
trigger1 = animelemtime(4)=0 && !numhelper(907)
id = 907
name = "Charge"
pos = 0,-2
postype = P1
stateno = 907
helpertype = normal
keyctrl = 0
ownpal = 1
ignorehitpause = 1
;pausemovetime = 99999
;supermovetime = 99999

[State 1900, mouth closed]
type = explod
trigger1 = time=100
anim = 915
id = 915
;pos = 0,0
sprpriority = 2
;bindtime = -1
ownpal = 0
removeongethit = 1
ignorehitpause = 1
removetime = -1
pausemovetime = 99999
supermovetime = 99999

[State 1000, Power]
type = PowerAdd
triggerall = Time >= 12
trigger1 = !AILevel && (command = "holdb") && (command = "holdy")
value = 5 + (time/20)
[State 1000, Power AI]
type = PowerAdd
trigger1 = AILevel && Time >= 12
value = 5 + (time/20)

[State 800, U.Power]
type = VarAdd
triggerall = !AILevel && fvar(28) < 300
triggerall = Time >= 12
trigger1 = (command = "holdy") && (command = "holdb")
fvar(28) = ifelse(fvar(28) + 0.85 > 300,300 - fvar(28),0.85) ;1
persistent = 2
[State 800, U.Power AI]
type = VarAdd
triggerall = Time >= 12
trigger1 = AILevel && fvar(28) < 300
fvar(28) = ifelse(fvar(28) + 0.85 > 300,300 - fvar(28),0.85) ;1
persistent = 2

;Stop charging Destiny
[State 901, Changestate]
type = ChangeState
triggerall = !AILevel
trigger1 = (command != "holdy") || (command != "holdb")
trigger2 = fvar(28) >= 300 && Power >= 3000
trigger3 = roundstate != 2
value = 2801
ctrl = 0
[State 901, Changestate]
type = ChangeState
triggerall = AILevel
trigger1 = EnemyNear,statetype!=A && ((EnemyNear,vel x>0)||(EnemyNear,Movetype=A))
trigger2 = fvar(28) >= 300 && Power >= 3000
trigger3 = roundstate != 2
trigger4 = time > 60 && random < 150
trigger5 = time >= 200
value = 2801
ctrl = 0

;===========================================================================
; <<<<< UNLEASHED GEKIRETSU RANBU >>>>>
; Counter State = 2900
;===========================================================================

; Unleashed Gekiretsu Ranbu
[Statedef 2900]
type = S
movetype = A
physics = S
facep2 = 1
ctrl = 0
anim = 2900
velset = 0,0
;poweradd = Cond((PrevStateNo = 2710||PrevStateNo = 2730), 0,IfElse(Fvar(27) = 0, -3000,-2000))

[State 0, PowerAdd]
type = null;PowerAdd
trigger1 = !Time
value = Cond(Fvar(27) = 0, -3000,-2000)
;ignorehitpause = 
;persistent = 


[State 0, StateTypeSet]
type = StateTypeSet
trigger1 = pos y != 0
statetype = A       ;S,A,C,L
movetype = A        ;I,A,H
physics = A         ;A,C,S,N

[State 0, VelSet]
type = VelSet
trigger1 = Statetype = A
x = 0
y = 0

[State 3000, remember Destiny mode]
type = VarSet
trigger1 = !time && fvar(27)>0
var(33) = 1
[State 3000, cancel Destiny mode]
type = VarSet
trigger1 = !time
fvar(27)=0
[State 3000, cancel Destiny mode]
type = VarSet
trigger1 = !time
var(9)=0

[state 0, combo ver. indicator] ;for dmg reduction on finishers
type = explod
trigger1 = !time
anim = 1
ID = 9992900
removetime = -1
ignorehitpause = 1

[State 1900, dust]
type = explod
trigger1 = animelemtime(4)=0
anim = 908+(var(2)=0)
;id = 908
pos = 17,5
sprpriority = 4
bindtime = 1
ownpal = 1
removeongethit = 1
ignorehitpause = 1
facing = -1
removetime = -2
persistent = 0
pausemovetime = 99999
supermovetime = 99999

[State 3000, SFX]
type = PlaySnd
trigger1 = anim=2900 && animelemtime(4)=0
value = 2700,0

[State 3000, Effect]
type = palfx
trigger1 = anim=2900 && animelemtime(4)>=0
time = 1
add = 30,30,50
mul = 256,256,200
sinadd = -5,-5,-5,15

[state 17100, wave power FX]
type = explod
trigger1 = anim=2900 && animelemtime(4)=0
anim = 18202
id = 18202
pos = 0,-70
postype = P1
sprpriority = 3
ownpal = 1
supermovetime = 999999
pausemovetime = 999999
removetime = -2
persistent = 0
scale = 1,1
ignorehitpause = 1

[State 3000, NotHitBy]
type = NotHitBy
trigger1 = anim = 2900
value = SCA, AA

[State 800, Kill those hoes]
type = hitdef
triggerall = anim=2900
triggerall = numenemy
triggerall = !enemy,ishelper
triggerall = p2bodydist x < 80
trigger1 = !NumExplod(801)
trigger1 = animelemno(0) = [4,15]
attr = S,HA
hitflag = MAFD
guardflag = MA
guard.dist = -1
pausetime = 4,5
priority = 7,Hit
sparkno = -1
hitsound = s850,1
fall = 0
fall.recover = 0
yaccel = .68
getpower = 0,0
givepower = 0,0
forcestand = 1
forcenofall = 1
p2facing = 1
numhits = 0
persistent = 0
;p1stateno = 2710
;p2stateno = 2715
id = 2900

[State 0, TargetState]  ;New state
type = TargetState
Trigger1 = Fvar(28) = 300
trigger1 = Numtarget(2900)
trigger1 = movehit = 1
trigger1 = !target(2900), IsHelper
value =3305
ID = 2900
ignorehitpause = 1
persistent = 0

[State 0, TargetState]  ;New state
type = TargetState
Trigger1 = Fvar(28) < 300
trigger1 = Numtarget(2900)
trigger1 = movehit = 1
trigger1 = !target(2900), IsHelper
value = 2715
ID = 2900
ignorehitpause = 1
persistent = 0

[State 0, ChangeState]
type = ChangeState
Trigger1 = Fvar(28) = 300
trigger1 = MoveHit=1
trigger1 = Numtarget(2900)
trigger1 = !target(2900), IsHelper
value = 3300
ignorehitpause = 1
persistent = 0

[State 0, ChangeState]
type = ChangeState
Trigger1 = Fvar(28) < 300
trigger1 = MoveHit=1
trigger1 = Numtarget(2900)
trigger1 = !target(2900), IsHelper
value = 2730
ignorehitpause = 1
persistent = 0


[State 200, 1];Voice
type = null;PlaySnd
triggerall = var(55)=0		;Voice=Japan
triggerall = anim=2900
trigger1 = animelemtime(5) = 0
value = 8,2
channel = 0
volume = 355

[State 200, 1];Voice
type = null;PlaySnd
triggerall = var(55)=1		;Voice=English
triggerall = anim=2900
trigger1 = animelemtime(5) = 0
value = 8,5
channel = 0
volume = 355

[State 200, 1];voice
type = PlaySnd
;triggerall = var(55)=2		;Voice=Custom Corey Holland
triggerall = anim=2900
trigger1 = animelemtime(5) = 0
value = 2800,5
channel = 0
volume = 255

[State 3050, Off]
type = changeanim
trigger1 = animtime = 0
trigger1 = anim = 2900
value = 2901

[State 0, AttackDist]
type = AttackDist
trigger1 = Anim = 2901
trigger1 = AnimElemTime(1) >= 0
value = 0

[State 3050, End]
type = changestate
trigger1 = statetype != A
trigger1 = animtime = 0||time>=19
trigger1 = anim = 2901
value = 0
ctrl = 1

[State 3050, End]
type = changestate
trigger1 = statetype = A
trigger1 = animtime = 0||time>=19
trigger1 = anim = 2901
value = 50
ctrl = 1



;===========================================================================
; <<<<< UNLEASHED GEKIRETSU RANBU - FATALITY 1 >>>>>
; Teleports in, then power gut punch : 3000
; Flurry punch : 3005
; Uppercut : 3010
; P2 state sent diagonal : 3011
; Mega Masenko up : 3015
; Gohan out of screen : 3020
; P2 center of screen : 3021
; Gohan back on screen : 3030
;===========================================================================


;FATALITY 1
[Statedef 3000] ; Gohan Teleports in, then power gut punch
type    = S
movetype = A
physics = N
anim = 3000
juggle = 0
ctrl = 0
velset = 0,0
facep2 = 1
sprpriority = 2

[state 0, nothitby]
type = nothitby
trigger1 = 1
value = SCA

[State 1010, VarAdd - for 'dmg dampening']
type = null;VarAdd
trigger1 = !Time
fvar(13) = -5
ignorehitpause = 1

[State 3020, pos]
type = PosSet
trigger1 = !time
X = enemy,pos X + 50*facing
Y = 0

[State 3020, pos]
type = Turn
trigger1 = !time

[State 182, 1]
type = screenbound
trigger1 = 1
movecamera = 0,0
value = 0

[State -2, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = nobardisplay
ignorehitpause = 1

[State 250, teleport sound]
type = PlaySnd
trigger1 = AnimElem = 2
value = 2302, 0

[state 3000, hitadd]
type = hitadd
trigger1 = animelem = 6
value = 1

[state 3000, hit sound]
type = playsnd
trigger1 = animelem = 6
value = s2720,1

[state 2720, hit spark]
type = explod
trigger1 = animelem = 6
anim = 2719
postype = P1
pos = 45,-65
sprpriority = 7
removetime = -2

[state 3000, envshake]
type = envshake
trigger1 = animelem = 6
time = 15 ;40
freq = 100
ampl = 7 ;8

[State 3700]; Send Gohan to next state
type = changestate
trigger1 = !animtime
value = 3005
ctrl = 0

;------------------------------------------------
; P2 hit by flurry punch
[statedef 3001]
type = A
movetype = H
physics = N
velset = 0,0

[state 0, nothitby]
type = nothitby
trigger1 = 1
value = SCA

[state 3001, turn]
type = turn
trigger1 = !time
trigger1 = facing = enemy,facing

[state 3001, posset]
type = posset
trigger1 = !time
x = ifelse(facing = -1, enemy,pos x + 40, enemy,pos x - 40)
y = -22

[state 3001]
type = changeanim2
trigger1 = enemy,anim = 3000
trigger1 = enemy,animelem = 6
value = 5016

[state 3001]
type = changeanim2
trigger1 = enemy,anim = 3005 && enemy,animelem >= 2
value = 5017

[state 3001]
type = velset
trigger1 = anim = 5017
x = -0.1

[state 3001]
type = changestate
trigger1 = enemy,anim = 3010
trigger1 = enemy,animelem = 5
value = 3011

[state 0, failed]
type = changestate
trigger1 = time >= 100
trigger1 = enemy,anim != [3000,3005]
value = 0
ctrl = 1

;------------------------------------------------
; Gohan Flurry Punch
[Statedef 3005]
type    = S
movetype = A
physics = N
anim = 3005
juggle = 0
ctrl = 0
velset = 0,0
facep2 = 1
sprpriority = 2

[state 0, nothitby]
type = nothitby
trigger1 = 1
value = SCA

[State -2, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = nobardisplay
ignorehitpause = 1

[state 0, changeanim]
type = changeanim
trigger1 = !time && stateno = prevstateno
value = 3005
elem = 2

[State 200, 1];voice
type = PlaySnd
triggerall = stateno != prevstateno ;so it doesn't play when anim loops
;triggerall = var(55)=2		;Voice=Custom Corey Holland
trigger1 = !time
value = 3005,0
channel = 0

[State 200, 1]
type = PlaySnd
trigger1 = animelem = 1
trigger2 = animelem = 3
trigger3 = animelem = 5
value = 0, random%3

[state 3005]
type = hitadd
trigger1 = animelemtime(2) >= 0
value = 1
persistent = 4

[state 3005, hit sound]
type = playsnd
trigger1 = animelem = 2
trigger2 = animelem = 3
trigger3 = animelem = 4
trigger4 = animelem = 5
trigger5 = animelem = 6
value = s5,random%2

[state 3000, hit spark]
type = explod
trigger1 = animelem = 2
trigger2 = animelem = 3
trigger3 = animelem = 4
trigger4 = animelem = 5
trigger5 = animelem = 6
anim = 7010+10*(random%3)
postype = P1
pos = 65,-60
sprpriority = 7

[state 3000, envshake]
type = envshake
trigger1 = animelem = 2
time = 20 ;40
freq = 100
ampl = 3 ;5

[State 200, 1]
type = null;HitDef
trigger1 = animelem = 2
attr = S, HA
damage = Ceil(IfElse(fvar(11) * 2 < 2, 2, fvar(11) * 2)), 0
;Ceil(IfElse(fvar(11) * 2 < 2, 2, fvar(11) * 2)), 0
; 2, 0
animtype = Hard	
hitflag = MAF
priority = 4, Hit
pausetime = 5,6
guard.pausetime = 6,6
sparkno = s7010+10*(random%3)
guard.sparkno = s7000
sparkxy = -17,-60
hitsound = s5, random%2
guardsound = S6,1
ground.type = Low
ground.slidetime = 10
ground.hittime  = 10
ground.velocity = 1
guard.velocity = -3
air.type = High	
air.velocity = -0.5,-1
air.hittime = 12
air.animtype = back
getpower= 0,0
givepower = 8,8
yaccel = 0.4
kill = 0

[State 200, 1]
type = null;HitDef
trigger1 = animelem = 3
attr = S, HA
damage = Ceil(IfElse(fvar(11) * 2 < 2, 2, fvar(11) * 2)), 0
;Ceil(IfElse(fvar(11) * 2 < 2, 2, fvar(11) * 2)), 0
; 2, 0
animtype = Hard	
hitflag = MAF
priority = 4, Hit
pausetime = 5,6 ;8,8
guard.pausetime = 6,6 ;8,8
sparkno = s7010+10*(random%3)
guard.sparkno = s7000
sparkxy = -17,-73
hitsound = s5, random%2
guardsound = S6,1
ground.type = High
ground.slidetime = 10
ground.hittime  = 10
ground.velocity = 1
guard.velocity = -3
air.type = High	
air.velocity = -0.5,-1
air.hittime = 12
air.animtype = back
getpower= 0,0
givepower = 8,8
yaccel = 0.4
kill = 0

[State 200, 1]
type = null;HitDef
trigger1 = animelem = 4
attr = S, HA
damage = Ceil(IfElse(fvar(11) * 2 < 2, 2, fvar(11) * 2)), 0
;Ceil(IfElse(fvar(11) * 2 < 2, 2, fvar(11) * 2)), 0
; 2, 0
animtype = Hard	
hitflag = MAF
priority = 4, Hit
pausetime = 5,6 ;8,8
guard.pausetime = 6,6 ;8,8
sparkno = s7010+10*(random%3)
guard.sparkno = s7000
sparkxy = -10,-70
hitsound = s5, random%2
guardsound = S6,1
ground.type = Low
ground.slidetime = 10
ground.hittime  = 10
ground.velocity = 1
guard.velocity = -3
air.type = High	
air.velocity = -0.5,-1
air.hittime = 12
air.animtype = back
getpower= 0,0
givepower = 8,8
yaccel = 0.4
kill = 0

[State 200, 1]
type = null;HitDef
trigger1 = animelem = 5
attr = S, HA
damage = Ceil(IfElse(fvar(11) * 2 < 2, 2, fvar(11) * 2)), 0
;Ceil(IfElse(fvar(11) * 2 < 2, 2, fvar(11) * 2)), 0
; 2, 0
animtype = Hard	
hitflag = MAF
priority = 4, Hit
pausetime = 5,6 ;8,8
guard.pausetime = 6,6 ;8,8
sparkno = s7010+10*(random%3)
guard.sparkno = s7000
sparkxy = -23,-57
hitsound = s5, random%2
guardsound = S6,1
ground.type = High
ground.slidetime = 10
ground.hittime  = 10
ground.velocity = 1
guard.velocity = -3
air.type = High	
air.velocity = -0.5,-1
air.hittime = 12
air.animtype = back
getpower= 0,0
givepower = 8,8
yaccel = 0.4
kill = 0

[State 200, 1]
type = null;HitDef
trigger1 = animelem = 6
attr = S, HA
damage = Ceil(IfElse(fvar(11) * 2 < 2, 2, fvar(11) * 2)), 0
;Ceil(IfElse(fvar(11) * 2 < 2, 2, fvar(11) * 2)), 0
; 2, 0
animtype = Hard	
hitflag = MAF
priority = 4, Hit
pausetime = 5,6 ;8,8
guard.pausetime = 6,6 ;8,8
sparkno = s7010+10*(random%3)
guard.sparkno = s7000
sparkxy = -15,-70
hitsound = s5, random%2
guardsound = S6,1
ground.type = Low
ground.slidetime = 10
ground.hittime  = 10
ground.velocity = 1
guard.velocity = -3
air.type = High	
air.velocity = -0.5,-1
air.hittime = 12
air.animtype = back
getpower= 0,0
givepower = 8,8
yaccel = 0.4
kill = 0

[State 3700]; Send Gohan to next state
type = changestate
trigger1 = !animtime
value = IfElse(stateno=prevstateno,3010,3005)
ctrl = 0

;------------------------------------------------
; Gohan Uppercut
[Statedef 3010]
type    = S
movetype = A
physics = N
anim = 3010
juggle = 0
ctrl = 0
velset = 0,0
facep2 = 1
sprpriority = 2

[State -2, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = nobardisplay
ignorehitpause = 1

[State 200, 1]
type = PlaySnd
trigger1 = animelem = 3
value = 0, 2
channel = 1

[state 0]
type = hitadd
trigger1 = animelem = 4
value = 1

[state 0, envshake]
type = envshake
trigger1 = animelem = 4
time = 16
freq = 60
ampl = 4

[State 200, 1]
type = null;HitDef
trigger1 = animelem = 4
attr = S, HA
damage = Ceil(IfElse(fvar(11) * 5 < 5, 5, fvar(11) * 5)), 0
;Ceil(IfElse(fvar(11) * 5 < 5, 5, fvar(11) * 5)), 0
; 5, 0
animtype = Hard	
hitflag = MAF
priority = 4, Hit
pausetime = 5,6
sparkno = s7030
sparkxy = -20,-90
hitsound = s5, 2
ground.type = Low
ground.slidetime = 20
ground.hittime  = 20
ground.velocity = 1
air.type = High	
air.velocity = -2.5,-8
air.hittime = 12
air.animtype = back
getpower= 0,0
givepower = 50,50
yaccel = 0.4
kill = 0
;p2stateno = 3011
envshake.time = 16
envshake.freq = 60
envshake.ampl = 4
id = 3011

[State 1315, Sparks]
type=explod
trigger1 = animelem = 4
anim = 2512
sprpriority=7
postype = p1
pos = 50,-115
removetime=-2
ownpal=1
facing=-1
ignorehitpause=1
persistent=0
pausemovetime=100
supermovetime=100

[State 13100, explosion SND]
type = PlaySnd
trigger1 = animelem = 4
value = 2511,0
volume = 355
ignorehitpause = 1
persistent = 0

[State 3700]; Send Gohan to next state
type = changestate
trigger1 = !animtime
value = 3015
ctrl = 0

;------------------------------------------------
;P2 State - Sent in the air by uppercut
[Statedef 3011]
type = S
physics = N
movetype = H
ctrl = 0
velset = -7, -15

[State 3020, 2]
type = changeanim2
trigger1 = !time && anim !=3011
value = 3011

[State 3020, to fix Silvy by Hanma ...]
type = VelSet
trigger1 = pos Y < -1000
Y = 0

[State 181, 1]
type = NotHitBy
trigger1 = 1
value = SCA
;time = 20

[State 1050, 1]
type = sprpriority
trigger1 = 1
value = 1

[State 182, 1]
type = screenbound
trigger1 = 1
movecamera = 0,0
value = 1

[State 3000, state] ;go back to center of screen
type = ChangeState
trigger1 = P2StateNo = 3020   ;when Gohan out of screen
value = 3021
ctrl = 0

;------------------------------------------------
; Gohan Masenko Up
[Statedef 3015]
type    = S
movetype = A
physics = N
anim = 3015
juggle = 0
ctrl = 0
velset = 0,0
facep2 = 1
sprpriority = 2

[state 0]
type = nothitby
trigger1 = 1
value = SCA

[State -2, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = nobardisplay
ignorehitpause = 1

[State 200, 1];voice Masenko
type = PlaySnd
;triggerall = var(55)=2		;Voice=Custom Corey Holland
trigger1 = !time
value = 3015,1
channel = 0

[State 200, Masenko charge long]
type = PlaySnd
trigger1 = animelem = 4
channel = 7
value = 2000,1

[State 200, Charge snd]
type = PlaySnd
trigger1 = animelemtime(4)=0
value = 2000,10

[State 0, Charge Ball FX]
type = Explod
trigger1 = animelemtime(4)=0
anim = 2015
pos = -7,-109
postype = p1
supermovetime = 9999
pausemovetime = 9999
supermove = 1
removetime = 18+36+18
sprpriority = 5
ownpal = 1
bindtime = -1
scale = 1,1
persistent = 0

[State 0, Ki Gather FX]
type = Explod
trigger1 = animelemtime(4)=0
anim = 2016
pos = -7,-109
postype = p1
supermovetime = 9999
pausemovetime = 9999
supermove = 1
removetime = -2
sprpriority = 6
ownpal = 1
bindtime = -1
scale = 1,1
persistent = 0

[State 0, Charge lightning FX]
type = Explod
trigger1 = animelemtime(4)=0
anim = 2006
pos = -10,0
postype = p1
supermovetime = 9999
pausemovetime = 9999
supermove = 1
removetime = 18+36+18
sprpriority = 5
ownpal = 1
bindtime = -1
scale = 1,1

[state 1215, Smoke FX]
type = explod
trigger1 = animelemtime(28)=0
anim = 1206+(var(2)=0)
id = 1206
pos = -25,3
postype = P1
sprpriority = 3
ownpal = 1
removetime = -2
persistent = 0
ignorehitpause = 1

[state 1215, Masenko]
type = explod
trigger1 = animelemtime(28)=0
anim = 3016
id = 3016
pos = 19,-105
postype = P1
sprpriority = 3
ownpal = 1
removetime = -1
persistent = 0

[State 200, 1];voice Masenko
type = PlaySnd
;triggerall = var(55)=2		;Voice=Custom Corey Holland
trigger1 = animelemtime(28)=0
value = 2401,7
channel = 0

[State 200, 1];Launching SFX
type = PlaySnd
trigger1 = animelemtime(30)=0
value = 3015,2 ;0
persistent = 0

[State 3700]; Send Gohan to next state
type = changestate
trigger1 = time=160
value = 3020
ctrl = 0

;-------------------------
; Gohan out of screen
[Statedef 3020]
type    = S
movetype = A
physics = N
anim = 15999
juggle = 0
ctrl = 0
velset = 0,0
facep2 = 1
sprpriority = 2

[state 0]
type = nothitby
trigger1 = 1
value = SCA

[State 2201, remove masenko]
type = RemoveExplod
trigger1 = !time
ID = 3016

[State 2201, helper]; Background lines
type = Helper
trigger1 = !time
;pos = -320, 350
pos = -170, 200
postype = back
stateno = 3022
helpertype = normal
name = "diagonal_lines_BG"
ownpal = 1
supermovetime = 150
pausemovetime = 150

[State 2201, helper]; Background lines
type = Helper
trigger1 = !time
;pos = 0, 300
pos = 150, 150
postype = back
stateno = 3022
helpertype = normal
name = "diagonal_lines_BG"
ownpal = 1
supermovetime = 150
pausemovetime = 150

[State 2260, bg]
type = assertspecial
trigger1 = 1
flag = noFG
flag2 = noBG
flag3 = nobardisplay
ignorehitpause = 1

[State 2260, bg]
type = assertspecial
trigger1 = 1
flag = globalnoshadow
flag2 = noshadow
ignorehitpause = 1

[State 3001, screen]
type = Screenbound
trigger1 = 1
movecamera = 0,0
value = 0

[state 2772, out of screen]
type = posset
trigger1 = !time
y = 400

[State 2201, Mega Masenko travelling helper]
type = Helper
trigger1 = !time
postype = back
stateno = 3025
ID = 3025
helpertype = normal
name = "Mega_Masenko_Travel"
ownpal = 1
supermovetime = 150
pausemovetime = 150

[state 3020, damage]
type = targetlifeadd
trigger1 = !numexplod(9992900)
trigger1 = time = 80
value = -ceil(ifElse(fvar(11) * 650 < 308, 308, fvar(11) * 650))
;-ceil(ifelse(fvar(11)*280 < 190, 190, fvar(11)*280))
[state 3020, combo damage]
type = targetlifeadd
trigger1 = numexplod(9992900)
trigger1 = time = 80
value = -ceil(ifelse(fvar(11)*500 < 250, 250, fvar(11)*500))

[State 1315, White BG Fades]
type = explod
trigger1= numhelper(3025)
trigger1 = time = 90
anim = 3020
ID = 3020
pos =  160,120
postype = left
sprpriority = 7
ontop = 1
facing = 1
bindtime = -1
ownpal = 1
removetime = -2
pausemovetime = 99999999999999
supermovetime = 99999999999999
supermove = 1
scale = 1.20,1.20
ignorehitpause = 1
persistent = 0

[State 200, 1];Dramatic SFX
type = PlaySnd
trigger1 = WinKO && p2stateno=5944
value = 5941,0
persistent = 0

[State 3700]; Send Gohan back to screen
type = changestate
trigger1 = time=165
value = 3030
ctrl = 0

;------------------------------------
;P2 center of screen
[Statedef 3021]
type = A
movetype = H
physics = N
velset = 0,0
ctrl = 0
sprpriority = 2

[state 0]
type = nothitby
trigger1 = 1
value = SCA

[State 2260, bg]
type = assertspecial
trigger1 = 1
flag = globalnoshadow
ignorehitpause = 1

[State 3001, screen]
type = Screenbound
trigger1 = 1
movecamera = 0,0
value = 1

[State 3001, anim2]
type = Changeanim2
trigger1 = time = 0
value = 2761

[state 3021, hit anim]
type = changeanim2
triggerall = authorname = "Team Z2"
triggerall = enemy, numhelper(3025)
trigger1 = time = 30
value = 7696

[state 3021, hit anim]
type = changeanim2
triggerall = authorname != "Team Z2"
triggerall = enemy, numhelper(3025)
trigger1 = time = 30
value = 3026

[State 3001, PosSet]
type = PosSet
trigger1 = 1
x = -30*facing
y = -30

[State 3001, shake]
type = EnvShake
trigger1 = time = 0
time = 140
freq = 100
ampl = 3

[state 3021, killed]
type = changestate
trigger1 = time >= 80
trigger1 = MatchOver
value = 5944

[state 3021, end]
type = changestate
triggerall = time = 165
trigger1 = !matchover
trigger2 = numenemy > 2
value = 30210

;------------------------------------
;P2 falling from masenko finisher
[statedef 30210]
type = A
movetype = H
physics = N
velset = 0,0
ctrl = 0

[state 0, nothitby]
type = nothitby
trigger1 = 1
value = SCA

[state 3022, pos]
type = posset
trigger1 = !time
x = enemy,facing*(enemy,pos x + 100)
y = -100

[state 3022, falling anim]
type = changeanim2
trigger1 = !time
value = 5061
elem = 3

[state 3022, falling]
type = statetypeset
trigger1 = !time
physics = A

[state 3022, hit ground]
type = changestate
trigger1 = (pos y + vel y) >= 0
value = 5954;5100
ctrl = 0

;------------------------------------
;Gohan back on screen
[Statedef 3030]
type    = S
movetype = A
physics = S
anim = 0
juggle = 0
ctrl = 0
velset = 0,0
facep2 = 1
sprpriority = 2

[state 0]
type = nothitby
trigger1 = 1
value = SCA

[state 2772, out of screen]
type = posset
trigger1 = !time
y = 0

[State 0, CtrlSet]
type = CtrlSet
trigger1 = Time = 60
value = 1

[state 0, reset emo gauge]
type = varset
trigger1 = !animtime
fvar(28) = 0

[State 3700]; Send Gohan back to stance
type = changestate
trigger1 = !animtime
value = 0
ctrl = 1




;===========================================================================
; <<<<< UNLEASHED GEKIRETSU RANBU - FATALITY 2 >>>>>
; State = 3100
; P2 hit by green explosion : 3105
; P2 hitting ground : 3106-3111
; Gohan going back to ground : 3115
; P2 fatality state : 3120
; Debris Helper : 3125-3127
;===========================================================================

; FATALITY 2
[Statedef 3100]
type    = A
movetype = A
physics = N
anim = 3100
juggle = 0
ctrl = 0
velset = 0,0
facep2 = 1
sprpriority = 2

[State 1010, VarAdd - for 'dmg dampening']
type = VarAdd
trigger1 = !Time
fvar(13) = -3
ignorehitpause = 1

[state 0]
type = nothitby
trigger1 = 1
value = SCA

[State 2260, bg]
type = assertspecial
trigger1 = 1
flag = noFG
flag2 = noBG
flag3 = nobardisplay
ignorehitpause = 1

[State 2260, bg]
type = assertspecial
trigger1 = 1
flag = globalnoshadow
flag2 = noshadow
ignorehitpause = 1

[State 200, 1];voice
type = PlaySnd
;triggerall = var(55)=2		;Voice=Custom Corey Holland
trigger1 = animelem=5
value = 3100,2
channel = 0

[State 250, turning sound]
type = PlaySnd
trigger1 = AnimElem = 2
value = 3100,0

[State 250, 1]
type = PlaySnd
trigger1 = AnimElem = 11
value = 0, 2

[state 3100, hit sound]
type = playsnd
trigger1 = animelem = 14
value = s2720,2

[state 0, hitadd]
type = hitadd
trigger1 = animelem = 14
value = 1

[state 0, envshake]
type = envshake
trigger1 = animelem = 14
time = 40
freq = 100
ampl = 8

[state 3100, damage]
type = targetlifeadd
trigger1 = !numexplod(9992900)
trigger1 = animelem = 14
value = -ceil(ifelse(fvar(11)*550 < 250, 250, fvar(11)*550))
[state 3100, combo damage]
type = targetlifeadd
trigger1 = numexplod(9992900)
trigger1 = animelem = 14
value = -ceil(ifelse(fvar(11)*400 < 200, 200, fvar(11)*400))

[State 250, explosion sound]
type = PlaySnd
trigger1 = AnimElem = 14
value = 3100,1

[State 1315, Big Explosion]
type = explod
trigger1 = animelem = 14
anim = 3101
sprpriority=5
postype = p1
pos = 80,-80
removetime=-2
facing = -1
ownpal=1
ignorehitpause=1
persistent = 1
pausemovetime=100
supermovetime=100

[State 1315, Thundershock]
type = explod
trigger1 = animelem = 14
anim = 3102
sprpriority=6
postype = p1
pos = 80,-80
removetime=-2
ownpal=1
ignorehitpause=1
persistent = 1
pausemovetime=100
supermovetime=100

[State 1315, Explosion]
type = explod
trigger1 = animelem = 14
anim = 2512
sprpriority=7
postype = p1
pos = 90,-90
removetime=-2
ownpal=1
ignorehitpause=1
persistent = 1
pausemovetime=100
supermovetime=100

[State 3000, debris]
type = helper
trigger1 = enemy,stateno=3120 && !numhelper(3125)
helpertype = normal
stateno = 3125
ID = 3125
name = "debris"
postype = p2
pos = 0,0
ownpal = 1

[State 3700]; Send Gohan to next state
type = changestate
trigger1 = !animtime
value = 3115

;------------------------------------------------
;P2 State - Hit by green explosion
[Statedef 3105]
type = A
physics = N
movetype = H
ctrl = 0
velset = 0, 0

[State 3025, state - killed fatality]
type = changestate
trigger1 = time>7 && MatchOver
value = 3120
ignorehitpause = 1

[State 2260, bg]
type = assertspecial
trigger1 = 1
flag = noFG
flag2 = noBG
flag3 = nobardisplay
ignorehitpause = 1

[State 3020, 2]
type = changeanim2
trigger1 = !time && anim !=3105
value = 3105

[State 3020, 2]
type = velset
trigger1 = time=10
X = -13
Y = 0

[State 181, 1]
type = NotHitBy
trigger1 = 1
value = SCA
time = 200

[State 1050, 1]
type = sprpriority
trigger1 = 1
value = 1

[State 182, 1]
type = screenbound
trigger1 = 1
movecamera = 0,0
value = 0

[State 3020, 2]
type = velset
trigger1 = pos Y > 300
X = 0
Y = 0

[State 3000, state] ;go to ground
type = ChangeState
trigger1 = P2StateNo = 3115   ;2791
value = 3106
ctrl = 0

;------------------------------------------------
; P2 goes back to ground
[StateDef 3106] 
type = S
movetype = H
physics = N
ctrl = 0
sprpriority = -1
velset = -10, 8

[State 182, 1]
type = screenbound
trigger1 = 1
movecamera = 0,0
value = 0

[State 182, 1]
type = PosSet
trigger1 = !time
X = 300*IfElse(facing=1,1,-1)
Y = -200

[State 182, 1]
type = ChangeAnim2
trigger1 = !time && anim!=3106
value = 3106

[State 13100, shake]
type = envshake
trigger1 = Pos Y >= 10
trigger1 = Vel Y > 0
time = 15
freq = 90
ampl = 6

[State 1200]
type = ChangeState
trigger1 = Pos Y >= 10
trigger1 = Vel Y > 0
value = 3107

;---------------------------------------------------------------------------
;P2 bouncing on the ground
[Statedef 3107]
type    = L
movetype= H
physics = N

[State 3000, nhb]
type = NotHitBy
trigger1 = 1
time = 1
value = SCA

[State 5100, 1]
type = VelSet
trigger1 = Time = 0
trigger1 = GetHitVar(fall.yvel) = 0
trigger1 = vel x > 1
x = 1

[State 5100, EnvShake]
type = FallEnvShake
trigger1 = Time = 0

[State 5100, Var] ;Save fall velocity
type = VarSet
trigger1 = Time = 0
sysvar(1) = floor(vel y)

[State 5100, 2] ;Hit ground anim (normal)
type = ChangeAnim
triggerall = time = 0
trigger1 = (anim != [5051,5059]) && (anim != [5061,5069])
trigger2 = !SelfAnimExist(5100 + (anim % 10))
value = 5100

[State 5100, 3] ;Hit ground anim (for hit up)
type = ChangeAnim
trigger1 = time = 0
trigger1 = (anim = [5051,5059]) || (anim = [5061,5069])
trigger1 = SelfAnimExist(5100 + (anim % 10))
value = 5100 + (anim % 10)

[State 5100, 4]
type = PosSet
trigger1 = Time = 0
y = 0

[State 5100, 5]
type = VelSet
trigger1 = Time = 0
y = 0

[State 5100, 6] ;Reduce speed
type = VelMul
trigger1 = Time = 0
x = 0.6

;[State 5100, 10]  ;remember kids: never put sound effects in a custom state!!!!!
;type = PlaySnd
;trigger1 = Time = 1
;value = F7,2

[State 5100, 5]
type = VelSet
trigger1 = AnimTime = 0
y = -5

[State 111, 1]
type = StateTypeSet
trigger1 = AnimTime = 0
physics = A

[State 5100, 12]
type = ChangeState
trigger1 = AnimTime = 0
value = 3108    ;=5050 modified
;---------------------------
; HITA_FALL (knocked up, falling)
[Statedef 3108]
type    = A
movetype= H
physics = N
ctrl = 0

[State 3000, nhb]
type = NotHitBy
trigger1 = 1
time = 1
value = SCA

[State 5050, 1] ;Change anim when done with transition
type = ChangeAnim
trigger1 = AnimTime = 0
trigger1 = Anim = 5035
trigger2 = Time = 0     ;If no transition anim
trigger2 = Anim != 5035
trigger2 = (Anim != [5051, 5059]) && (Anim != [5061, 5069])
trigger2 = Anim != 5090 ;Not if hit off ground anim
value = 5050

[State 5050, 2] ;Coming down anim
type = ChangeAnim
trigger1 = anim = [5050,5059]
trigger1 = Vel Y >= IfElse(anim = 5050, 1, -2)
trigger1 = SelfAnimExist(anim+10)
value = anim+10
persistent = 0

[State 5050, 3] ;Gravity
type = VelAdd
trigger1 = 1
y = GetHitVar(yaccel)

[State 5050, 6]
type = ChangeState
trigger1 = Vel Y > 0
trigger1 = Pos Y >= IfElse((anim = [5051,5059]) || (anim = [5061,5069]), 0, 25)
value = 3109   ;=5100 modified

;---------------------------------------------------------------------------
; HIT_BOUNCE (hit ground)
[Statedef 3109]
type    = L
movetype= H
physics = N
ctrl = 0

[State 3000, nhb]
type = NotHitBy
trigger1 = 1
time = 1
value = SCA

[State 5100, 1]
type = VelSet
trigger1 = Time = 0
trigger1 = GetHitVar(fall.yvel) = 0
trigger1 = vel x > 1
x = 1

[State 5100, EnvShake]
type = FallEnvShake
trigger1 = Time = 0

[State 5100, Var] ;Save fall velocity
type = VarSet
trigger1 = Time = 0
sysvar(1) = floor(vel y)

[State 5100, 2] ;Hit ground anim (normal)
type = ChangeAnim
triggerall = time = 0
trigger1 = (anim != [5051,5059]) && (anim != [5061,5069])
trigger2 = !SelfAnimExist(5100 + (anim % 10))
value = 5100

[State 5100, 3] ;Hit ground anim (for hit up)
type = ChangeAnim
trigger1 = time = 0
trigger1 = (anim = [5051,5059]) || (anim = [5061,5069])
trigger1 = SelfAnimExist(5100 + (anim % 10))
value = 5100 + (anim % 10)

[State 5100, 4]
type = PosSet
trigger1 = Time = 0
y = 0

[State 5100, 5]
type = VelSet
trigger1 = Time = 0
y = 0

[State 5100, 6] ;Reduce speed
type = VelMul
trigger1 = Time = 0
x = 0.75

[State 5100, 11]
type = PosFreeze
trigger1 = 1

[State 5100, 12]
type = ChangeState
trigger1 = AnimTime = 0
value = 3110    ;=5101 modified

;---------------------------------------------------------------------------
; HIT_BOUNCE (bounce into air)
[Statedef 3110]
type    = L
movetype= H
physics = N

[State 3000, nhb]
type = NotHitBy
trigger1 = 1
time = 1
value = SCA

[State 5101, 1] ;Coming hit ground anim (normal)
type = ChangeAnim
triggerall = time = 0
trigger1 = anim != [5101,5109]
trigger2 = !SelfAnimExist(5160 + (anim % 10))
value = 5160

[State 5101, 2] ;Coming hit ground anim (for hit up)
type = ChangeAnim
triggerall = time = 0
trigger1 = anim = [5101,5109]
trigger1 = SelfAnimExist(5160 + (anim % 10))
value = 5160 + (anim % 10)

[State 5101, 3]
type = HitFallVel
trigger1 = Time = 0

[State 5101, 4]
type = PosSet
trigger1 = Time = 0
y = 20

[State 5101, 5] ;Acceleration
type = VelAdd
trigger1 = 1
y = .4

[State 5101, 6] ;Hit ground
trigger1 = Vel Y > 0
trigger1 = Pos Y >= 12
type = ChangeState
value = 3111   ;=5110 modified

;---------------------------------------------------------------------------
; HIT_LIEDOWN
[Statedef 3111]
type    = L
movetype= H
physics = N

[State 3000, nhb]
type = NotHitBy
trigger1 = 1
time = 1
value = SCA

[State 5110, EnvShake]
type = FallEnvShake
trigger1 = Time = 0

[State 5110, 2] ;Hit ground anim (normal)
type = ChangeAnim
triggerall = time = 0
triggerall = anim != [5110,5119] ;Not already changed anim
trigger1 = anim != [5161,5169]
trigger2 = !SelfAnimExist(5170 + (anim % 10))
value = 5170

[State 5110, 4]
type = HitFallDamage
trigger1 = Time = 0

[State 5110, 5]
type = PosSet
trigger1 = Time = 0
y = 0

[State 5110, Var] ;Get fall velocity
type = VarSet
trigger1 = Time = 0
trigger1 = GetHitVar(fall.yvel) != 0
sysvar(1) = floor(vel y)

[State 5110, 6]
type = PlaySnd
trigger1 = Time = 0
trigger1 = !SysVar(0)
;value = F7, (sysvar(1) > 5) + (sysvar(1) > 14)
value = F7,2

[State 5110, 8]
type = VelSet
trigger1 = Time = 0
y = 0

[State 5110, 9] ;For hit up type
type = ChangeAnim
persistent = 0
triggerall = anim = [5171,5179]
triggerall = SelfAnimExist(5110 + (anim % 10))
trigger1 = AnimTime = 0
trigger2 = SysVar(0) ;SysVar(0) = 1 avoids hit ground anim
value = 5110 + (anim % 10)

[State 5110, 10] ;For normal
type = ChangeAnim
persistent = 0
triggerall = Anim != [5111,5119]
trigger1 = AnimTime = 0
trigger2 = SysVar(0) ;SysVar(0) = 1 avoids hit ground frame
value = 5110

[State 5110, 11] ;If just died
type = SelfState
triggerall = !alive
trigger1 = AnimTime = 0
trigger2 = SysVar(0) ;SysVar(0) = 1 avoids hit ground frame
trigger3 = Anim = [5110,5119]
value = 5150

[State 5110, 11] ;Alive
type = SelfState
triggerall = alive
trigger1 = time = 40
value = 5120

[State 5110, 12]
type = VarSet
trigger1 = SysVar(0)
trigger1 = Time = 0
sysvar(0) = 0

[State 5110, 13] ;Friction
type = VelMul
trigger1 = 1
x = 0.85

;-------------------------
; Gohan Fall back to ground
[Statedef 3115]
type    = A
movetype = I
physics = N
anim = 2790
juggle = 0
ctrl = 0
velset = 0,0
facep2 = 1
sprpriority = 2

[State -2, Var]
type = Varset
trigger1 = !time
fvar(28) = 0

[State 3020, pos]
type = PosSet
trigger1 = !time
X = -60*IfElse(facing=1,1,-1)
Y = -300

[State 182, 1]
type = screenbound
trigger1 = 1
movecamera = 0,0
value = 0

[State -2, Vel]
type = VelAdd
trigger1 = time>30
Y = 0.4

[State -2, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = nobardisplay
ignorehitpause = 1

[State 3700]; Send Gohan to next state
type = changestate
trigger1 = pos Y >= -5
value = 2795
ctrl = 0


;---------------------------------------------------------------------------------------
;Prevent Freezing from Fatality 2
[Statedef 3120]
type = S
movetype= H
physics = N
velset = 0,0

[State 182, 1]
type = screenbound
trigger1 = 1
movecamera = 0,0
value = 1

[State 49999, 1]
type = LifeSet
trigger1 = 1
value = 0

[State 49999, 1]
type = PosSet
trigger1 = time > 50
y = 9000

[State 49999, 5]
type = ChangeAnim2
trigger1 = !time
value = 15999

[State 444, 0]
type = Changestate
trigger1 = time >=60
value = 5150




;===========================================================================
; <<<<< UNLEASHED GEKIRETSU RANBU - FATALITY 3 >>>>>
; Teleports in : 						3200
; f.SK :							3201
; P2 State - sent away : 					3202
; Gohan Chou Kmh charge : 					3205
; Goten [HELPER] : 						3210
; Goten lands [HELPER] : 					3211
; Goten charges [HELPER] : 					3212
; Goten launches [HELPER] : 					3213
; Goten Moving out at end of finisher 3 [HELPER] :		3214
; Throwing Team Chou Kamehameha : 				3220
; Chou Kamehameha [HELPER] : 					3221 (tip) & 3222 (beam)
; Horizontal Background lines : 				3224
; Moving out of screen while throwing Chou Kmh : 		3225
; Goten Moving out of screen while throwing Chou Kmh [HELPER] :	3226
; Gohan Kamehameha FX beam simple [HELPER] : 			3227
; Goten Kamehameha FX beam simple [HELPER] : 			3228
; Twirl FX [HELPER] :						3229
; Beam + Twirl FX [HELPER] :					3231
; P2 state - comes back to screen :				3235
; Gohan waiting out of screen :					3240
; Going back to screen - HD winpose :				3241
; P2 state - sent high in sky if not killed :			3245
; P2 states from modified 5000 states :				3246-3250
; Circus Act Winpose (in system.cns) :				3260
;===========================================================================

; FATALITY 3
; Gohan Teleports in
[Statedef 3200]
type    = S
movetype = A
physics = N
anim = 3200
juggle = 0
ctrl = 0
velset = 0,0
facep2 = 1
sprpriority = 2

[state 0] ;exit emo mode
type = varset
trigger1 = !time
fvar(27) = 0
ignorehitpause = 1

[State 1010, VarAdd - for 'dmg dampening']
type = VarAdd
trigger1 = !Time
fvar(13) = -4
ignorehitpause = 1

[State 3020, pos]
type = PosSet
trigger1 = !time
X = enemy,pos X + 50*facing
Y = 0

[State 3020, pos]
type = Turn
trigger1 = !time

[State 182, 1]
type = screenbound
trigger1 = 1
movecamera = 0,0
value = 0

[State -2, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = nobardisplay
ignorehitpause = 1

[State 250, teleport sound]
type = PlaySnd
trigger1 = AnimElem = 2
value = 2302, 0

[State 3700]; Send Gohan to next state
type = changestate
trigger1 = !animtime
value = 3201
ctrl = 0

;-------------------------
; Gohan - f.SK
[Statedef 3201]
type    = A
movetype = A
physics = N
anim = 3201
juggle = 0
ctrl = 0
velset = 0,0
facep2 = 1
sprpriority = 2

[State 0, VarSet]
type = VarSet
trigger1 = 1
var(9) = 0

[State -2, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = nobardisplay
ignorehitpause = 1

[State 280, go]
type = VelSet
trigger1 = animelem = 1
y = -6

[State 220, snd]
type = null;PlaySnd
triggerall = var(55)=0		;Voice=Japan
trigger1 = animelem=1
value = 260,1
channel = 0

[State 200, 1];voice
type = null;PlaySnd
triggerall = var(55)=1		;Voice=English
trigger1 = animelem=1
value = 3,104+random%4
channel = 0

[State 200, 1];voice
type = PlaySnd
;triggerall = var(55)=2		;Voice=Custom Corey Holland
trigger1 = animelem=1
value = 3,220+random%9
channel = 0

[State 280, go]
type = VelAdd
trigger1 = animelemtime(1) > 0 && animelemtime(8) < 0
Y = 0.5
ignorehitpause = 1

[State 220, land]
type = statetypeset
trigger1 = animelem=8 
statetype = S

[State 280, go]
type = VelSet
trigger1 = animelem = 8
x = 0
y = 0

[State 1, land]
type = PosSet
trigger1 = animelem=8
y = 0

[State 1, go]
type = PosAdd
trigger1 = animelem=9
x = 20

[State 250, wheel kick SFX]
type = PlaySnd
trigger1 = AnimElem = 2
value = 270,0

[State 250, 1]
type = PlaySnd
trigger1 = AnimElem = 8
value = 0, 5

[State 250, 2]
type = HitDef
trigger1 = AnimElem = 9
attr = S, HA
animtype  = diagup
damage = Ceil(IfElse(fvar(11) * 44 < 22, 22, fvar(11) * 44)), 0
;Ceil(IfElse(fvar(11) * 44 < 7, 7, fvar(11) * 44)), 0
; 44,0
;priority = 4, Hit
guardflag = MAF
pausetime = 21,22
guard.pausetime = 22,22
sparkno = s7030
guard.sparkno = s7000
sparkxy = -30,-80
hitsound   = S2604,0
guardsound = S6,1
ground.type = low
ground.slidetime = 30
ground.hittime = 30
ground.velocity = ifelse(facing != enemy,facing,-6,6),-6
air.velocity = ifelse(facing != enemy,facing,-4,4),-4
air.animtype = diagup
getpower= 0,0
givepower = 35,35
yaccel = 0.5
p2facing = 1
fall = 1
fall.recovertime = 45
envshake.time = 40
envshake.freq = 200
envshake.ampl = 10 
kill = 0
;p2stateno = 3202
id = 3202

[State 0, TargetState]  ;New state
type = TargetState
trigger1 = Numtarget(3202)
trigger1 = movehit = 1
value = 3202
ID = 3202
ignorehitpause = 1
persistent = 0

[State 1, go]
type = PosAdd
trigger1 = animelem=15
x = -20

[State 250, 3]
type = ChangeState
triggerall = Numtarget(3202)
triggerall = target, StateNo = 3202
trigger1   = AnimTime = 0
value      = 3205
ctrl       = 0

[State 250, 3]
type = ChangeState
triggerall = !Numtarget(3202)
trigger1   = AnimTime = 0
value      = 0
ctrl       = 1

;------------------------------------------------
; P2 sent away
[StateDef 3202]
type = A
movetype = H
physics = N
velset = ifelse(facing = enemy,facing,10,-10),-0.5
ctrl = 0
sprpriority = -1
facep2 = 1

;[State -3, GetHit Snd]
;type=PlaySnd
;trigger1 = !time
;value = 5000,1+(random%5)
;ignorehitpause = 1

[State 0, NotHitBy]
type = NotHitBy
trigger1 = 1
value = SCA,NA,SA,HA,NP,SP,HP,NT,ST,HT
;value2 = S,NA
time = 1

[State 13200, Anim]
type = ChangeAnim
trigger1 = Time = 0
value = IfElse(selfanimexist(5052),5052,5030)

[State 182, 1]
type = screenbound
trigger1 = 1
movecamera = 0,0
value = 0

[State 3000, state] ;invisible
type = ChangeAnim2
trigger1 = time = 20
value = 15999

[State 3000, state] ;go back to screen (finally !)
type = ChangeState
trigger1 = Time >20
trigger1 = enemy,numhelper(3231)
trigger2 = enemy, anim = 4017
trigger2 = Time > 505
value = 3235


;-----------------------------------------------------
; Gohan Chou Kmh charge
[Statedef 3205]
type = S
physics = S
movetype = A
anim = 2400
ctrl = 0
velset = 0,0
sprpriority = 1

[State 0, VarSet]
type = VarSet
trigger1 = 1
var(9) = 0

[State -2, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = nobardisplay
ignorehitpause = 1

[State 0, AssertSpecial]
type = AssertSpecial
triggerall = anim = 2400
trigger1 = 1
flag = noFG

[State 3000, nhb]
type = NotHitBy
trigger1 = 1
time = 1
value = SCA

[State 1000, shake]
type = EnvShake
triggerall = anim=2400
trigger1 = !(time%4)
time=4
freq=80
ampl=2+0.02*time

[State 200, Kmh charge long]
type = PlaySnd
triggerall = anim = 2400
trigger1 = time = 60
value = 2400,1

[State 200, 1];charge power-up sound
type = PlaySnd
trigger1 = time = 5
value = 2400,20
channel = 5

[State 200, electricity]
type = PlaySnd
trigger1 = time > 60
trigger1 = (GameTime%40) = 20
value = 2400,2
volume = 10

[State 2500, bgpalfx1]
type = bgpalfx
triggerall = anim = 2400
trigger1 = 1  ;time = [1,200]
time = 1
color=0
mul=0,0,0

[State 200, SuperPause sound]
type = PlaySnd
trigger1 = time=5
value = 2350,0

[State 3000, SuperPause]
type = SuperPause
triggerall = anim = 2400
trigger1 = time=5
time = 192
p2defmul = 1
unhittable = 1
anim = -1
darken = 0
movetime = 192

[State 0, Charge Ball FX]
type = Explod
triggerall = anim = 2400
trigger1 = time = 5
anim = 2420+10000*(var(2)=0)
id = 2420
pos = -25,-60
postype = p1
supermovetime = 9999
pausemovetime = 9999
supermove = 1
removetime = -1
sprpriority = 3
ownpal = 1
bindtime = -1
scale = 0.6,0.6
persistent = 0

[state 17100, scale charge FX]
type = ModifyExplod
trigger1 = numexplod(2420)
scale = 0.6+0.002*(time-20),0.6+0.002*(time-20)
id = 2420

[State 0, Charge lightning FX]
type = Explod
triggerall = anim = 2400
trigger1 = time = 5
anim = 2430
id = 2430
pos = -25,-57
postype = p1
supermovetime = 9999
pausemovetime = 9999
supermove = 1
removetime = -1
sprpriority = 5
ownpal = 1
bindtime = -1
scale = 1,1
persistent = 0

[State 0,from sky lightning]
type = explod
triggerall = anim = 2400 && time>=45
trigger1 = gametime%(40-var(26)/5) = 0
anim = 2450+random%6
sprpriority = 7
postype = p1
pos = 0,ceil(pos y)
facing = IfElse(random<500,-1,1)
random = 160,0
scale = 1,2
pausemovetime = -1
supermovetime = -1
ownpal = 1

[State 0, lightning sound]
type = PlaySnd
triggerall = anim = 2400 && time>=45
trigger1 = gametime%(40-var(26)/5) = 0
value = 2400,3
volume = -170-(32*numexplod)
freqmul = .9 + (random/5000.0)

[State 1211, BGPalFX]
type = BGPalFX
triggerall = anim = 2400 && time>=45
trigger1 = gametime%(40-var(26)/5) = 0
time = 3
color = 0
invertall = 1

[State 3000, GOTEN]
type = helper
trigger1 = time = 40
helpertype = normal
stateno = 3210
ID = 3210
name = "goten"
supermovetime = 999999
pausemovetime = 999999

[State 200, 1];Voice (Kamehameha)
type = PlaySnd
trigger1 = time = 50
value = 3205,0
channel = 0
volume = 355

[State 200, 1];Voice (Kamehameha)
type = PlaySnd
trigger1 = time = 85
value = 3205,1
channel = 0
volume = 355

[State 200, 1];voice (Kamehameha)
type = PlaySnd
trigger1 = time = 150
value = 3205,2
channel = 0
volume = 255

[State 0, Helper]
type = Helper
trigger1 = Time = 80
name = "Goku"
ID = 4002
stateno = 4002
pos = -40,-30
postype = p1    ;p2,front,back,left,right
facing = 1
supermovetime = 999

;Throw Kmh
[State 901, ChangeAnim]
type = ChangeState
trigger1 = time = 250
value = 3220
ctrl = 0

;-----------------------------
;Throwing Team Chou Kamehameha
[Statedef 3220]
type = S
physics = S
movetype = A
anim = 2401
ctrl = 0
velset = 0,0
sprpriority = 1

[State 0, ChangeAnim]
type = ChangeAnim
trigger1 = NumHelper(4002)
trigger1 = helper(4002), StateNo = 4003
value = 4017
persistent = 0

[State -2, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = nobardisplay
flag2 = noFG
ignorehitpause = 1

[State 2500, bgpalfx1]
type = bgpalfx
trigger1 = 1
time = 1
color=0
mul=0,0,0

[state -2, remove charge ball FX Chou Kmh]
type = removeexplod
trigger1 = !time
id = 2420
[state -2, remove lightning FX]
type = removeexplod
trigger1 = !time
id = 2430

[State 3000, nhb]
type = NotHitBy
trigger1 = 1
time = 1
value = SCA

[State 1000, shake]
type = EnvShake
trigger1 = !(time%4)
time=4
freq=80
ampl=4

[State 200, 1];Launching SFX
type = PlaySnd
trigger1 = time=4
value = 2401,1

[State 200, 1];Super Launching Twirl SFX
type = PlaySnd
trigger1 = anim=2401 && animelem=4
value = 3225,0
volume = 300
persistent = 0

[state 1215, Smoke FX]
type = explod
trigger1 = anim=2401 && animelem=3
trigger2 = Anim = 4017 && AnimElemTime(1) = 1
anim = 1206+(var(2)=0)
id = 1206
pos = -25,3
postype = P1
sprpriority = 3
ownpal = 1
removetime = -2
persistent = 0
ignorehitpause = 1

[state 1215, Flash FX]
type = explod
trigger1 = anim=2401 && time=3
trigger2 = Anim = 4017 && AnimElemTime(1) = 1
anim = 2406
id = 2405
pos = 0,0
postype = P1
sprpriority = 3
ownpal = 1
removetime = -1
persistent = 0
ignorehitpause = 0

[State 3000, Kamehameha]
type = helper
trigger1 = anim=2401 && animelem=3 
helpertype = normal
stateno = 3221   ;2402
ID = 3221   ;2402
name = "ckameha"
postype = p1
pos = 40,-54
ownpal = 1
persistent = 0


[State -2, Explod];On hands explod
type = Explod
triggerall = !numexplod(3220)
trigger1 = anim=2401 && animelem=3
anim = 2403
removetime = -1
sprpriority = 4
id = 3220
ownpal = 1
pos = 53,-54
ignorehitpause = 1
bindtime = -1

[State 0, RemoveExplod]
type = RemoveExplod
trigger1 =  Anim = 4017
id = 3220

[State 3000, Kamehameha FX beam]
type = helper
trigger1 = anim=2401 && animelem=3
helpertype = normal
stateno = 3222  ;2464
ID = 3222       ;2464
name = "ckamehaFX_scale_beam"
postype = p1
pos = 47,-54
ownpal = 1

;move out of screen
[State 901, ChangeAnim]
type = ChangeState
trigger1 = time = 100
value = 3225
ctrl = 0

;-----------------------------
;Moving out of screen while throwing Team Chou Kamehameha
[Statedef 3225]
type = S
physics = S
movetype = A
ctrl = 0
velset = -7,0
sprpriority = 1

[State 2201, helper]; Background lines
type = Helper
trigger1 = !time
pos = -640, -480
postype = back
stateno = 3224
helpertype = normal
name = "horizontal_lines_BG"
id = 3224
ownpal = 1
supermovetime = 150
pausemovetime = 150
sprpriority = 4
size.xscale = 5
size.yscale= 5

[State 0, Explod]
type = Explod
trigger1 = Anim = 4017
trigger1 = !NumExplod(3326)
trigger1 = time >40 
anim = 3326
ID = 3326
pos = 90,-110
postype = p1  ;p2,front,back,left,right
facing = 1
bindtime = 1
vel = 12,0
removetime = -2
supermovetime = 999
scale = 1.5,1.2
sprpriority = 5

[State -2, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = nobardisplay
flag2 = noFG
ignorehitpause = 1

[State 2500, bgpalfx1]
type = bgpalfx
trigger1 = 1
time = 1
color=0
mul=0,0,0

[State 3000, nhb]
type = NotHitBy
trigger1 = 1
time = 1
value = SCA

[State 3001, screen]
type = Screenbound
trigger1 = 1
movecamera = 0,0
value = 0

[State 1000, shake]
type = EnvShake
trigger1 = !(time%4)
time=4
freq=80
ampl=4

[State -2, Explod];On hands explod
type = modifyExplod
triggerall = !numexplod(3220)
trigger1 = Time=20
anim = 2403
removetime = -1
sprpriority = 4
vel = -12,0
id = 3220
ownpal = 1
pos = 53,-54
ignorehitpause = 1
bindtime = 1

[State 1061, Velocity];;;;;; 100
type = VelSet
trigger1 = time < 20
x = -12
[State 1061, Velocity]
type = VelSet
trigger1 = time = 35
x = 0

[State 3000, Gohan Kamehameha FX beam]
type = helper
trigger1 =  Anim != 4017
trigger1 = time = 50
helpertype = normal
stateno = 3227
ID = 3227
name = "fixed_beam_simple_Gohan"
postype = p1
pos = 47,-54
ownpal = 1

[State 3000, Goten Kamehameha FX beam]
type = helper
trigger1 =  Anim != 4017
trigger1 = time = 52
helpertype = normal
stateno = 3228
ID = 3228
name = "fixed_beam_simple_Goten"
postype = p1
pos = 47,-34
ownpal = 1
size.yscale = 0.7


[State 1061, End]
type = RemoveExplod
trigger1 = Time >= 30
ID = 3220

[State 1061, End]
type = RemoveExplod
trigger1 = var(36)>0 && time>10
ID = 3220

[State 1305, P2 pushed sound]
type = PlaySnd
trigger1 = time>200 && enemy,stateno=3235 && enemy,vel X = 0
value = 3225,1
volume = 300
persistent = 0

[State 200, 1];Beam looping sound
type = PlaySnd
trigger1 =  Anim != 4017
trigger1 = time=200
value = 2480,0
volume = 300
loop = 1
channel = 5

;---------------------------
; START HITTING P2

[State 800, count]
type = VarSet
trigger1= !time
var(36) = 0

[State 800, count]; time>380 before
type = VarAdd
trigger1= (time%3=0) && (time> 350) && var(36)<=80
var(36) = 1

[State 1315, Sparks]
type=explod
trigger1= NumTarget
trigger1 = Anim != 4017
trigger1= (time%4=0) && (time> 350) && var(36)<=80
anim=7030
sprpriority=8
postype=p2
pos=(target,const(size.ground.front)-40)+(random%60), (random%60)-30
removetime=-2
ownpal=1
facing=-1
ignorehitpause=1
pausemovetime=100
supermovetime=100

[State 1315, Sparks]
type=explod
trigger1= NumTarget
trigger1 = Anim = 4017
trigger1= (time%3=0) && (time> 350) && var(36)<=80
anim=7030
sprpriority=8
postype=p2
pos=(target,const(size.ground.front)-40)+(random%60), (random%60)-30
removetime=-2
ownpal=1
facing=-1
ignorehitpause=1
pausemovetime=100
supermovetime=100

[State 800, count]
type = HitAdd
trigger1= (time%3=0) && (time> 350) && var(36)<=80
value = 1

[State 800, count]
type = HitAdd
trigger1= (time%5=0) && (time> 350) && var(36)<=80
trigger1 = Anim = 4017
value = 1

[State 13100, shake]
type = envshake
trigger1 = (time> 220) && var(36)<=80
trigger1 = (time%12)=0
time = 12
freq = 150
ampl = 10

[State 800, hitsound]
type = PlaySnd
trigger1= (time%6=0) && (time> 350) && var(36)<=80
trigger1 = Anim != 4017
value = s1000,0
volume = 300
[State 800, hitsound]
type = PlaySnd
trigger1= (time%5=0) && (time> 350) && var(36)<=80
trigger1 = Anim = 4017
value = s1000,0
volume = 300

[State 13100, Hurt]
type = TargetLifeAdd
trigger1 = var(36) = 80
trigger1 = Anim != 4017
value = ceil(ifElse(fvar(11) * -280 > -140, -140, fvar(11) * -280))
kill = 1
persistent = 0

[State 13100, Hurt]
type = TargetLifeAdd
trigger1 = var(36) = 80
trigger1 = Anim = 4017
value = ceil(ifElse(fvar(11) * -380 > -190, -190, fvar(11) * -380))
kill = 1
persistent = 0

[State 13100, Hurt]
type = TargetPowerAdd
trigger1 = var(36) = 80
value = 100
persistent = 0

[State 1315, White BG Fades]
type = explod
triggerall = Anim = 4017
triggerall = enemynear, stateno != [5941,5946]
trigger1= Time = 530
anim = 3021
ID = 322555
pos =  160,120
postype = left
sprpriority = 7
ontop = 1
facing = 1
bindtime = -1
ownpal = 1
removetime = -2
pausemovetime = 99999999999999
supermovetime = 99999999999999
supermove = 1
scale = 1.20,1.20
ignorehitpause = 1
persistent = 0

[State 1315, White BG Fades]
type = explod
triggerall = enemynear, stateno != [5941,5946]
trigger1= Time = 588
anim = 3020
ID = 322555
pos =  160,120
postype = left
sprpriority = 7
ontop = 1
facing = 1
bindtime = -1
ownpal = 1
removetime = -2
pausemovetime = 99999999999999
supermovetime = 99999999999999
supermove = 1
scale = 1.20,1.20
ignorehitpause = 1
persistent = 0

[State 13100, Back to screen]
type = ChangeState
trigger1 = var(36) = 80
value = 3240
ctrl = 0

;------------------------------------------------
; P2 comes back to screen
[StateDef 3235]
type = A
movetype = H
physics = N
velset = 0,0
ctrl = 0
sprpriority = -1

[State 13200, Anim]
type = ChangeAnim2
trigger1 = Time = 0
value = 3235

[State 182, 1]
type = screenbound
trigger1 = 1
movecamera = 0,0
value = 0

[State 13200, Pos]
type = PosSet
trigger1 = Time = 0
X = -500*facing
Y = -(enemy,screenpos Y) + 120

[State 13200, Vel]
type = VelSet
trigger1 = Time = 0
X = 8

[State 13200, Vel]
type = VelSet
trigger1 = Time = 60
X = 0

[State 1000, shake]
type = EnvShake
trigger1 = Time = 60
time=10
freq=130
ampl=7

[State 13200, Hit]
type = ChangeAnim2
trigger1 = Time = 60
Value = 3236

[State 13200, Pos if fatality]
type = PosAdd
trigger1 = enemy,stateno=3240
trigger1 = MatchOver
Y = -const(size.mid.pos.Y)

[State 3025, p2state - killed fatality]
type = changestate
trigger1 = enemy,stateno=3240
trigger1 = MatchOver
value = IfElse(SelfAnimExist(5941), 5941, 5943)
ignorehitpause = 1

[State 801, end]
type = changestate
trigger1 = enemy,stateno=3240
trigger1 = enemy,time > 15
value = 3245
ctrl = 0

;----------------------------
; Gohan waiting
[Statedef 3240]
type = A
physics = N
movetype = A
ctrl = 0
sprpriority = 1
velset = 0,0

[State 182, 1]
type = screenbound
trigger1 = 1
movecamera = 0,0
value = 0

[State 3025, killed, beam fatality sound]
type = PlaySnd
trigger1 = numenemy
trigger1 = (enemy,stateno=5941 || enemy,stateno=5943 || enemy,stateno=2990) && enemy,time=30
value = 5941,0
volume = 300
persistent = 0

[State 13100, Back to screen]
type = ChangeState
;triggerall = enemy,stateno != 2990   ;;;;;;;;;;
trigger1 = time >= 60+40*MatchOver
value = 3241
ctrl = 0

;---------------------------------------
; Going back to screen - HD winpose
[Statedef 3241]
type    = S
movetype = A
physics = N
ctrl = 0
anim = 3241
sprpriority = 1
velset = 0,0

[State 1000, goten]
type = Helper
helpertype = normal
trigger1 = time=1
name = "goten_out"
postype = P1
pos = -45,0
stateno = 3214
id = 3214

[State -2, Explod];On hands explod
type = RemoveExplod
trigger1 = !time
ID = 3220

[State -2, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = nobardisplay
ignorehitpause = 1

[State 13200, to circus winpose variable]
type = Varset
triggerall = var(37) = 0
trigger1 = NumEnemy = 1
trigger1 = P2Life = 0
trigger2 = NumEnemy = 2
trigger2 = (EnemyNear(0), Life) + (EnemyNear(1), Life) = 0
var(37) = 1

[State 13200, to circus winpose]
type = ChangeState
trigger1 = time=80 && winko
value = 3260

[State 13200, go back to stance]
type = ChangeAnim
trigger1 = Time = 80
Value = 3242

[State 13200, to stance]
type = ChangeState
trigger1 = Anim=3242 && !animtime
value = 0
ctrl = 1

;---------------------------------------
; P2 sent very high in the sky (if not killed)
[StateDef 3245]
type = A
movetype = H
physics = A
velset = -1,-25
ctrl = 0
sprpriority = -1

[State 182, 1]
type = screenbound
trigger1 = 1
movecamera = 0,0
value = 0

[State 5035, 1]
type = ChangeAnim2
trigger1 = Time = 0
value = 3245

[State 13100, Back to screen]
type = ChangeState
trigger1 = time = 0
value = 3246   ; modified state 5035
ctrl = 0

;---------------------------------------------------------------------------
; HITA_UP_T (transition)
[Statedef 3246]
type    = A
movetype= H
physics = N
ctrl = 0

[State 182, 1]
type = screenbound
trigger1 = 1
movecamera = 0,0
value = 0

[State 5035, 1]
type = ChangeAnim
trigger1 = Time = 0
trigger1 = SelfAnimExist(5035)
trigger1 = Anim != [5051,5059] ;Not if in hit up anim
trigger1 = Anim != 5090 ;Not if hit off ground anim
value = 5035

[State 5035, 4]
type = ChangeState
triggerall = HitFall
trigger1 = HitOver  ;Hit is over
trigger2 = AnimTime = 0 ;Anim is over
trigger3 = Vel Y > 0    ;Hit ground
trigger3 = Pos Y >= 10  ;.
trigger4 = Time = 0     ;No transition anim
trigger4 = Anim != 5035 ;.
value = 3247   ; modified state 5050

;---------------------------------------------------------------------------
; HITA_FALL (knocked up, falling)
[Statedef 3247]
type    = A
movetype= H
physics = N
ctrl = 0

[State 182, 1]
type = screenbound
trigger1 = 1
movecamera = 0,0
value = 0

[State 5050, 1] ;Change anim when done with transition
type = ChangeAnim
trigger1 = AnimTime = 0
trigger1 = Anim = 5035
trigger2 = Time = 0     ;If no transition anim
trigger2 = Anim != 5035
trigger2 = (Anim != [5051, 5059]) && (Anim != [5061, 5069])
trigger2 = Anim != 5090 ;Not if hit off ground anim
value = 5050

[State 5050, 2] ;Coming down anim
type = ChangeAnim
trigger1 = anim = [5050,5059]
trigger1 = Vel Y >= IfElse(anim = 5050, 1, -2)
trigger1 = SelfAnimExist(anim+10)
value = anim+10
persistent = 0

[State 5050, 3] ;Gravity
type = VelAdd
trigger1 = 1
y = GetHitVar(yaccel)

[State 5050, 6]
type = ChangeState
trigger1 = Vel Y > 0
trigger1 = Pos Y >= IfElse((anim = [5051,5059]) || (anim = [5061,5069]), 0, 25)
value = 3248   ; modified state 5100 ;HIT_BOUNCE

;---------------------------------------------------------------------------
; HIT_BOUNCE (hit ground)
[Statedef 3248]
type    = L
movetype= H
physics = N

[State 5100, 1]
type = VelSet
trigger1 = Time = 0
trigger1 = GetHitVar(fall.yvel) = 0
trigger1 = vel x > 1
x = 1

[State 5100, EnvShake]
type = FallEnvShake
trigger1 = Time = 0

[State 5100, Var] ;Save fall velocity
type = VarSet
trigger1 = Time = 0
sysvar(1) = floor(vel y)

[State 5100, 2] ;Hit ground anim (normal)
type = ChangeAnim
triggerall = time = 0
trigger1 = (anim != [5051,5059]) && (anim != [5061,5069])
trigger2 = !SelfAnimExist(5100 + (anim % 10))
value = 5100

[State 5100, 3] ;Hit ground anim (for hit up)
type = ChangeAnim
trigger1 = time = 0
trigger1 = (anim = [5051,5059]) || (anim = [5061,5069])
trigger1 = SelfAnimExist(5100 + (anim % 10))
value = 5100 + (anim % 10)

[State 5100, 4]
type = PosSet
trigger1 = Time = 0
y = 0

[State 5100, 5]
type = VelSet
trigger1 = Time = 0
y = 0

[State 5100, 6] ;Reduce speed
type = VelMul
trigger1 = Time = 0
x = 0.75

[State 5100, 7]
type = ChangeState
trigger1 = Time = 0
trigger1 = GetHitVar(fall.yvel) = 0
value = 3250 ;HIT_LIEDOWN

[State 5100, 11]
type = PosFreeze
trigger1 = 1

[State 5100, 12]
type = ChangeState
trigger1 = AnimTime = 0
value = 3249   ; modified state 5101

;---------------------------------------------------------------------------
; HIT_BOUNCE (bounce into air)
[Statedef 3249]
type    = L
movetype= H
physics = N

[State 5101, 1] ;Coming hit ground anim (normal)
type = ChangeAnim
triggerall = time = 0
trigger1 = anim != [5101,5109]
trigger2 = !SelfAnimExist(5160 + (anim % 10))
value = 5160

[State 5101, 2] ;Coming hit ground anim (for hit up)
type = ChangeAnim
triggerall = time = 0
trigger1 = anim = [5101,5109]
trigger1 = SelfAnimExist(5160 + (anim % 10))
value = 5160 + (anim % 10)

[State 5101, 3]
type = HitFallVel
trigger1 = Time = 0

[State 5101, 4]
type = PosSet
trigger1 = Time = 0
y = 20

[State 5101, 5] ;Acceleration
type = VelAdd
trigger1 = 1
y = .4

[State 5101, 6] ;Hit ground
trigger1 = Vel Y > 0
trigger1 = Pos Y >= 12
type = ChangeState
value = 3250   ; modified state 5110

;---------------------------------------------------------------------------
; HIT_LIEDOWN
[Statedef 3250]
type    = L
movetype= H
physics = N

[State 5110, EnvShake]
type = FallEnvShake
trigger1 = Time = 0

[State 5110, 1] ;For hit up/up-diag type (from state 5081)
type = ChangeAnim
persistent = 0
trigger1 = SelfAnimExist(5110 + (anim % 10))
trigger1 = anim = [5081,5089]
value = 5110 + (anim % 10)

[State 5110, 2] ;Hit ground anim (normal)
type = ChangeAnim
triggerall = time = 0
triggerall = anim != [5110,5119] ;Not already changed anim
trigger1 = anim != [5161,5169]
trigger2 = !SelfAnimExist(5170 + (anim % 10))
value = 5170

[State 5110, 3] ;Hit ground anim (for hit up)
type = ChangeAnim
triggerall = time = 0
triggerall = anim != [5110,5119] ;Not already changed anim
trigger1 = anim = [5161,5169]
trigger1 = SelfAnimExist(5170 + (anim % 10))
value = 5170 + (anim % 10)

[State 5110, 4]
type = HitFallDamage
trigger1 = Time = 0

[State 5110, 5]
type = PosSet
trigger1 = Time = 0
y = 0

[State 5110, Var] ;Get fall velocity
type = VarSet
trigger1 = Time = 0
trigger1 = GetHitVar(fall.yvel) != 0
sysvar(1) = floor(vel y)

[State 5110, 8]
type = VelSet
trigger1 = Time = 0
y = 0

[State 5110, 9] ;For hit up type
type = ChangeAnim
persistent = 0
triggerall = anim = [5171,5179]
triggerall = SelfAnimExist(5110 + (anim % 10))
trigger1 = AnimTime = 0
trigger2 = SysVar(0) ;SysVar(0) = 1 avoids hit ground anim
value = 5110 + (anim % 10)

[State 5110, 10] ;For normal
type = ChangeAnim
persistent = 0
triggerall = Anim != [5111,5119]
trigger1 = AnimTime = 0
trigger2 = SysVar(0) ;SysVar(0) = 1 avoids hit ground frame
value = 5110

[State 5110, 11] ;If just died
type = SelfState
triggerall = !alive
trigger1 = AnimTime = 0
trigger2 = SysVar(0)
trigger3 = Anim = [5110,5119]
value = 5150

[State 5110, 12]
type = VarSet
trigger1 = SysVar(0)
trigger1 = Time = 0
sysvar(0) = 0

[State 5110, 13] ;Friction
type = VelMul
trigger1 = 1
x = 0.85

[State 5110, 11] ;If alive
type = SelfState
triggerall = alive
trigger1 = time = 45
value = 5120




;FATHER SON KHH
[Statedef 3300]
Type=S
MoveType=A
Physics=N
Anim = 3300
Ctrl=0
VelSet=0,0

[State 0]
Type=AssertSpecial
Trigger1=1
Flag=TimerFreeze
Flag2=NoBarDisplay
Flag3=NoMusic
[State 0]
Type=AssertSpecial
Trigger1=Anim=3310
Flag=NoFG
Flag2=NoShadow
[State 0]
Type=ScreenBound
Trigger1=1
Value=0
MoveCamera=0,0

[State 0]
Type=PosSet
Trigger1=!Time
Y=0

[State 0, Helper]
type = Helper
trigger1 = !Time
name = "Camera"
ID = 3307
stateno = 3307
pos = 0,0
postype = p2


[State 0]
Type=HitAdd
Trigger1=Anim = 3300
Trigger1 = AnimElem = 6
Trigger2 = Anim = 3310
Trigger2 = AnimElem = 14
Trigger3 = Anim = 3310
Trigger3 = AnimElem = 29
Trigger4 = Anim = 3310
Trigger4 = AnimElem = 43
Value = 1
[State 0]
Type=HitAdd
Trigger1=Anim = 3310
Trigger1 = !(Time%4)
Trigger1=AnimElemTime(153)>=23 && AnimElemTime(153) < 120
Value = 6

;--[First Kick]--
[state 0, teleport]
type = posset
trigger1 = anim = 3300 && animelemtime(2)=2
x = enemynear,pos x - (ifelse(facing=1,50,-50))
y = enemynear,pos y - 20
[State 0]
Type=null;VelSet
Trigger1=Anim = 3300
Trigger1=AnimElem=2
Y=-2
[State 0]
Type=null;PosAdd
Trigger1=Anim = 3300
Trigger1=AnimElemTime(2)>=0 && AnimElemTime(6) < 0
X = (Enemy,Pos X - Pos X) * (.08 * Facing)
[State 0]
Type=VelSet
Trigger1=Anim = 3300
Trigger1=AnimElem=6
X=0
Y=0
[State 0]
Type=VelAdd
Trigger1=Anim = 3300
Trigger1=AnimElemTime(8)>=0
Y=.05

;--[FX]--
[State 0, Explod]	;Hitspark
type = Explod
Trigger1=Anim = 3300
Trigger1=AnimElem=6
anim =7020
ID = 7020
pos = 0,-110
postype =P2
bindtime = 1
SprPriority = 3
removetime =-2
removeongethit = 0
[State 0]
Type=EnvShake
Trigger1=Anim = 3300
Trigger1=AnimElem=6
Time=10
Freq=110
Ampl=7
IgnoreHitPause=1


;--[Fly after P2]--
[State 0]
Type=VelSet
Trigger1=Anim = 3300
Trigger1=AnimElem=11
X=30
Y=-20
[State 0]
Type=VelSet
Trigger1=Anim=3300
Trigger1=AnimElemTime(11)>=0
Trigger1=Pos X != [-380,380]
X=0
Y=0
;--[FX]--
[State 0]
Type=PalFX
Trigger1=Anim = 3300
Trigger1=AnimElemTime(10)=5
Time=3
Add=255,255,255
Color=0

;--[Scene Change Fly after P2]--
[State 0]
Type=ChangeAnim
Trigger1=Time = 90
Value = 3310
[State 0]
Type=AssertSpecial
Trigger1=Anim = 3310
Flag=NoBG
Flag2=Invisible

[State 0]
Type=PosSet
Trigger1=Anim = 3310
X = 0
Y = 0
[State 0]
Type=SprPriority
Trigger1=Anim = 3310
Trigger1 = AnimElem=1
Value = -1


;--[FX]--
[State 0, Explod]	;Cinematic
type = Explod
Trigger1=Anim = 3310 && NumExplod(3309)=0
anim =3309
ID = 3309
pos = 0,0
postype =P1
bindtime = -1
SprPriority = 2
removetime =-1
removeongethit = 0

;--[FX]--
[State 0, Explod]	;Speed Lines
type = Explod
Trigger1=Anim = 3310
Trigger1 = AnimElem=1
anim =2923
ID = 2923
pos = Floor(GameWidth/2) - 30,0
postype =Left
bindtime = -1
SprPriority = -2
removetime =-1
removeongethit = 0
[State 0]
Type=EnvShake
Trigger1=Anim = 3310
Trigger1=AnimElem=2
Time=10
Freq=110
Ampl=7
IgnoreHitPause=1

[State 0]
Type=RemoveExplod
Trigger1=Anim=3310
Trigger1=AnimElem = 6
Id = 2923

[State 0, Explod]	;Hitspark
type = Explod
TriggerAll=Anim = 3310
Trigger1=AnimElem=14
anim =7020
ID = 7020
pos = -75,-125
postype =P1
bindtime = 1
SprPriority = 3
removetime =-2
removeongethit = 0
[State 0]
Type=EnvShake
TriggerAll=Anim = 3310
Trigger1=AnimElem=14
Trigger2 = AnimElem = 29
Time=10
Freq=110
Ampl=7
IgnoreHitPause=1
[State 0]
Type=PalFX
Trigger1=Anim = 3310
Trigger1=AnimElem = 19
Time=3
Add=255,255,255
Color=0
[State 0]
Type=SprPriority
Trigger1=Anim = 3310
Trigger1 = AnimElem=20
Value = 2
[State 0, Explod]	;Hitspark
type = Explod
TriggerAll=Anim = 3310
Trigger1=AnimElem=29
anim =7020
ID = 7020
pos = 30,-91
postype =P1
bindtime = 1
SprPriority = 3
removetime =-2
removeongethit = 0
[State 0]
Type=null;EnvShake
TriggerAll=Anim = 3310
Trigger1=AnimElemTime(32)>=0 && AnimElemTime(43) < 0
Trigger1=!(Time%4)
Time=4
Freq=110
Ampl=7
IgnoreHitPause=1


;--[Grabbing]---
;--[FX]--
[State 0, Explod]	;Speed Lines
type = Explod
Trigger1=Anim = 3310
Trigger1 = AnimElem=32
anim =2925
ID = 2925
pos = 0,Floor(GameHeight)
postype =Left
bindtime = -1
SprPriority = -2
removetime =52
removeongethit = 0
;--[FX]--
[State 0, Explod]	;Speed Lines
type = Explod
Trigger1=Anim = 3310
Trigger1 = AnimElem=32
anim =2925
ID = 2925
pos = Floor(GameWidth/2),Floor(GameHeight)
postype =Left
bindtime = -1
SprPriority = -4
removetime =52
removeongethit = 0
[State 0]
Type=EnvShake
TriggerAll=Anim = 3310
Trigger1=AnimElemTime(32)>=0 && AnimElemTime(43)<0
TriggerAll=!(Time%4)
Time=4
Freq=110
Ampl=7
IgnoreHitPause=1
[State 0]
Type=SprPriority
Trigger1=Anim = 3310
Trigger1 = AnimElem=36
Value = -1

[State 0]
Type=TargetBind
TriggerAll=Anim = 3310
Trigger1=AnimElemTime(32) >=0 && AnimElemTime(37) < 0
Id=-1
Pos = 68,-128
[State 0]
Type=TargetBind
TriggerAll=Anim = 3310
Trigger1=AnimElem=37
Id=-1
Pos = 72,-120
[State 0]
Type=TargetBind
TriggerAll=Anim = 3310
Trigger1=AnimElem=38
Id=-1
Pos = -35,-113
[State 0]
Type=TargetBind
TriggerAll=Anim = 3310
Trigger1=AnimElem=39
Id=-1
Pos =-41,-119
[State 0]
Type=TargetBind
TriggerAll=Anim = 3310
Trigger1=AnimElem=40
Id=-1
Pos = -42,-119
[State 0]
Type=TargetBind
TriggerAll=Anim = 3310
Trigger1=AnimElem=41
Id=-1
Pos = -45,-119
[State 0]
Type=TargetBind
TriggerAll=Anim = 3310
Trigger1=AnimElem=42
Id=-1
Pos = -45,-119

;--[Ground Slam]--
[State 0]
Type=SprPriority
Trigger1=Anim = 3310
Trigger1 = AnimElem=43
Value = 2
[State 0]
Type=EnvShake
TriggerAll=Anim = 3310
Trigger1=AnimElemTime(43)=0
Time=30
Freq=110
Ampl=7
IgnoreHitPause=1

[State 0, Explod]	;Ground FX
type = Explod
TriggerAll=Anim = 3310
Trigger1=AnimElem = 43
anim =3500
ID = 3500
pos =0,0
postype =P2
bindtime = -1
SprPriority = -3
removetime =-2
OnTop = 0
removeongethit = 0

[State 0, Explod]	;Slam Eruption
type = Explod
TriggerAll=Anim = 3310
Trigger1=AnimElem = 43
anim =3307
ID = 3307
pos = 0,0
postype =P2
bindtime = -1
SprPriority = 5
removetime =-2
removeongethit = 0
[State 0, Explod]	;Floor Spark
type = Explod
TriggerAll=Anim = 3310
Trigger1=AnimElem = 43
anim =8400
ID = 8400
pos = 0,0
postype =P2
bindtime = 1
SprPriority = 3
removetime =-2
removeongethit = 0
[State 0, Explod]	;Floor Spark
type = Explod
TriggerAll=Anim = 3310
Trigger1=AnimElem = 43
anim =8401
ID = 8400
pos = 0,0
postype =P2
bindtime = 1
SprPriority = -3
removetime =-2
removeongethit = 0

;--[KHH]--
[State 0]
Type=EnvShake
TriggerAll=Anim = 3310
Trigger1=AnimElemTime(72)>=0 && AnimElemTime(83) < 0
Trigger1=!(Time%4)
Time=4
Freq=40
Ampl=7
IgnoreHitPause=1
[State 0]
Type=EnvShake
TriggerAll=Anim = 3310
Trigger1=AnimElem = 73
Time=10
Freq=180
Ampl=7
IgnoreHitPause=1

[State 0, Explod]	;Charge Behind Gohan
type = Explod
TriggerAll=Anim = 3310
Trigger1=AnimElemTime(72)=0
anim =3320
ID = 3319
pos = 0,0
postype =P1
bindtime = -1
SprPriority = -3
removetime =-2
removeongethit = 0
[State 0, Explod]	;Charge In Front Gohan
type = Explod
TriggerAll=Anim = 3310
Trigger1=AnimElemTime(72)=0
anim =3321
ID = 3319
pos = 0,0
postype =P1
bindtime = -1
SprPriority = 3
removetime =-2
removeongethit = 0
[State 0]
Type=RemoveExplod
Trigger1=AnimElem =73
Id = 3319
[State 0, Explod]	;Speed Lines
type = Explod
TriggerAll=Anim = 3310
Trigger1=AnimElemTime(73)=0
anim =2924
ID = 2923
pos = Floor(GameWidth/2) - 30,0
postype =Left
bindtime = -1
SprPriority = -5
removetime =72
removeongethit = 0
[State 0]
Type=EnvShake
TriggerAll=Anim = 3310
Trigger1=AnimElemTime(73)>=0 && AnimElemTime(83)<0
TriggerAll=!(Time%4)
Time=4
Freq=110
Ampl=7
IgnoreHitPause=1

[State 0, Explod]	;Beam Fire
type = Explod
TriggerAll=Anim = 3310
Trigger1=AnimElemTime(73)=0
anim =3322
ID = 3320
pos = 0,0
postype =P1
bindtime = -1
SprPriority = 3
removetime =-1
removeongethit = 0
[State 0]
Type=ModifyExplod
TriggerAll=Anim = 3310
Trigger1=AnimElemTime(76)=0
Id=3320
SprPriority=-3
[State 0, Explod]	;Beam Loop
type = null;Explod
TriggerAll=Anim = 3310
Trigger1=AnimElemTime(74)=0
anim =3323
ID = 3320
pos = 0,0
postype =P1
bindtime = -1
SprPriority = -3
removetime =-1
removeongethit = 0
[State 0, Explod]	;Wave Loop
type = Explod
TriggerAll=Anim = 3310
Trigger1=AnimElemTime(76)=0
anim =3324
ID = 3320
pos = 0,0
postype =P1
bindtime = -1
SprPriority = 3
removetime =-1
removeongethit = 0
[State 0]
Type=RemoveExplod
Trigger1=AnimElem = 83
Id = 3320


[State 0, Explod]	;Beam Guarded
type = Explod
TriggerAll=Anim = 3310
Trigger1=AnimElemTime(83)=45
anim =3319
ID = 3319
pos = 0,0
postype =P1
bindtime = -1
SprPriority = 3
removetime =-1
removeongethit = 0

[State 0, Explod]	;Beam Guarded Flash
type = Explod
TriggerAll=Anim = 3310
Trigger1=AnimElemTime(83)=51
anim =3325
ID = 3325
pos = floor(gamewidth/2), floor(gameheight/2)
postype =Left
bindtime = -1
facing = facing
SprPriority = 3
removetime =-2
OnTop = 1
removeongethit = 0

[State 0, Explod]	;Wave End Loop
type = Explod
TriggerAll=Anim = 3310
Trigger1=AnimElemTime(83)=63
anim =3326
ID = 3319
pos = floor(gamewidth/2), floor(gameheight/2)
postype =Left
bindtime = -1
facing = facing
SprPriority = 3
removetime =-1
OnTop = 1
removeongethit = 0
[State 0, Explod]	;Speed Lines
type = Explod
TriggerAll=Anim = 3310
Trigger1=AnimElemTime(83)=63
anim =2924
ID = 2923
pos = Floor(GameWidth/2) + 50 - 30,0
postype =Left
bindtime = -1
facing = -facing
SprPriority = -5
removetime =57
removeongethit = 0
[State 0]
Type=ModifyExplod
TriggerAll=Anim = 3310
Trigger1=AnimElemTime(84)>=0 && AnimElemTime(153)<0 
Id=3319
Scale = 0,0
Anim=15999
[State 0]
Type=ModifyExplod
TriggerAll=Anim = 3310
Trigger1=AnimElemTime(153)>=0 && AnimElemTime(153)<40
Id=3319
Scale = 1,1

[State 0]
Type=RemoveExplod
TriggerAll=Anim = 3310
Trigger1=AnimElemTime(153)=23
Id=3319

[State 0, Explod]	;Guard Spark
type = Explod
TriggerAll=Anim = 3310
TriggerAll = !(Time%4)
Trigger1=AnimElemTime(83)>=54 && AnimElemTime(83) < 110
Trigger2=AnimElemTime(153)>=0 && AnimElemTime(153) < 23
anim =7000
ID = 7020
pos = 0,-80
Random = 10,80
postype =P2
bindtime = 1
SprPriority = 4
removetime =-2
removeongethit = 0
[State 0, Explod]	;Hitspark
type = Explod
TriggerAll=Anim = 3310
TriggerAll = !(Time%4)
Trigger1=AnimElemTime(153)>=23 && AnimElemTime(153) < 120
anim =7030
ID = 7020
pos = -74, -80
Random = 80,40
postype =P2
bindtime = 1
SprPriority = 3
removetime =-2
removeongethit = 0
[State 0]
Type=EnvShake
TriggerAll=Anim = 3310
TriggerAll=!(Time%4)
Trigger1=AnimElemTime(83)>=10 && AnimElemTime(84) < 0
Time=4
Freq=60
Ampl=7
IgnoreHitPause=1

[State 0, Explod]	;BG
type = Explod
TriggerAll=Anim = 3310
Trigger1=AnimElem = 84
anim =3312
ID = 3312
pos = 0,0
postype =P1
bindtime = -1
SprPriority = -5
removetime =-1
removeongethit = 0
[State 0]
Type=RemoveExplod
Trigger1=Anim = 3310
Trigger1 = AnimElem = 121
Id = 3312

[State 0, Explod]	;BG 2
type = Explod
TriggerAll=Anim = 3310
Trigger1=AnimElem = 121
anim =3313
ID = 3313
pos = 0,0
postype =P1
bindtime = -1
SprPriority = -5
removetime =-1
removeongethit = 0

[State 0, Explod]	;Goku
type = Explod
TriggerAll=Anim = 3310
TriggerAll = Enemy,Name != "Goku Z2" && Enemy,Name != "SSJ Goku Z2"
Trigger1=AnimElem = 101
anim =3314
ID = 3314
pos = 0,0
postype =P1
bindtime = -1
SprPriority = -2
removetime =-2
removeongethit = 0
[State 0, Explod]	;piccolo
type = Explod
TriggerAll=Anim = 3310
TriggerAll = Enemy,Name != "Piccolo Z2"
Trigger1=AnimElem = 101
anim =3315
ID = 3314
pos = 0,0
postype =P1
bindtime = -1
SprPriority = -2
removetime =-2
removeongethit = 0
[State 0, Explod]	;flash
type = Explod
TriggerAll=Anim = 3310
Trigger1=AnimElem = 121
anim =3316
ID = 3316
pos = 0,0
postype =P1
bindtime = -1
SprPriority = 5
removetime =-2
removeongethit = 0

[State 0, Explod]	;Beam Flash
type = Explod
TriggerAll=Anim = 3310
Trigger1=AnimElemTime(153)=23
anim =3329
ID = 3329
pos = floor(gamewidth/2), floor(gameheight/2)
postype =Left
bindtime = -1
facing = facing
SprPriority = 2
removetime =-2
OnTop = 1
removeongethit = 0

[State 0, Explod]	;Big Beam Loop
type = Explod
TriggerAll=Anim = 3310
Trigger1=AnimElemTime(153)=43
anim =3327
ID = 3327
pos = floor(gamewidth/2), floor(gameheight/2)
postype =Left
bindtime = -1
facing = facing
SprPriority = 2
removetime =-1
OnTop = 0
removeongethit = 0
[State 0, Explod]	;Rocks
type = Explod
TriggerAll=Anim = 3310
Trigger1=AnimElemTime(153)=43
anim =3328
ID = 3327
pos = floor(gamewidth/2), floor(gameheight/2)
postype =Left
bindtime = -1
facing = facing
SprPriority = 3
removetime =-1
OnTop = 0
removeongethit = 0
[State 0]
Type=RemoveExplod
TriggerAll=Anim = 3310
Trigger1=AnimElemTime(154) = 0
ID = 3327
[State 0, Explod]	;bg during walk
type = Explod
TriggerAll=Anim = 3310
Trigger1=AnimElem = 154
anim =3317
ID = 3317
pos = 0,0
postype =P1
bindtime = -1
SprPriority = -5
removetime =-1
removeongethit = 0
[State 0, Explod]	;hand fx during walk
type = Explod
TriggerAll=Anim = 3310
Trigger1=AnimElem = 154
anim =3318
ID = 3318
pos = 0,0
postype =P1
bindtime = -1
SprPriority = 3
removetime =-1
removeongethit = 0

[State 0]
Type=RemoveExplod
Trigger1=Anim = 3310
Trigger1 = AnimElem = 153
Id = 3313

[State 0]	;Shake for 1st big frame
Type=EnvShake
TriggerAll=Anim = 3310
TriggerAll=!(Time%10)
Trigger1=AnimElemTime(84)>=0 && AnimElemTime(116) < 0
Time=10
Freq=20
Ampl=1
IgnoreHitPause=1

[State 0	];Shake for 2nd big frame
Type=EnvShake
TriggerAll=Anim = 3310
TriggerAll=!(Time%4)
Trigger1=AnimElemTime(121)>=0 && AnimElemTime(153) < 23
Time=4
Freq=120
Ampl=2
IgnoreHitPause=1

[State 0, Explod]	;White BG
type = Explod
TriggerAll=Anim = 3310
Trigger1=AnimElemTime(153)=23
anim =957
ID = 957
pos = 0,0
postype =left
bindtime = -1
SprPriority = -8
removetime =95
removeongethit = 0

[State 0, Explod]	;White FG
type = Explod
;TriggerAll = !MatchOver
TriggerAll=Anim = 3310
Trigger1=AnimElemTime(153)=80
Trigger2 =Time = 1300
anim =3020
ID = 957
pos = Floor(GameWidth/2), Floor(GameHeight/2)
postype =left
scale = 2,2
bindtime = -1
SprPriority = 5
removetime =-2
removeongethit = 0

[State 0, Explod]	;Walking Legs
type = Explod
TriggerAll=Anim = 3310
Trigger1=AnimElemTime(154) >= 0 && NumExplod(3311) = 0
anim =3311
ID = 3311
pos = 0,0
postype =P1
bindtime = -1
SprPriority = -1
removetime =-1
removeongethit = 0


;--[SFX]--
;teleport
[State 0]
type = PlaySnd
trigger1 = anim = 3300 && animelemtime(2)=0
value = 2302, 0
;First Kick
[State 0]
Type=PlaySND
TriggerAll = Anim  = 3300
Trigger1=AnimElem = 6
Value = 0,5
Channel = 1
VolumeScale = 200
;First Kick
[State 0]
Type=PlaySND
TriggerAll = Anim  = 3300
Trigger1=AnimElem = 5
Value = 5,6
Channel = 2
VolumeScale = 200
;Fly Up
[State 0]
Type=PlaySND
TriggerAll = Anim  = 3300
Trigger1=AnimElem = 11
Value = 0,24
Channel = 2
VolumeScale = 200

;First Zoom
[State 0]
Type=PlaySND
TriggerAll = Anim  = 3310
Trigger1=AnimElem = 2
Value = 3310, 8
Channel = 1
VolumeScale = 200
;First Zoom
[State 0]
Type=PlaySND
TriggerAll = Anim  = 3310
Trigger1=AnimElem = 20
Value = 3310, 7
Channel = 1
VolumeScale = 200
;Spinning Kick
[State 0]
Type=PlaySND
TriggerAll = Anim  = 3310
Trigger1=AnimElem = 12
Value = 1200,0
Channel = 1
VolumeScale = 200
;Spinning Kick
[State 0]
Type=PlaySND
TriggerAll = Anim  = 3310
Trigger1=AnimElem = 14
Value = 5,9
Channel = 2
VolumeScale = 200
;Punch
[State 0]
Type=PlaySND
TriggerAll = Anim  = 3310
Trigger1=AnimElem = 28
Value = 0,2
Channel = 1
VolumeScale = 100
;Punch
[State 0]
Type=PlaySND
TriggerAll = Anim  = 3310
Trigger1=AnimElem = 29
Value = 5,2
Channel = 2
VolumeScale = 200
;Grab
[State 0]
Type=PlaySND
TriggerAll = Anim  = 3310
Trigger1=AnimElem = 32
Value = 800,1
Channel = 2
VolumeScale = 200
;Slam
[State 0]
Type=PlaySND
TriggerAll = Anim  = 3310
Trigger1=AnimElem = 43
Value = 15000,2
Channel = -1
VolumeScale = 50
;Slam
[State 0]
Type=PlaySND
TriggerAll = Anim  = 3310
Trigger1=AnimElem = 43
Value =3310,9
Channel = -1
VolumeScale = 200
;Backflips
[State 0]
Type=PlaySND
TriggerAll = Anim  = 3310
Trigger1=AnimElem = 45
Trigger2 = AnimElem = 50
Trigger3=AnimElem = 54
Trigger4 = AnimElem = 59
Value = 1200,0
Channel = -1
VolumeScale = 100
;Back Tuck
[State 0]
Type=PlaySND
TriggerAll=Anim = 3310
Trigger1 = AnimElem = 59
Value = 1202,1
Channel = 1
VolumeScale =200
;Back Tuck Land
[State 0]
Type=PlaySND
TriggerAll=Anim = 3310
Trigger1 = AnimElem = 69
Value = 40,0
Channel = 4
VolumeScale = 200

;Beam Charge
[State 0]
Type=PlaySND
TriggerAll=Anim = 3310
Trigger1 = AnimElem = 71
Value = 3310,0
VolumeScale = 200
;Beam Fire
[State 0]
Type=PlaySND
TriggerAll=Anim = 3310
Trigger1 = AnimElem = 73
Value = 3310,1
VolumeScale = 200
;Beam Buildup
[State 0]
Type=PlaySND
TriggerAll=Anim = 3310
Trigger1 = AnimElem = 83
Value = 3310,2
VolumeScale = 200
;Beam Fire x2 build
[State 0]
Type=PlaySND
TriggerAll=Anim = 3310
Trigger1 = AnimElemTime(83) = 60
Value = 3310,3
VolumeScale = 200
;Beam Fire x2 woosh
[State 0]
Type=PlaySND
TriggerAll=Anim = 3310
Trigger1 = AnimElem = 116
Value = 3310,4
VolumeScale = 200
;Beam Fire x2 
[State 0]
Type=PlaySND
TriggerAll=Anim = 3310
Trigger1 = AnimElem = 121
Value = 3310,5
VolumeScale = 200
;Beam Fire x2  end
[State 0]
Type=PlaySND
TriggerAll=Anim = 3310
Trigger1 = AnimElem = 150
Value = 3310,6
VolumeScale = 200
;Voice
[State 0]
Type=PlaySND
TriggerAll=Anim = 3310
Trigger1=AnimElemTime(121) = 0
Value = 3310,10
Channel = 0
VolumeScale = 200

;Block
[State 0]
Type=PlaySND
TriggerAll=Anim = 3310
TriggerAll = !(Time%4)
Trigger1=AnimElemTime(83)>=40 && AnimElemTime(83) < 110
Trigger2=AnimElemTime(153)>=0 && AnimElemTime(153) < 23
Value = 6,0
Channel = -1
VolumeScale =100

;KHH Hit
[State 0]
Type=PlaySND
TriggerAll=Anim = 3310
TriggerAll = !(Time%4)
Trigger1=AnimElemTime(153)>=23 && AnimElemTime(153) < 120
Value = 1000,0
Channel = -1
VolumeScale = 100

;Spirit V Spirit
[State 0]
Type=PlaySND
Trigger1 = !Time
Value = 3300,0
Channel = 24
VolumeScale = 200
[State 0, DAMAGE]
Type=TargetLifeAdd
trigger1 = !numexplod(9992900)
Trigger1 = Anim = 3310
Trigger1=AnimElemTime(153) = 60
Value=-ceil(ifElse(fvar(11) * 750 < 376, 376, fvar(11) * 750))
;-ceil(ifElse(fvar(11) * 595 < 300, 300, fvar(11) * 595))
Kill=1
persistent = 0
[State 0, COMBO DAMAGE]
Type=TargetLifeAdd
trigger1 = numexplod(9992900)
Trigger1 = Anim = 3310
Trigger1=AnimElemTime(153) = 60
value = -ceil(ifElse(fvar(11) * 600 < 308, 308, fvar(11) * 600))
Kill=1
persistent = 0

[State 0]
Type=ChangeState
TriggerAll = !MatchOver
TriggerAll=Anim = 3310
Trigger1=Time = 1375
Value = 3310

[State 0, On Kill]
Type=ChangeState
TriggerAll = MatchOver
TriggerAll=Anim = 3310
Trigger1=Time = 1200
Value = 0

;FSKHH P2
[Statedef 3305]
Type=S
MoveType=H
Physics=N
Ctrl=0
VelSet=0,0


[State 0]
Type=AssertSpecial
Trigger1=1
Flag=NoShadow

[State 0]
Type=ScreenBound
Trigger1=1
Value=0
MoveCamera=0,0

;--[Animation Change]--
[State 0]	;On Ground
Type=ChangeAnim
Trigger1=!Time && Pos Y = 0
Value = 5012
[State 0]
Type=ChangeAnim
Trigger1=Anim=5012 && AnimTime = -1
Value = 5012
Elem = AnimElemNo(0)

[State 0]	;In Air
Type=ChangeAnim
Trigger1=!Time && Pos Y != 0
Value = 5030


[State 0]
Type=ChangeAnim
Trigger1=Anim = 5012 && Enemy,Anim = 3300
Trigger1=Enemy,AnimElem = 6
Value = 5002
[State 0]
Type=ChangeAnim
Trigger1=Anim=5002 && AnimTime = -1
Value = 5002
Elem = AnimElemNo(0)

;--[Fly Back]--
[State 0]
Type=ChangeAnim
Trigger1=Enemy,Anim = 3300
Trigger1=Enemy,AnimElem = 8
Trigger1 = Anim != 5035
Value = 5035
[State 0]
Type=VelSet
Trigger1=Anim = 5035 && Vel X = 0
X = -30
Y=-20
[State 0]
Type=VelSet
Trigger1=Anim=5035
Trigger1=Pos X != [-380,380]
X=0
Y=0

;--[Scene Change Fly Back]--
[State 0]
Type=ChangeAnim2
Trigger1 = Anim = 5035 && Enemy,Anim = 3310
Value = 3305

[State 0]
Type=PosSet
Trigger1=Anim = 3305 && AnimElemTime(1)=0
X = 0
Y = -100

[State 0]
Type=PosSet
Trigger1=Anim = 3305 &&Enemy,Anim = 3310
Trigger1 = Enemy,AnimElem = 6
X = 360 * Facing
Y = -100

[State 0]
Type=PosAdd
Trigger1=Anim = 3305 &&Enemy,Anim = 3310
Trigger1 = Enemy,AnimElemTime(12) >= 0 && Enemy,AnimElemTime(14) < 0
X = (Enemy,Pos X - Pos X - (-50 * Facing))  * (.6 * Facing)
[State 0]
Type=PosFreeze
Trigger1=Anim = 3305 &&Enemy,Anim = 3310
Trigger1 = Enemy,AnimElem = 14
[State 0]
Type=Turn
Trigger1=Anim = 3305 &&Enemy,Anim = 3310
Trigger1 = Enemy,AnimElem = 14
[State 0]
Type=VelSet
Trigger1=Anim = 3305 && Enemy,Anim = 3310
Trigger1 = Enemy,AnimElem = 15
X = -50
Y=0
[State 0]
Type=VelSet
Trigger1=Anim = 3305 && Enemy,Anim = 3310
Trigger1 = Enemy,AnimElem = 20
X=0
Y=0

[State 0]
Type=PosSet
Trigger1=Anim = 3305 &&Enemy,Anim = 3310
Trigger1 = Enemy,AnimElem = 22
X = 360 * Facing
Y = -100
[State 0]
Type=PosAdd
Trigger1=Anim = 3305 &&Enemy,Anim = 3310
Trigger1 = Enemy,AnimElemTime(27) >= 0 && Enemy,AnimElemTime(29) < 0
X = (Enemy,Pos X - Pos X - (-50 * Facing))  * (.6 * Facing)


[State 0]
Type=Turn
Trigger1=Anim = 3305 &&Enemy,Anim = 3310
Trigger1 = Enemy,AnimElem = 43
[State 0]
Type=PosAdd
Trigger1=Anim = 3305 &&Enemy,Anim = 3310
Trigger1 = Enemy,AnimElem = 43
X = -50
[State 0]
Type=PosSet
Trigger1=Anim = 3305 &&Enemy,Anim = 3310
Trigger1 = Enemy,AnimElem = 43
Y = 0


[State 0, PalFXWiz]
type = PalFX
Trigger1=Anim = 3305 &&Enemy,Anim = 3310
Trigger1 = Enemy,AnimElemTime(153) >= 23 && Enemy,AnimElemTime(154) < 0
time = 1
add = 0,0,0
mul = 0,0,0
sinadd = 0,0,0,1
invertall = 0
color = 256

[State 0]
Type=SprPriority
Trigger1=Anim = 3305 &&Enemy,Anim = 3310
Trigger1 = Enemy,AnimElemTime(153) = 23
Value=-2

[State 0]
Type=ChangeState
Trigger1 = !MatchOver
Trigger1=Enemy,StateNo = 3310 && StateNo != 3306
Value = 3306
Ctrl=0

[State 0]
Type=ChangeState
Trigger1 = MatchOver
Trigger1=Enemy,StateNo = 3390 && StateNo != 3306
Value = 3306
Ctrl=0

;FSKHH P2
[Statedef 3306]
Type=S
MoveType=I
Physics=S
Ctrl=0
VelSet=0,0

[State 0, AssertSpecial]
type = AssertSpecial
trigger1 = matchover = 1
flag = invisible

[State 0]
Type=ScreenBound
Trigger1=1
Value=0
MoveCamera=0,0

[State 0]
Type=PosSet
Trigger1=matchover = 1
Y=800
X = -100 * facing
[State 0]
Type=PosSet
Trigger1=matchover = 0
Y=0
X = -100 * facing
;--[Animation Change]--
[State 0]
Type=ChangeAnim2
Trigger1=!Time
Value = 3306

[State 0]
Type=SelfState
triggerall = matchover = 0
Trigger1 = Alive = 0
Trigger1=Time = 80
Value = 5150

[State 0]
Type=SelfState
triggerall = matchover = 0
Trigger1 = Alive = 1
Trigger1=Time = 80
Value = 5120

[State 0]
Type=ChangeState
triggerall = matchover = 1
Trigger1 = Time = 80
Value = 3391

;FSKHH P2
[Statedef 3391]
Type=S
MoveType=I
Physics=N
Ctrl=0
VelSet=0,0

[State 0]
Type=ScreenBound
Trigger1=1
Value=0
MoveCamera=0,0

[State 0]
Type=PosSet
Trigger1=1
Y=800
X = -100 * facing
;--[Animation Change]--
[State 0]
Type=ChangeAnim2
Trigger1=!Time
Value = 3306

[State 0, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = invisible

[State 0]
Type=SelfState
Trigger1=Time >= 20
Value = 5150

;Gohan back on screen
[StateDef 3310]
Type=A
MoveType=I
Physics=N
Anim = 0
Ctrl=0

[State 0]
Type=RemoveExplod
Trigger1=!Time
Id=-1

[State 0, Stop BGM]
Type=StopSND
Trigger1=!Time
Channel=24

[State 0]
Type=ScreenBound
Trigger1=1
Value = 0
MoveCamera = 0,0

[State 0]
Type=PosSet
Trigger1=!Time
X = -520 * Facing
Y=-20

[state 0, reset emo gauge]
type = varset
trigger1 = time = 40
fvar(28) = 0

[State 0]
Type=ChangeState
Trigger1=Time = 40
Value = 110

;EE Kick Start
;------------------------------------
[Statedef 3400]
Type=S
MoveType=A
Physics=S
VelSet=0,0
sprpriority = 3
Ctrl=0

[State 0, AssertSpecial]
type = AssertSpecial
trigger1 = (anim = 2400) && time <= (ifelse(fvar(28)<100,40,ifelse(fvar(28)>=300,155,55)))
trigger2 = (anim = 3201) && time <= 180
flag = noFG
[State 0, Cant be Hit]
Type=NotHitBy
Trigger1=1
Value=SCA

[State 0, Reset Emo]
Type=VarSet
Trigger1 = !Time
FV = 27
Value = 0

[State 0, KHH Start]
Type=ChangeAnim
TriggerAll=Anim != 2400
Trigger1=!Time && P2Dist X > 100
Trigger2 = !Time && EnemyNear,StateType = A
Value = 2400

[State 0, Kick Start]
Type=ChangeAnim
TriggerAll = EnemyNear,Pos Y >= -60
Trigger1=!Time && P2Dist X <= 100
Trigger1=Anim != 3201
Trigger2 = !Time && EnemyNear,MoveType = H && P2Dist X <= 100
Value = 3201

[State 2500, Black BG]
type = bgpalfx
trigger1 = (anim = 2400) && !time
time = ifelse(fvar(28)<100,40,ifelse(fvar(28)>=300,155,55))
color = 0
mul = 0,0,0
[State 2500, Black BG]
type = bgpalfx
trigger1 = (anim = 3201) && !time
time = 90
color = 0
mul = 0,0,0

[State 0, Super Pause]
Type = SuperPause
Trigger1=!Time&&Anim=3201
Time=40
MoveTime=8
PauseBG=1
Darken = 0;1
Unhittable=1
Anim = s2442
Pos = 0,-60
Sound = s2350,0
Unhittable=1

[State 0, Super Pause]
Type = SuperPause
Trigger1=!Time&&Anim=2400
Time=ifelse(fvar(28)<100,40,ifelse(fvar(28)>=300,155,55))		;KHH should have 5f startup after freeze
MoveTime=ifelse(fvar(28)<100,40,ifelse(fvar(28)>=300,155,55))
PauseBG=1
Darken = 0;1
Unhittable=1
Anim = s2442
Pos = -20,-60
Sound = s2350,0
Unhittable=1

[State 0, Kick Dust]
Type=Explod
Trigger1=Anim = 3201 && AnimElem = 9
Anim=1207
Id=1207
Facing = -1
Pos=10,0
PosType=P1
BindTime=1
RemoveTime=-2
SprPriority=4

[State 250, wheel kick SFX]
type = PlaySnd
trigger1 = Anim = 3201 && AnimElem = 2
value = 270,0

[State 0, Kick HitDef]
type = HitDef
trigger1 = Anim = 3201 && !MoveContact && !MoveReversed
attr = S,HA  
hitflag = MAF   
guardflag = MA  
animtype = Hard
air.animtype = Hard
damage = ceil(ifelse(fvar(11)*50<20,20,fvar(11)*50)),10 ;0,10
pausetime = 6,10
guard.pausetime = 12,10
sparkno = S7030
guard.sparkno = S7000
sparkxy = 0,-80
hitsound   = S2604,0
guardsound = S6,1
ground.type = High      ;Low, Trip, None
ground.slidetime = 16
guard.slidetime = 16
ground.hittime = 18
guard.hittime = 15
p1sprpriority = 1
p2sprpriority = 0
p2facing=1
fall.recover = 0
id = 3400
chainID = -1
nochainID = -1
hitonce = 1
kill = 0
guard.kill = 0
numhits = 1
getpower = 0,0
givepower = 0,0
ground.cornerpush.veloff = -30

[State 0, Shake Screen]
Type=EnvShake
Trigger1=MoveHit=1
time = 10
freq = 200
ampl = 4
IgnoreHitPause=1

[State 0, Send Target Flying]
Type=TargetState
TriggerAll=MoveHit=1 && NumTarget(3400)
Trigger1 = Fvar(28) < 200
Trigger2 = Fvar(28) >= 300
Value = 3405

[State 0, Send Target Flying]
Type=TargetState
Trigger1 = Fvar(28) = [200,299]
Trigger1=MoveHit=1 && NumTarget(3400)
Value = 3407

[State 0, Change to KHH on hit]
Type=ChangeAnim
Trigger1= Anim=3201 && !AnimTime
Trigger1 = NumTarget(3400)
Value = 2400

[State 0, Khh Start SND]
Type=PlaySND
Trigger1=Anim=2400&&AnimElem=1
Value=2400,1

[State 0, Change To Idle On Whiff]
Type=ChangeState
Trigger1=Anim=3201&&!AnimTime
Trigger1=!NumTarget(3400)
Value=0
Ctrl=1

[State 0, Change To Charge State]
Type=ChangeState
Trigger1=Anim=2400&&AnimElemTime(1)=0
Trigger1=StateNo != 3401
Value=3401
Ctrl=0

;EE Charge and Launch
;--------------------------------
[Statedef 3401]
Type=S
MoveType=A
Physics=S
VelSet=0,0
Ctrl=0

[State 0, Clear Screen]
Type=null;AssertSpecial
Trigger1=1
Flag=NoBarDisplay
[State 0, noFG]
type = AssertSpecial
trigger1 = 1
flag = noFG

[State 0, Cant be Hit]
Type=NotHitBy
Trigger1 = anim = 2400
Value=SCA

[State 2500, Black BG]
type = bgpalfx
trigger1 = (anim = 2400) && !time
time = ifelse(fvar(28)<100,40,ifelse(fvar(28)>=300,155,65))
color = 0
mul = 0,0,0

[State 0, Launch Blast and Charge Times]
Type=ChangeAnim
TriggerAll=Anim=2400
Trigger1=Time = 45 && Fvar(28) < 100
Trigger2 = Time = 60 && Fvar(28) = [100,299]
Trigger3 = Time = 160 && Fvar(28) >= 300
Value = 2401

[State 200, 1];voice (Haaa)
type = PlaySnd
trigger1 = Anim = 2401 && AnimElem = 1
value = 2401,6+random%2
channel = 0

[State 200, 1];Launching SFX
type = PlaySnd
trigger1 = Anim = 2401 && AnimElem = 3
value = 2401,1

;BALL FX
[State 0, Gohan Ball]
type = Explod
trigger1 = (anim = 2400) && (time = 5)
anim = 12420
id = 993420
pos = -25,-60
postype = p1
supermovetime = 9999
pausemovetime = 9999
removetime = -1
sprpriority = 4
ownpal = 1
bindtime = -1
persistent = 0
[State 0, Gohan Charge Lightning]
type = Explod
trigger1 = (anim = 2400) && (time = 5)
anim = 2430
id = 993420
pos = -25,-57
postype = p1
supermovetime = 9999
pausemovetime = 9999
removetime = -1
sprpriority = 4
ownpal = 1
bindtime = -1
persistent = 0
[State 0, Goten Ball]
type = Explod
triggerall = fvar(28) = [200,300]
triggerall = numexplod(9993210)
trigger1 = (anim = 2400) && (time = 9)
anim = 12420
id = 993420
pos = 20,-35
postype = p1
supermovetime = 9999
pausemovetime = 9999
removetime = -1
sprpriority = 5
ownpal = 1
bindtime = -1
persistent = 0
[State 0, Goten Charge Lightning]
type = Explod
triggerall = fvar(28) = [200,300]
triggerall = numexplod(9993210)
trigger1 = (anim = 2400) && (time = 9)
anim = 2431
id = 993420
pos = 20,-35
postype = p1
supermovetime = 9999
pausemovetime = 9999
removetime = -1
sprpriority = 5
ownpal = 1
bindtime = -1
persistent = 0
[State 0, Goku Ball]
type = Explod
triggerall = fvar(28) = 300
trigger1 = (anim = 2400) && (time = 5)
anim = 12420
id = 993420
pos = -53,-93
postype = p1
supermovetime = 9999
pausemovetime = 9999
removetime = -1
sprpriority = 3
ownpal = 1
bindtime = -1
persistent = 0
[State 0, Goku Charge Lightning]
type = Explod
triggerall = fvar(28) = 300
trigger1 = (anim = 2400) && (time = 5)
anim = 2430
id = 993420
pos = -53,-93
postype = p1
supermovetime = 9999
pausemovetime = 9999
removetime = -1
sprpriority = 3
ownpal = 1
bindtime = -1
persistent = 0
[state 0, remove charge FX]
type = removeexplod
trigger1 = time = 45 && fvar(28) < 100
trigger2 = time = 60 && fvar(28) = [100,299]
trigger3 = time = 160 && fvar(28) >= 300
ID = 993420


[state 1215, Smoke FX]
type = explod
trigger1 = anim=2401 && animelem=3
anim = 1206
id = 1206
pos = -25,3
postype = P1
sprpriority = 6
ownpal = 1
removetime = -2
persistent = 0
ignorehitpause = 1

[State 0, Lvl0 KHH]
Type=Helper
TriggerAll = Fvar(28) < 100
Trigger1=Anim=2401 && AnimElem = 3
StateNo = 1317
Id = StateNo
Name = "LVL 0 Blast"
PosType=P1
Pos = 80,-60
OwnPal = 1
[State 0, KHH for Goten]
Type=Helper
TriggerAll = Fvar(28) = [200,299] 
TriggerAll = EnemyNear,StateNo != 3407
Trigger1=Anim=2401 && AnimElem = 3
StateNo = 92600
Id = StateNo
Name = "LVL 1 Blast for Goten"
PosType=P1
Pos = 77,-36;70,-42
OwnPal = 1
[State 0, Lvl1 KHH]
Type=Helper
TriggerAll = Fvar(28) = [100,299] 
TriggerAll = EnemyNear,StateNo != 3407
Trigger1=Anim=2401 && AnimElem = 3
StateNo = 92600
Id = StateNo
Name = "LVL 1 Blast"
PosType=P1
Pos = 54,-58;50,-62
OwnPal = 1

[State 200, 1];Family Launching SFX
type = PlaySnd
Trigger1=Anim=2400
trigger1 = !Time && Fvar(28) >= 300
value = 3404,0
Channel=0
[State 0, Goten Appears]
Type=Explod
Trigger1=!Time && Fvar(28) >= 200
Trigger1=!NumExplod(9993210)
Anim=3210
Id=9993210
Pos=40,0
PosType=P1
BindTime=-1
RemoveTime=-1
RemoveOnGetHit=1
SuperMoveTime=999
SprPriority=4
Shadow = 30,30,30
[State 250, teleport sound]
type = PlaySnd
Trigger1 = NumExplod(9993210)
Trigger1=!Time && Fvar(28) >= 200
Trigger2 = NumExplod(9993214)
Trigger2=Anim=3216&&!AnimTime
value = 2302, 0
[State 0, Remove Goten Appears]
Type=RemoveExplod
Trigger1=Anim=2401&&NumExplod(9993210)
Trigger2 = Fvar(28)>=300
Trigger2 = Time = 30
Id=9993210

[State 0, Goten SSJ Flash]
Type=Explod
Trigger1=Fvar(28) >=300
Trigger1=Anim=2400
Trigger1=Time = 30
Anim=4004
Id=9994004
Pos=40,0
RemoveOnGetHit=1
PosType=P1
BindTime=-1
RemoveTime=-2
SuperMoveTime=999
SprPriority=3

[State 0, Goten Charge SSJ]
Type=Explod
Trigger1=Fvar(28) >=300
Trigger1=Anim=2400
Trigger1=Time = 30 && !NumExplod(9994007)
Anim=4007
Id=9994007
RemoveOnGetHit=1
Pos=40,0
PosType=P1
BindTime=-1
RemoveTime=-1
SuperMoveTime=999
SprPriority=4
Shadow = 30,30,30
[State 0, Goten Charge SSJ Hair]
Type=Explod
Trigger1=Fvar(28) >=300
Trigger1=NumExplod(9994007) && !NumExplod(9994009)
Anim=4009
Id=9994009
Pos=40,0
RemoveOnGetHit=1
PosType=P1
BindTime=-1
RemoveTime=-1
SuperMoveTime=999
SprPriority=4
Shadow = 30,30,30
[State 0, Remove Goten Charge]
Type=RemoveExplod
Trigger1=Anim=2401 && NumExplod(9994007)
Id=9994007
[State 0, Remove Goten Charge Hair]
Type=RemoveExplod
Trigger1=Anim=2401 && NumExplod(9994009)
Id=9994009

[State 0, Goten Launch]
Type=Explod
Trigger1=Fvar(28) = [200,299]
Trigger1=Anim=2401
Trigger1=!NumExplod(9993213)
Anim=3213
Id=9993213
RemoveOnGetHit=1
Pos=40,0
PosType=P1
BindTime=-1
RemoveTime=-1
SuperMoveTime=999
SprPriority=4
Shadow = 30,30,30
[State 0, Remove Goten Launch]
Type=RemoveExplod
triggerall = NumExplod(9993213)
;Trigger1=Anim=3216 && NumExplod(9993213)
trigger1 = numhelper(stateno)
trigger1 = helper(stateno),anim=92401 && !helper(stateno),animtime
trigger2 = stateno != 3401
Id=9993213

[State 0, Goten Leave]
Type=Explod
Triggerall=Fvar(28) = [200,299]
;Trigger1=Anim=3216
Trigger1 = !NumExplod(9993214)
trigger1 = numhelper(stateno)
trigger1 = helper(stateno),anim=92401 && !helper(stateno),animtime
trigger2 = stateno != 3401
Anim=3214
Id=9993214
Pos=40,0
PosType=P1
BindTime=1
RemoveTime=-2
SuperMoveTime=999
SprPriority=4
Shadow = 30,30,30

[State 0, Goku Appears]
Type=Explod
Trigger1=!Time && Fvar(28) >= 300
Trigger1=!NumExplod(9994000)
Anim=4000
Id=9994000
Pos=-40,0
RemoveOnGetHit=1
PosType=P1
BindTime=-1
RemoveTime=-1
SuperMoveTime=999
SprPriority=-2
Shadow = 30,30,30
[State 0, Remove Goku Appears]
Type=RemoveExplod
Trigger1=Anim=2401&&NumExplod(9994000)
;Trigger1=AnimElem=3
Id=9994000
[State 0, Goku Appears Hair]
Type=Explod
Trigger1=!Time && Fvar(28) >= 300
Trigger1=!NumExplod(9994001)
Anim=4001
Id=9994001
Pos=-40,0
RemoveOnGetHit=1
PosType=P1
BindTime=-1
RemoveTime=-1
SuperMoveTime=999
SprPriority=-2
Shadow = 30,30,30
[State 0, Remove Goku Appears Hair]
Type=RemoveExplod
Trigger1=Anim=2401&&NumExplod(9994001)
;Trigger1=AnimElem=3
Id=9994001

[State 0, Change To Bros Cinematic]
Type=ChangeState
TriggerAll = Fvar(28) = [200,299] 
TriggerAll = EnemyNear,StateNo = 3407
Trigger1=Anim=2401 && AnimElem = 3
Value=3402
Ctrl=0

[State 0, Change To Family Cinematic]
Type=ChangeState
TriggerAll = Fvar(28) >= 300 
Trigger1=Anim=2401; && AnimElem = 3
Value=3404
Ctrl=0

[State 0, Return To Idle Animation]
Type=ChangeAnim
TriggerAll = Anim = 2401
Trigger1=Fvar(28) < 100 && Time = 80
Trigger2=Fvar(28) = [100,299]
Trigger2 = Time >= 150
Trigger3 = Fvar(28) >= 300
Trigger3 = Time >= 230
Value=3216
Elem=1

[state 0, reset emo gauge]
type = varset
Trigger1=Anim=3216&&!AnimTime
fvar(28) = 0
ignorehitpause = 1

[State 0, Return To Idle State]
Type=ChangeState
Trigger1=Anim=3216&&!AnimTime
Value=0
Ctrl=1


;EE Bros Cinematic
;-------------------------------------
[Statedef 3402]
Type=S
MoveType=A
Physics=N
VelSet=0,0
Ctrl=0

[State 0, Clear Screen]
Type=AssertSpecial
Trigger1=1
Flag=NoBarDisplay
Flag2=NoFG
Flag3=NoBG

[State 0, Cant be Hit]
Type=NotHitBy
Trigger1=1
Value=SCA

[State 200, 1];Launching SFX
type = PlaySnd
trigger1 = !Time
value = 2401,1

[State 0, Bros Beam]
type = PlaySnd
trigger1 = !Time
value = 3402,0

[State 0, Start Moving Back]
Type=VelSet
Trigger1=Time>20
X=-10
[State 0, Stop Moving]
Type=VelSet
Trigger1=Pos X != [-540,540]
X=0


[State 0, Start Moving Up]
Type=VelSet
Trigger1=Time > 80 && Pos X != [-300,300]
Y=-1
[State 0, Stop Moving]
Type=VelSet
Trigger1=Pos Y <= -70
Y=0

[State 0, BG Speed Lines Left]
Type=Explod
Trigger1=!Time && !NumExplod(2923)
Anim=2923
Id=2923
Pos=90,10
Facing = FAcing
PosType=Left
BindTime=-1
RemoveTime=-1
SprPriority=-4

[State 0]
Type=ScreenBound
Trigger1=1
Value=0
MoveCamera=0,0

[State 0, Small Screen Shake]
Type=EnvShake
Trigger1=Time<130 && !(Time%4=0)
Time=4
Freq = 80
Ampl=2

[State 0, White Flash]
Type=AllPalFX
Trigger1=Time=130
Time=5
Add=255,255,255

[State 0, Medium Screen Shake]
Type=EnvShake
Trigger1=Time>=130 && !(Time%4=0)
Time=4
Freq = 110
Ampl=4

[State 0, Bros Beam]
Type=Explod
Trigger1=!Time && !NumExplod(9993402)
Anim=3402
Id=9993402
Pos = 50,-62
PosType=P1
BindTime=-1
RemoveTime=-1
SuperMoveTime=999
SprPriority=4

[State 0, Hit Sparks]
Type=Explod
Trigger1=EnemyNear, Pos X = [-150,150]
Trigger1 = Time > 130 && Time%4=0
Anim=7030
Id=7030
Pos=0,-60
Random = 100,50
PosType=P2
BindTime=1
RemoveTime=-2
SuperMoveTime=999
OnTop=1

[State 0, Hit Count]
Type=HitAdd
Trigger1=EnemyNear, Pos X = [-150,150]
Trigger1 = Time > 130 && Time%4=0
Value=3

[State 0, Hit SFX]
type = PlaySnd
Trigger1=EnemyNear, Pos X = [-150,150]
Trigger1 = Time > 130 && Time%4=0
value = s1000,0

[State 0, Life Drain]
Type=TargetLifeAdd
Trigger1 = Time = 200;100
Id=3400
Value = -floor(IfElse(fvar(11) * 340 < 290, 290, fvar(11) * 340))
Kill=1

[State 0, White Fade]
Type=Explod
Trigger1=Time = 260 && !NumExplod(18230)
Anim=18230
Id=18230
Pos = Floor(GameWidth/2), Floor(GameHeight/2)
PosType=Left
BindTime=1
RemoveTime=-2
OnTop=1
Scale=3.0,3.0

[State 0, Idle]
Type=ChangeState
Trigger1=Time=290
Value = 3403
Ctrl=0

;EE Bros Ending
[Statedef 3403]
Type=S
MoveType=A
Physics=N
VelSet=0,0
Ctrl=0
Anim=732

[State 0, Cant be Hit]
Type=NotHitBy
Trigger1=1
Value=SCA

[State 0]
Type=ScreenBound
Trigger1=1
Value=0
MoveCamera=0,0

[State 0, Remove Goten]
Type=RemoveExplod
Trigger1=!Time
Id=9993213
[State 0, Remove Beam]
Type=RemoveExplod
Trigger1=!Time
Id=9993402
[State 0, Remove BG Lines]
Type=RemoveExplod
Trigger1=!Time
Id=2923

[State 0]
Type=PosSet
Trigger1=!Time
X = -70 * Facing
Y=0

[state 0, reset emo gauge]
type = varset
trigger1 = !animtime
fvar(28) = 0
ignorehitpause = 1

[State 0, Return To IDle]
Type = ChangeState
Trigger1=!AnimTime
Value=0
Ctrl=1

;EE Family Launch
[Statedef 3404]
Type=S
MoveType=A
Physics=N
VelSet=0,0
Ctrl=0
SprPriority = 4

[State 0, Cant be Hit]
Type=NotHitBy
Trigger1 = EnemyNear,StateNo = [3405,3406]
Value=SCA

[State 0]
Type=ScreenBound
Trigger1=EnemyNear,StateNo = 3408
Value=0
MoveCamera=0,0

[State 0, Clear Screen]
Type=AssertSpecial
Trigger1=numexplod(9993407)!=0
Flag=NoBarDisplay
[State 0, Clear Screen]
Type=AssertSpecial
Trigger1=EnemyNear,StateNo = 3408
Flag=NoFG
Flag2=NoBG

[State 0, Small Screen Shake]
Type=EnvShake
Trigger1=(Time%4=0)
Time=4
Freq = 80
Ampl=2

;CINEMATIC BEAHVIOR BELOW--------------------------------------------
[State 0, Family Beam Flash]
Type=null;Explod
TriggerAll = EnemyNear,StateNo = [3405,3406]
Trigger1=!Time
Trigger1=!NumExplod(9994011)
Anim=4011
Id=9994011
Pos=0,0
SprPriority=10
OnTop=1
PosType=Left
Facing=Facing
BindTime=-1
RemoveTime=-2


[State 0, Family Beam]
Type=Explod
TriggerAll = EnemyNear,StateNo = [3405,3406]
Trigger1=!Time
Trigger1=!NumExplod(9994015)
Anim=4015
Id=9994015
Pos=40,-60
PosType=P1
BindTime=-1
RemoveTime=-1
SprPriority=-5
[State 0, Family Beam Dust]
Type=Explod
TriggerAll = EnemyNear,StateNo = [3405,3406]
Trigger1=!Time
Anim=4016
Id=9994015
Pos=0,-30
PosType=P1
BindTime=-1
RemoveTime=-1
OnTop=0
SprPriority=7

[State 0, Family Beam Wave Loop]
Type=Explod
TriggerAll = EnemyNear,StateNo = [3405,3406]
Trigger1=!Time
Anim=3324
Id=9994015
Pos=30,0
PosType=P1
BindTime=-1
RemoveTime=-1
SprPriority=5

[State 0, Move Back]
Type=VelSet
TriggerAll = EnemyNear,StateNo = [3405,3406]
Trigger1 = !Time
X = -12

[State 0, Stop Moving Back]
Type=VelSet
Trigger1=EnemyNear,StateNo = 3408
Trigger1 = BackEdgeDist < 10
X = 0

[State 0, Invisible During Big Sprites]
Type=AssertSpecial
Trigger1=NumExplod(9993407)
Flag=Invisible

[State 0, Big Family Sprites]
Type=Explod
Trigger1=Time = 100 && EnemyNear,StateNo = 3408
Anim=3407
Id=9993407
Facing=Facing
Pos = Floor(GameWidth/2), Floor(GameHeight/2)
PosType=Left
BindTime=-1
RemoveTime=-1
SprPriority=2
[State 0, Big Family Hair Sprites]
Type=Explod
Trigger1=Time = 100 && EnemyNear,StateNo = 3408
Anim=3406
Id=9993407
Facing=Facing
Pos = Floor(GameWidth/2), Floor(GameHeight/2)
PosType=Left
BindTime=-1
RemoveTime=-1
SprPriority=2


[State 0, Remove Family Beam]
Type=RemoveExplod
Trigger1=NumExplod(9993407)
Id=9994015

[State 0, Big Family Beam Back]
Type=Explod
Trigger1=Time = 100 && EnemyNear,StateNo = 3408
Anim=3409
Id=9993407
Facing=Facing
Pos = Floor(GameWidth/2), Floor(GameHeight/2)
PosType=Left
BindTime=-1
RemoveTime=-1
SprPriority=-3

[State 0, Big Family Beam FX 2 1-3]
Type=Explod
Trigger1=Time = 100 && EnemyNear,StateNo = 3408
Anim=3410
Id=9993407
Facing=Facing
Pos = Floor(GameWidth/2), Floor(GameHeight/2)
PosType=Left
BindTime=-1
RemoveTime=-1
SprPriority=3
[State 0, Big Family Beam FX 3 4-5]
Type=Explod
Trigger1=Time = 100 && EnemyNear,StateNo = 3408
Anim=3411
Id=9993407
Facing=Facing
Pos = Floor(GameWidth/2), Floor(GameHeight/2)
PosType=Left
BindTime=-1
RemoveTime=-1
SprPriority=1
[State 0, Big Family Beam FX 3 6]
Type=Explod
Trigger1=Time = 100 && EnemyNear,StateNo = 3408
Anim=3412
Id=9993407
Facing=Facing
Pos = Floor(GameWidth/2), Floor(GameHeight/2)
PosType=Left
BindTime=-1
RemoveTime=-1
SprPriority=-2

[State 0, Big Family Beam FX 4]
Type=Explod
Trigger1=Time = 100 && EnemyNear,StateNo = 3408
Anim=3413
Id=9993407
Facing=Facing
Pos = Floor(GameWidth/2), Floor(GameHeight/2)
PosType=Left
BindTime=-1
RemoveTime=-1
OnTop=1

[State 0, Remove Family]
Type=RemoveExplod
Trigger1=Time=230&&EnemyNear,StateNo = 3408
Id=9993407
[State 0, Change to Ending]
Type=ChangeState
Trigger1=Time=230&&EnemyNear,StateNo = 3408
Value=3403

;NON CINEMATIC BEHVIOR BELOW--------------------------------------------------------------------------------
[State 0, KHH for Goten]
Type=Helper
TriggerAll = EnemyNear,StateNo != 3406
Trigger1 = !Time
HelperType=Normal
StateNo = 92600
Id = 3401
Name = "LVL 1 Blast for Goten"
PosType=P1
Pos = 77,-36;80,-42
OwnPal = 1

[State 0, Lvl1 KHH]
Type=Helper
TriggerAll = EnemyNear,StateNo != 3406
Trigger1 = !Time
HelperType=Normal
StateNo = 92600
Id = 3401
Name = "LVL 1 Blast"
PosType=P1
Pos = 54,-58;60,-62
OwnPal = 1

[State 0, Lvl1 KHH for Goku]
Type=Helper
TriggerAll = EnemyNear,StateNo != 3406
Trigger1 = !Time
HelperType=Normal
StateNo = 92600
Id = 3401
Name = "LVL 1 Blast for Goku"
PosType=P1
Pos = 16,-82
OwnPal = 1

[State 0, Goku Launch SSJ]
Type=Explod
;Trigger1=Fvar(28) >=300
Trigger1=Anim=2401 && !NumExplod(9994005)
Anim=4005
Id=9994005
Pos=-40,0
PosType=P1
BindTime=-1
RemoveTime=-1
SuperMoveTime=999
SprPriority=4
Shadow = 30,30,30
[State 0, Remove Goku Launch SSJ]
Type=RemoveExplod
Trigger1 = Anim=3216 && !numhelper(3401) && numexplod(9994005)
Trigger2 = NumExplod(9993407)
Id=9994005
[State 0, Goku Launch SSJ Hair]
Type=Explod
;Trigger1=Fvar(28) >=300
Trigger1=Anim=2401 && NumExplod(9994005) && !NumExplod(9994006)
Anim=4006
Id=9994006
Pos=-40,0
PosType=P1
BindTime=-1
RemoveTime=-1
SuperMoveTime=999
SprPriority=4
Shadow = 30,30,30
[State 0, Remove Goku Launch SSJ Hair]
Type=RemoveExplod
Trigger1 = Anim=3216 && !numhelper(3401) && numexplod(9994006)
Trigger2 = NumExplod(9993407)
Id=9994006
ignorehitpause = 1

[State 0, Goku Leave]
Type=Explod
;Trigger1=Fvar(28) >= 300
Trigger1=Anim=3216 && !numhelper(3401) ;&& animelemtime(2)=0
Trigger1=!NumExplod(9994012)
Anim=4012
Id=9994012
Pos=-40,0
PosType=P1
BindTime=-1
RemoveTime=-1;-2
SuperMoveTime=999
SprPriority=4
ignorehitpause = 1
[state 0, Goku Leave Hair]
type = explod
;Trigger1=Fvar(28) >= 300
Trigger1=Anim=3216 && !numhelper(3401); && animelemtime(2)=0
Trigger1=!NumExplod(9994013)
Anim=4013
Id=9994013
Pos=-40,0
PosType=P1
BindTime=-1
RemoveTime=-1
SuperMoveTime=999
SprPriority=4
ignorehitpause = 1
[state 0, remove Goku Leave]
type = removeexplod
trigger1 = Anim=3216 && !AnimTime
ID = 9994012
[state 0, remove Goku Leave Hair]
type = removeexplod
trigger1 = anim=3216 && !animtime
ID = 9994013

[State 0, Goten Launch SSJ]
Type=Explod
;Trigger1=Fvar(28) >=300
Trigger1=Anim=2401
Trigger1=!NumExplod(9994008)
Anim=4008
Id=9994008
Pos=40,0
PosType=P1
BindTime=-1
RemoveTime=-1
SuperMoveTime=999
SprPriority=5
Shadow = 30,30,30
[State 0, Remove Goten Launch SSJ]
Type=RemoveExplod
;Trigger1=Anim=3216&&NumExplod(9994008)
trigger1 = anim=3216 && !numhelper(3401) && NumExplod(9994008)
Trigger2 = NumExplod(9993407)
Id=9994008
[State 0, Goten Launch SSJ Hair]
Type=Explod
;Trigger1=Fvar(28) >=300
Trigger1=Anim=2401
Trigger1=NumExplod(9994008) && !NumExplod(9994010)
Anim=4010
Id=9994010
Pos=40,0
PosType=P1
BindTime=-1
RemoveTime=-1
SuperMoveTime=999
SprPriority=5
Shadow = 30,30,30
[State 0, Remove Goten Launch SSJ Hair]
Type=RemoveExplod
;Trigger1=Anim=3216&&NumExplod(9994010)
trigger1 = anim=3216 && !numhelper(3401) && NumExplod(9994010)
Trigger2=NumExplod(9993407)
Id=9994010
[State 0, Goten Leave]
Type=Explod
;Trigger1=Fvar(28) >= 200
Trigger1 = Anim=3216
Trigger1 = !NumExplod(9993214) && !numhelper(3401)
Anim=3215;3214
Id=9993214
Pos=40,0
PosType=P1
BindTime=1
RemoveTime=-1;-2
SuperMoveTime=999
SprPriority=5
Shadow = 30,30,30
[state 0, remove Goten Leave]
type = removeexplod
trigger1 = Anim=3216 && !AnimTime
ID = 9993214

[state 0, tp sound]
type = playsnd
Trigger1 = Anim=3216
value = 2302, 0
persistent = 0

[state 0, reset emo gauge]
type = varset
triggerall = anim = 2401 && enemynear,stateno != 3408
trigger1 = time > 110
fvar(28) = 0
ignorehitpause = 1

[State 0, Return To Idle Animation]
Type=ChangeAnim
TriggerAll = Anim = 2401 && EnemyNear,StateNo != 3408
Trigger1=Time > 110
Value=3216
Elem=1

[State 0, Return To Idle State]
Type=ChangeState
Trigger1=Anim=3216&&!AnimTime
Value=0
Ctrl=1

;EFFECTS--------------------------------------------------------------------------
[State 0, Hit Sparks]
Type=Explod
Trigger1=EnemyNear,StateNo = 3408
Trigger1 = Time%4=0
Trigger1=Time<100
Trigger2 = !Time
Anim=7030
Id=7030
Pos=0,-60
Random = 100,50
PosType=P2
BindTime=1
RemoveTime=-2
SuperMoveTime=999
OnTop=1
[State 0, Hit Sparks]
Type=Explod
Trigger1=EnemyNear,StateNo = 3408
Trigger1 = Time%4=0
Trigger1=Time>=100
Anim=7030
Id=7030
Pos=0,-10
Random = 100,50
PosType=P2
BindTime=1
RemoveTime=-2
SuperMoveTime=999
OnTop=1
[State 0, Hit Count]
Type=HitAdd
Trigger1=EnemyNear,StateNo = 3408
Trigger1 = Time%4=0
Value=3

[State 0, Hit SFX]
type = PlaySnd
Trigger1=EnemyNear,StateNo = 3408
Trigger1 = Time%4=0
value = s1000,0

[State 0, Life Drain]
Type=TargetLifeAdd
Trigger1=EnemyNear,StateNo = 3408
Trigger1 = Time = 200
Id=3400
Value = -floor(IfElse(fvar(11) * 490 < 460, 460, fvar(11) * 490))
Kill=1

[State 0, White Fade]
Type=Explod
Trigger1=EnemyNear,StateNo = 3408
Trigger1=Time = 200 && !NumExplod(18230)
Anim=18230
Id=18230
Pos = Floor(GameWidth/2), Floor(GameHeight/2)
PosType=Left
BindTime=1
RemoveTime=-2
OnTop=1
Scale=3.0,3.0

[State 0, Remove Family Beam]
Type=RemoveExplod
Trigger1=Time = 230
Id=9993407


;EE P2 Stay on Screen
[Statedef 3405]
Type=A
MoveType=H
Physics=N
Ctrl=0
VelSet=-20,0

[State 0]
Type=ScreenBound
Trigger1=1
Value=0
MoveCamera=0,0

[State 0, Set Y Pos]
Type=PosSet
Trigger1=!Time && Pos Y < -60
Y=-60
;--[Animation Change]--
[State 0]	;On Ground
Type=ChangeAnim
Trigger1=!Time && Pos Y = 0
Value = 5012
[State 0]
Type=ChangeAnim
Trigger1=Anim=5012 && AnimTime = -1
Value = 5012
Elem = AnimElemNo(0)

[State 0]	;In Air
Type=ChangeAnim
Trigger1=!Time && Pos Y != 0
Value = 5030

[State 0]
Type=ChangeAnim
Trigger1=Anim = 5012 && Time > 10
Value = 5002
[State 0]
Type=ChangeAnim
Trigger1=Anim=5002 && AnimTime = -1
Value = 5002
Elem = AnimElemNo(0)

[State 0, Stop Moving at Screen Edge]
Type=VelSet
Trigger1=BackEdgeDist < 10
X=0

[State 0, Mid Hit Animation]
Type=ChangeState
Trigger1=BackEdgeDist < 10 && !Vel X
Trigger1=StateNo != 3406
Value=3406

[State 0, Change To Family Khh Reaction]
Type=ChangeState
Trigger1=EnemyNear,StateNo = 3404 && StateNo != 3407
Value=3408


;EE P2 Bounce Off Wall
[Statedef 3406]
Type=A
MoveType=H
Physics=N
Ctrl=0
VelSet=1,-2

[State 0]
Type=ScreenBound
Trigger1=1
Value=0
MoveCamera=0,0

[State 0, Gravity]
Type=VelAdd
Trigger1=Time>10
Y=0.45

[State 0, Hit Animation]
Type=ChangeAnim
Trigger1=!Time
Value=5051
[state 1321, Freeze]
type = changeanim 
triggerall = anim = 5051
trigger1 = animtime = -1 ;Freezes opponent in last frame of animation
value = anim
elem = animelemno(0)

[State 0, Landing]
Type=ChangeAnim
Trigger1=Pos Y > 0 && Anim != 5300
Value=5300

[State 0, Stick To Ground]
Type=PosSet
Trigger1=Anim = 5300
Y=0

[State 0, Stop Moving]
Type=VelSet
Trigger1=Anim=5300
X=0
Y=0

[State 0, Change To Family Khh Reaction]
Type=ChangeState
Trigger1=EnemyNear,StateNo = 3404 && StateNo != 3408
Value=3408


;EE P2 Bros Cinematic
[Statedef 3407]
Type=A
MoveType=H
Physics=N
Ctrl=0
VelSet=-20,0

[State 0]
Type=ScreenBound
Trigger1=1
Value=0
MoveCamera=0,0

;--[Animation Change]--
[State 0]	;On Ground
Type=ChangeAnim
Trigger1=!Time && Pos Y = 0
Value = 5012
[State 0]
Type=ChangeAnim
Trigger1=Anim=5012 && AnimTime = -1
Value = 5012
Elem = AnimElemNo(0)

[State 0]	;In Air
Type=ChangeAnim
Trigger1=Time = 100
Value = 5030

[State 0, Stop Moving out of screen]
Type=VelSet
Trigger1 = Time < 30
Trigger1=Pos X != [-400,400]
X=0

[State 0, Put at Edge Screen]
Type=PosSet
Trigger1=Time = 100
X = -300 * Facing
Y = -50

[State 0, Move Back To Center Stage]
Type=PosAdd
Trigger1=Time = [240,280]
X = 8

[State 0, Getting Hit]
Type=ChangeAnim
Trigger1=Time = 270
Value = 5012

;-----| falling to ground |-----
[State 0, Set Above Screen]
Type=PosSet
Trigger1=Time = 345
Y=-300
X = -100 * Facing
[state 0, gravity]
type = statetypeset
trigger1 = time = 400
statetype = A
[state 0, gravity]
type = veladd
trigger1 = time >= 400
y = 0.5
[state 0, fall anim]
type = changeanim2
trigger1 = time = 400
value = 5050
[state 0, HKD]
type = changestate
trigger1 = pos y + vel y >= 0
trigger1 = time > 400
value = 5954

[State 0, Falling Self State]
Type=null;SelfState
Trigger1=Time=400
Value = 5050

;EE P2 Family Cinematic
[Statedef 3408]
Type=A
MoveType=H
Physics=N
Ctrl=0
VelSet=0,0

[State 0]
Type=ScreenBound
Trigger1=1
Value=0
MoveCamera=0,0

[State 0, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = nobardisplay



[State 0]	;In Air
Type=ChangeAnim
Trigger1=!Time
Value = 5030

[State 0]	;In Air
Type=ChangeAnim2
Trigger1=Time = 100
Value = 3408

[State 0, Set Pos Perspective]
Type=PosSet
Trigger1=Time=100
X = -120 * Facing
Y = -150

[State 0, Scale Down]
Type=AngleDraw
Trigger1 = Time >= 100
Scale = 0.5, 0.5
Value = 1

[State 0, Change To Lie Down]
Type=ChangeState
Trigger1=Time=230
Value=3306

;EE End Tele
[Statedef 3217]
Type=A
MoveType=I
Physics=N
Ctrl=0
VelSet=0,0
Anim = 3217

[State 250, teleport sound]
type = PlaySnd
Trigger1 = !time
value = 2302, 0
channel = -1

[State 0, PosSet]
type = PosSet
trigger1 = 1
y = 0

[State 0, DD]
Type=Destroyself
trigger1 = ishelper
trigger1 = root,ctrl